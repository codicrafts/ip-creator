module.exports=[92287,79657,a=>{"use strict";var b=a.i(3752);let c=async(a,b={})=>{try{let c=await fetch(`/api/cloud/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();return{success:0,message:a.message||`HTTP 请求失败: ${c.status}`}}let d=await c.json();if(1!==d.success)return{success:0,message:d.message||"调用云函数失败"};return{success:1,...d}}catch(b){return console.error(`调用云函数 ${a} 失败:`,b),{success:0,message:b.message||`调用云函数 ${a} 失败`}}};a.s(["callCloudFunction",0,c],79657);var d=a.i(34528);let e=async a=>{try{let e=a||(0,d.getUserId)();if(!e)return{userTier:b.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}};let f=await c("user",{action:"getInfo",userId:e});if(1!==f.success){if("用户不存在"===f.message)return{userTier:b.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}};throw Error(f.message||"获取用户信息失败")}let g=f.data;return{userId:g.userId,phone:g.phone,userTier:g.userTier||b.UserTier.FREE,sceneUsage:g.sceneUsage||{date:new Date().toLocaleDateString(),count:0},memeUsage:g.memeUsage||{date:new Date().toLocaleDateString(),count:0}}}catch(a){return console.error("Get user info error:",a),{userTier:b.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}}}},f=async(a,b=1)=>{try{let d=await c("user",{action:"updateSceneUsage",userId:a,increment:b});if(1!==d.success)throw Error(d.message||"更新场景扩展使用次数失败");return d.data.sceneUsage}catch(a){throw console.error("Update scene usage error:",a),Error(a.message||"更新场景扩展使用次数失败")}},g=async(a,b=1)=>{try{let d=await c("user",{action:"updateMemeUsage",userId:a,increment:b});if(1!==d.success)throw Error(d.message||"更新表情包制作使用次数失败");return d.data.memeUsage}catch(a){throw console.error("Update meme usage error:",a),Error(a.message||"更新表情包制作使用次数失败")}};a.s(["getUserInfo",0,e,"updateMemeUsage",0,g,"updateSceneUsage",0,f],92287)},16616,a=>{"use strict";let b=(0,a.i(86269).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);a.s(["Zap",()=>b],16616)},65427,a=>{"use strict";var b=a.i(79657),c=a.i(34528);let d=async(a,d,e,f)=>{try{let g=(0,c.getUserId)(),h=await (0,b.callCloudFunction)("history",{action:"save",userId:g||void 0,type:a,url:d,prompt:e,style:f});if(1!==h.success)return console.error("Failed to save history:",h.message),null;return h.data}catch(a){return console.error("Save history error:",a),null}},e=async a=>{try{let d=(0,c.getUserId)(),e=await (0,b.callCloudFunction)("history",{action:"delete",userId:d||void 0,historyId:a});return 1===e.success}catch(a){return console.error("Delete history error:",a),!1}};a.s(["deleteHistory",0,e,"saveHistory",0,d])},60935,a=>{"use strict";let b=(0,a.i(86269).default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);a.s(["Square",()=>b],60935)},97643,a=>{"use strict";let b=(0,a.i(86269).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["X",()=>b],97643)},1706,a=>{"use strict";var b=a.i(46447),c=a.i(30564),d=a.i(97643),e=a.i(86269);let f=(0,e.default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),g=(0,e.default)("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);var h=a.i(38752);let i=(0,e.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),j=(0,e.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var k=a.i(3752);let l=process.env.NEXT_PUBLIC_PAYMENT_API_URL||"https://your-api-domain.com/api/payment",m=async a=>{try{let b=await fetch(`${l}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await b.json();throw Error(a.message||"创建订单失败")}return await b.json()}catch(a){throw console.error("Create payment order error:",a),a}},n=async a=>{try{let b=await fetch(`${l}/query/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!b.ok)throw Error("查询订单失败");return await b.json()}catch(a){throw console.error("Query order status error:",a),a}},o=async(a,b=30,c=2e3)=>{for(let d=0;d<b;d++)try{let b=await n(a);if("SUCCESS"===b.status||"FAILED"===b.status||"CANCELLED"===b.status)return b;await new Promise(a=>setTimeout(a,c))}catch(a){if(console.error(`Poll attempt ${d+1} failed:`,a),d===b-1)throw a;await new Promise(a=>setTimeout(a,c))}throw Error("支付超时，请稍后查询订单状态")};var p=a.i(34528);a.s(["default",0,({isOpen:a,onClose:e,onSuccess:l,amount:n,productName:q,productDesc:r})=>{let[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)("idle");if(!a)return null;let A=async()=>{if(!s)return void x("请选择支付方式");v(!0),x(null),z("processing");try{let a={amount:Math.round(100*n),productName:q,productDesc:r,paymentMethod:s,userId:(0,p.getUserId)()||void 0},{orderId:b,paymentParams:c}=await m(a);if(s===k.PaymentMethod.WECHAT)await new Promise((a,b)=>{window.wx?window.wx.chooseWXPay({timestamp:c.timeStamp,nonceStr:c.nonceStr,package:c.package,signType:c.signType,paySign:c.paySign,success:()=>{a()},fail:a=>{b(Error(a.errMsg||"支付失败"))}}):b(Error("请在微信中打开"))});else{let a;s===k.PaymentMethod.ALIPAY&&await (a=c.orderString,new Promise((b,c)=>{let d=document.createElement("form");d.method="POST",d.action="https://openapi.alipay.com/gateway.do",d.style.display="none",new URLSearchParams(a).forEach((a,b)=>{let c=document.createElement("input");c.type="hidden",c.name=b,c.value=a,d.appendChild(c)}),document.body.appendChild(d),d.submit(),b()}))}let d=await o(b);"SUCCESS"===d.status?(z("success"),setTimeout(()=>{l(),B()},1500)):(z("failed"),x("支付失败，请重试"))}catch(a){console.error("Payment error:",a),z("failed"),x(a.message||"支付失败，请重试")}finally{v(!1)}},B=()=>{u||(t(null),x(null),z("idle"),e())};return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-md md:max-w-lg mx-4 overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,b.jsxs)("div",{className:"relative bg-gradient-to-r from-violet-600 to-violet-700 p-6 text-white",children:[(0,b.jsx)("button",{onClick:B,disabled:u,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition-colors disabled:opacity-50",children:(0,b.jsx)(d.X,{size:20})}),(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"升级会员"}),(0,b.jsx)("p",{className:"text-violet-100 text-sm mt-1",children:r||"解锁更多功能"})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"text-center py-4 bg-gray-50 rounded-2xl",children:[(0,b.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"支付金额"}),(0,b.jsxs)("div",{className:"text-4xl font-bold text-gray-900",children:["¥",(0,b.jsx)("span",{children:n.toFixed(2)})]})]}),"idle"===y&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:"选择支付方式"}),(0,b.jsxs)("button",{onClick:()=>t(k.PaymentMethod.WECHAT),disabled:u,className:`w-full p-4 rounded-xl border-2 transition-all flex items-center gap-4 ${s===k.PaymentMethod.WECHAT?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-violet-200"} ${u?"opacity-50 cursor-not-allowed":""}`,children:[(0,b.jsx)("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${s===k.PaymentMethod.WECHAT?"bg-violet-100":"bg-gray-100"}`,children:(0,b.jsx)(g,{size:24,className:s===k.PaymentMethod.WECHAT?"text-violet-600":"text-gray-600"})}),(0,b.jsxs)("div",{className:"flex-1 text-left",children:[(0,b.jsx)("div",{className:"font-semibold text-gray-900",children:"微信支付"}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"推荐使用"})]}),s===k.PaymentMethod.WECHAT&&(0,b.jsx)("div",{className:"w-5 h-5 rounded-full bg-violet-600 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]}),(0,b.jsxs)("button",{onClick:()=>t(k.PaymentMethod.ALIPAY),disabled:u,className:`w-full p-4 rounded-xl border-2 transition-all flex items-center gap-4 ${s===k.PaymentMethod.ALIPAY?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-violet-200"} ${u?"opacity-50 cursor-not-allowed":""}`,children:[(0,b.jsx)("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${s===k.PaymentMethod.ALIPAY?"bg-violet-100":"bg-gray-100"}`,children:(0,b.jsx)(f,{size:24,className:s===k.PaymentMethod.ALIPAY?"text-violet-600":"text-gray-600"})}),(0,b.jsxs)("div",{className:"flex-1 text-left",children:[(0,b.jsx)("div",{className:"font-semibold text-gray-900",children:"支付宝"}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"安全便捷"})]}),s===k.PaymentMethod.ALIPAY&&(0,b.jsx)("div",{className:"w-5 h-5 rounded-full bg-violet-600 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]})]}),"processing"===y&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[(0,b.jsx)(h.Loader2,{className:"w-12 h-12 text-violet-600 animate-spin"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"font-semibold text-gray-900",children:"正在处理支付..."}),(0,b.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:"请完成支付操作"})]})]}),"success"===y&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[(0,b.jsx)(i,{className:"w-16 h-16 text-green-500"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"font-semibold text-gray-900 text-lg",children:"支付成功！"}),(0,b.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:"正在为您升级会员..."})]})]}),"failed"===y&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[(0,b.jsx)(j,{className:"w-16 h-16 text-red-500"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"font-semibold text-gray-900 text-lg",children:"支付失败"}),(0,b.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:w||"请重试"})]})]}),w&&"idle"===y&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:w}),"idle"===y&&(0,b.jsx)("button",{onClick:A,disabled:!s||u,className:`w-full py-4 rounded-xl font-semibold text-white transition-all flex items-center justify-center gap-2 ${!s||u?"bg-gray-300 cursor-not-allowed":"bg-violet-600 hover:bg-violet-700 active:scale-95"}`,children:u?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Loader2,{className:"animate-spin",size:18}),"处理中..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f,{size:18}),"确认支付 ¥",n.toFixed(2)]})}),"failed"===y&&(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:B,className:"flex-1 py-3 rounded-xl font-semibold border-2 border-gray-200 text-gray-700 hover:bg-gray-50",children:"取消"}),(0,b.jsx)("button",{onClick:()=>{z("idle"),x(null)},className:"flex-1 py-3 rounded-xl font-semibold bg-violet-600 text-white hover:bg-violet-700",children:"重试"})]})]})]})})}],1706)},79469,a=>{"use strict";let b=(0,a.i(86269).default)("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);a.s(["Crown",()=>b],79469)}];

//# sourceMappingURL=_0429de14._.js.map