{"version":3,"sources":["../../../../node_modules/.pnpm/lucide-react%400.554.0_react%4019.2.0/node_modules/lucide-react/src/icons/chevron-left.ts","../../../../lib/image-storage.ts","../../../../app/create/page.tsx"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [['path', { d: 'm15 18-6-6 6-6', key: '1wnfg3' }]];\n\n/**\n * @component @name ChevronLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTUgMTgtNi02IDYtNiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/chevron-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronLeft = createLucideIcon('chevron-left', __iconNode);\n\nexport default ChevronLeft;\n","/**\n * 图片本地存储工具\n * 用于在 edit 页面持久化 sourceImage，避免刷新后丢失\n */\n\nconst SOURCE_IMAGE_KEY = 'ip_creative_source_image';\nconst SOURCE_IMAGE_MIME_TYPE_KEY = 'ip_creative_source_image_mime_type';\n\n/**\n * 保存源图片到 localStorage\n */\nexport const saveSourceImage = (image: string, mimeType: string) => {\n  try {\n    localStorage.setItem(SOURCE_IMAGE_KEY, image);\n    localStorage.setItem(SOURCE_IMAGE_MIME_TYPE_KEY, mimeType);\n  } catch (error) {\n    console.error('Failed to save source image to localStorage:', error);\n    // 如果存储失败（可能是存储空间不足），尝试清理旧数据\n    try {\n      localStorage.removeItem(SOURCE_IMAGE_KEY);\n      localStorage.removeItem(SOURCE_IMAGE_MIME_TYPE_KEY);\n      localStorage.setItem(SOURCE_IMAGE_KEY, image);\n      localStorage.setItem(SOURCE_IMAGE_MIME_TYPE_KEY, mimeType);\n    } catch (retryError) {\n      console.error('Failed to save source image after cleanup:', retryError);\n    }\n  }\n};\n\n/**\n * 从 localStorage 加载源图片\n */\nexport const loadSourceImage = (): { image: string; mimeType: string } | null => {\n  try {\n    const image = localStorage.getItem(SOURCE_IMAGE_KEY);\n    const mimeType = localStorage.getItem(SOURCE_IMAGE_MIME_TYPE_KEY);\n    if (image && mimeType) {\n      return { image, mimeType };\n    }\n  } catch (error) {\n    console.error('Failed to load source image from localStorage:', error);\n  }\n  return null;\n};\n\n/**\n * 清除源图片\n */\nexport const clearSourceImage = () => {\n  try {\n    localStorage.removeItem(SOURCE_IMAGE_KEY);\n    localStorage.removeItem(SOURCE_IMAGE_MIME_TYPE_KEY);\n  } catch (error) {\n    console.error('Failed to clear source image from localStorage:', error);\n  }\n};\n\n","'use client';\n\nimport { useRouter } from 'next/navigation';\nimport { ChevronLeft } from 'lucide-react';\nimport { useRef } from 'react';\nimport { useAppDispatch } from '@/store/hooks';\nimport { setSourceImage } from '@/store/slices/imageSlice';\nimport { saveSourceImage } from '@/lib/image-storage';\nimport { setMemeDrafts, setActiveDraftIndex } from '@/store/slices/memeSlice';\nimport { AnimationType } from '@/types';\n\nexport default function CreatePage() {\n  const router = useRouter();\n  const dispatch = useAppDispatch();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const triggerFileInput = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        const imageData = reader.result as string;\n        const mimeType = file.type;\n        \n        // 保存到 Redux\n        dispatch(setSourceImage({\n          image: imageData,\n          mimeType: mimeType,\n        }));\n        \n        // 保存到 localStorage（每次进入 edit 都会替换最新的图片）\n        saveSourceImage(imageData, mimeType);\n        \n        // 从 /create 页面上传的文件，应该跳转到场景扩展编辑页\n        router.push('/edit');\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col min-h-screen bg-gray-50 pb-24 md:pt-16\">\n      <header className=\"bg-white p-4 md:hidden sticky top-0 z-10 shadow-sm border-b border-gray-100 flex items-center justify-center relative\">\n        <button\n          onClick={() => router.push('/')}\n          className=\"absolute left-4 p-2 hover:bg-gray-100 rounded-full transition-colors\"\n        >\n          <ChevronLeft size={24} className=\"text-gray-600\" />\n        </button>\n        <h2 className=\"font-bold text-lg text-gray-800\">上传素材</h2>\n      </header>\n\n      <div className=\"flex-1 p-6 md:p-12 flex flex-col justify-center max-w-4xl mx-auto w-full\">\n        <div\n          onClick={triggerFileInput}\n          className=\"bg-white border-2 border-dashed border-violet-200 rounded-3xl p-10 md:p-16 flex flex-col items-center justify-center space-y-4 cursor-pointer hover:bg-violet-50 hover:border-violet-400 transition-all group min-h-[320px] md:min-h-[400px]\"\n        >\n          <div className=\"w-16 h-16 bg-violet-100 text-violet-600 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform\">\n            <svg\n              className=\"w-8 h-8\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"\n              />\n            </svg>\n          </div>\n          <div className=\"text-center space-y-2\">\n            <p className=\"font-semibold text-gray-700\">点击上传图片</p>\n            <p className=\"text-xs text-gray-400\">支持 JPG, PNG (最大 5MB)</p>\n          </div>\n          <input\n            type=\"file\"\n            ref={fileInputRef}\n            className=\"hidden\"\n            accept=\"image/png, image/jpeg, image/webp\"\n            onChange={handleFileChange}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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","ignoreList":[0]}