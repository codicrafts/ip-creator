module.exports=[57949,a=>{"use strict";let b=(0,a.i(86269).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);a.s(["ChevronLeft",()=>b],57949)},92287,79657,a=>{"use strict";var b=a.i(3752);let c=async(a,b={})=>{try{let c=await fetch(`/api/cloud/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();return{success:0,message:a.message||`HTTP 请求失败: ${c.status}`}}let d=await c.json();if(1!==d.success)return{success:0,message:d.message||"调用云函数失败"};return{success:1,...d}}catch(b){return console.error(`调用云函数 ${a} 失败:`,b),{success:0,message:b.message||`调用云函数 ${a} 失败`}}};a.s(["callCloudFunction",0,c],79657);var d=a.i(34528);let e=async a=>{try{let e=a||(0,d.getUserId)();if(!e)return{userTier:b.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}};let f=await c("user",{action:"getInfo",userId:e});if(1!==f.success){if("用户不存在"===f.message)return{userTier:b.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}};throw Error(f.message||"获取用户信息失败")}let g=f.data;return{userId:g.userId,phone:g.phone,userTier:g.userTier||b.UserTier.FREE,sceneUsage:g.sceneUsage||{date:new Date().toLocaleDateString(),count:0},memeUsage:g.memeUsage||{date:new Date().toLocaleDateString(),count:0}}}catch(a){return console.error("Get user info error:",a),{userTier:b.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}}}},f=async(a,b=1)=>{try{let d=await c("user",{action:"updateSceneUsage",userId:a,increment:b});if(1!==d.success)throw Error(d.message||"更新场景扩展使用次数失败");return d.data.sceneUsage}catch(a){throw console.error("Update scene usage error:",a),Error(a.message||"更新场景扩展使用次数失败")}},g=async(a,b=1)=>{try{let d=await c("user",{action:"updateMemeUsage",userId:a,increment:b});if(1!==d.success)throw Error(d.message||"更新表情包制作使用次数失败");return d.data.memeUsage}catch(a){throw console.error("Update meme usage error:",a),Error(a.message||"更新表情包制作使用次数失败")}};a.s(["getUserInfo",0,e,"updateMemeUsage",0,g,"updateSceneUsage",0,f],92287)},25934,a=>{"use strict";var b=a.i(79657),c=a.i(34528);a.i(92287);let d=async(a,d)=>{try{let e=await (0,b.callCloudFunction)("auth",{action:"login",phone:a,password:d});if(console.log("result",e),1!==e.success)throw Error(e.message||"登录失败");let f=e.data;return(0,c.setUserId)(f.userId),{userId:f.userId,phone:f.phone,userTier:f.userTier}}catch(a){throw console.error("Login error:",a),Error(a.message||"登录失败")}},e=async()=>{(0,c.clearUserId)(),localStorage.removeItem("ip_creative_scene_usage"),localStorage.removeItem("ip_creative_meme_usage")};a.s(["login",0,d,"logout",0,e])},83694,a=>{"use strict";var b=a.i(46447),c=a.i(30564),d=a.i(1470),e=a.i(57949),f=a.i(86269);let g=(0,f.default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),h=(0,f.default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),i=(0,f.default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),j=(0,f.default)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var k=a.i(56489),l=a.i(4204),m=a.i(25934),n=a.i(92287);function o(){let a=(0,d.useRouter)(),f=(0,k.useAppDispatch)(),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),y=async b=>{b.preventDefault(),x(""),v(!0);try{if(!/^1[3-9]\d{9}$/.test(o)){x("请输入正确的手机号"),v(!1);return}if(q.length<6){x("密码至少6位"),v(!1);return}let b=await (0,m.login)(o,q),c=await (0,n.getUserInfo)(b.userId);f((0,l.setUserInfo)({userId:c.userId||b.userId,phone:b.phone,userTier:c.userTier})),f((0,l.setSceneUsage)(c.sceneUsage)),f((0,l.setMemeUsage)(c.memeUsage)),a.push("/")}catch(a){x(a.message||"登录失败")}finally{v(!1)}};return(0,b.jsxs)("div",{className:"flex flex-col min-h-screen bg-gradient-to-b from-violet-50 to-white pb-24 md:pt-16",children:[(0,b.jsxs)("header",{className:"bg-white/80 backdrop-blur-sm p-4 md:hidden sticky top-0 z-10 shadow-sm border-b border-gray-100 flex items-center",children:[(0,b.jsx)("button",{onClick:()=>a.back(),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,b.jsx)(e.ChevronLeft,{size:24,className:"text-gray-600"})}),(0,b.jsx)("h2",{className:"font-bold text-lg text-gray-800 ml-2",children:"登录"})]}),(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center p-6 md:p-12",children:(0,b.jsx)("div",{className:"w-full max-w-md",children:(0,b.jsxs)("div",{className:"bg-white rounded-3xl shadow-xl p-8 md:p-10 space-y-6",children:[(0,b.jsxs)("div",{className:"text-center space-y-2",children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"欢迎使用"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"登录即注册，首次登录将自动创建账号"})]}),w&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-xl text-sm",children:w}),(0,b.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"手机号"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,b.jsx)(g,{size:20})}),(0,b.jsx)("input",{type:"tel",value:o,onChange:a=>p(a.target.value),placeholder:"请输入手机号",className:"w-full pl-11 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-transparent outline-none transition-all",required:!0})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"密码"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:(0,b.jsx)(h,{size:20})}),(0,b.jsx)("input",{type:s?"text":"password",value:q,onChange:a=>r(a.target.value),placeholder:"请输入密码（至少6位）",className:"w-full pl-11 pr-12 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-transparent outline-none transition-all",required:!0,minLength:6}),(0,b.jsx)("button",{type:"button",onClick:()=>t(!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:s?(0,b.jsx)(j,{size:20}):(0,b.jsx)(i,{size:20})})]})]}),(0,b.jsx)("button",{type:"submit",disabled:u,className:"w-full py-3 bg-violet-600 text-white rounded-xl font-semibold shadow-lg shadow-violet-200 hover:bg-violet-700 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:u?"处理中...":"登录"})]})]})})})]})}a.s(["default",()=>o],83694)},65748,a=>{a.v(a=>Promise.resolve().then(()=>a(34528)))}];

//# sourceMappingURL=_fcb4260b._.js.map