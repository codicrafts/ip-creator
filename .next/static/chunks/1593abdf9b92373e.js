(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,36918,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0})},8778,(e,t,r)=>{"use strict";let o;Object.defineProperty(r,"__esModule",{value:!0}),r.parse=function(e,t){let r=new u,o=e.length;if(o<2)return r;let i=t?.decode||f,n=0;do{let t=e.indexOf("=",n);if(-1===t)break;let s=e.indexOf(";",n),a=-1===s?o:s;if(t>a){n=e.lastIndexOf(";",t-1)+1;continue}let c=l(e,n,t),u=d(e,t,c),f=e.slice(c,u);if(void 0===r[f]){let o=l(e,t+1,a),n=d(e,a,o),s=i(e.slice(o,n));r[f]=s}n=a+1}while(n<o)return r},r.serialize=function(e,t,r){let o=r?.encode||encodeURIComponent;if(!i.test(e))throw TypeError(`argument name is invalid: ${e}`);let u=o(t);if(!n.test(u))throw TypeError(`argument val is invalid: ${t}`);let l=e+"="+u;if(!r)return l;if(void 0!==r.maxAge){if(!Number.isInteger(r.maxAge))throw TypeError(`option maxAge is invalid: ${r.maxAge}`);l+="; Max-Age="+r.maxAge}if(r.domain){if(!s.test(r.domain))throw TypeError(`option domain is invalid: ${r.domain}`);l+="; Domain="+r.domain}if(r.path){if(!a.test(r.path))throw TypeError(`option path is invalid: ${r.path}`);l+="; Path="+r.path}if(r.expires){var d;if(d=r.expires,"[object Date]"!==c.call(d)||!Number.isFinite(r.expires.valueOf()))throw TypeError(`option expires is invalid: ${r.expires}`);l+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(l+="; HttpOnly"),r.secure&&(l+="; Secure"),r.partitioned&&(l+="; Partitioned"),r.priority)switch("string"==typeof r.priority?r.priority.toLowerCase():void 0){case"low":l+="; Priority=Low";break;case"medium":l+="; Priority=Medium";break;case"high":l+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${r.priority}`)}if(r.sameSite)switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:case"strict":l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"none":l+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${r.sameSite}`)}return l};let i=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,n=/^[\u0021-\u003A\u003C-\u007E]*$/,s=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,a=/^[\u0020-\u003A\u003D-\u007E]*$/,c=Object.prototype.toString,u=((o=function(){}).prototype=Object.create(null),o);function l(e,t,r){do{let r=e.charCodeAt(t);if(32!==r&&9!==r)return t}while(++t<r)return r}function d(e,t,r){for(;t>r;){let r=e.charCodeAt(--t);if(32!==r&&9!==r)return t+1}return r}function f(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}},57996,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getRenderPhase=r.isClientSide=r.decode=r.stringify=void 0,r.stringify=function(e){try{if("string"==typeof e)return e;return JSON.stringify(e)}catch(t){return e}},r.decode=function(e){return e?e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent):e},r.isClientSide=function(e){return!(null==e?void 0:e.req)&&!(null==e?void 0:e.res)&&!(e&&"cookies"in e&&(null==e?void 0:e.cookies))},r.getRenderPhase=function(){return"undefined"==typeof window?"server":"client"}},36575,(e,t,r)=>{"use strict";var o=e.e&&e.e.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.revalidateCookies=r.hasCookie=r.deleteCookie=r.setCookie=r.getCookie=r.getCookies=void 0;var i=e.r(8778),n=e.r(57996),s=function(e){if(!(0,n.isClientSide)(e))throw Error("You are trying to access cookies on the server side. Please, use the server-side import with `cookies-next/server` instead.")},a=function(e){if(s(e),"server"!==(0,n.getRenderPhase)()){for(var t={},r=document.cookie?document.cookie.split("; "):[],o=0,i=r.length;o<i;o++){var a=r[o].split("="),c=a.slice(1).join("=");t[a[0]]=c}return t}};r.getCookies=a,r.getCookie=function(e,t){s(t);var r=a(t),o=null==r?void 0:r[e];if(void 0!==o)return(0,n.decode)(o)};var c=function(e,t,r){if(s(r),"server"!==(0,n.getRenderPhase)()){var a=(0,i.serialize)(e,(0,n.stringify)(t),o({path:"/"},r||{}));document.cookie=a}};r.setCookie=c,r.deleteCookie=function(e,t){s(t),c(e,"",o(o({},t),{maxAge:-1}))},r.hasCookie=function(e,t){if(s(t),!e)return!1;var r=a(t);return!!r&&Object.prototype.hasOwnProperty.call(r,e)},r.revalidateCookies=function(e,t){if(s(),"server"!==(0,n.getRenderPhase)()){var r=a();Object.keys(o(o({},r),t)).some(function(e){return(null==r?void 0:r[e])!==(null==t?void 0:t[e])})&&(e(r),t=r)}}},42843,(e,t,r)=>{"use strict";var o=e.e&&e.e.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e.e&&e.e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.CookieProvider=r.CookieContext=void 0;var a=s(e.r(75305)),c=e.r(51318),u=e.r(57996);r.CookieContext=(0,a.createContext)(null),r.CookieProvider=function(e){var t=e.children,i=e.pollingOptions,n=(0,a.useState)({}),s=n[0],l=n[1];(0,a.useEffect)(function(){var e=(0,c.getCookies)();e&&l(e)},[]),(0,c.useCookiesPolling)(function(e){e&&l(e)},i);var d=(0,a.useMemo)(function(){return{cookies:s,set:function(e,t){l(function(r){var i;return o(o({},r),((i={})[e]=encodeURIComponent((0,u.stringify)(t)),i))})},get:function(e){return null==s?void 0:s[e]},getAll:function(){return s},has:function(e){return s.hasOwnProperty(e)},delete:function(e){s.hasOwnProperty(e)&&l(function(t){var r=o({},t);return delete r[e],r})},revalidateCookiesState:function(){(0,c.revalidateCookies)(function(e){e&&l(e)},s)}}},[s]);return a.default.createElement(r.CookieContext.Provider,{value:d},t)}},56324,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.useRevalidateCookiesState=r.useReactiveHasCookie=r.useReactiveDeleteCookie=r.useReactiveSetCookie=r.useReactiveGetCookie=r.useReactiveGetCookies=r.useReactiveCookiesNext=r.useCookiesNext=r.useHasCookie=r.useDeleteCookie=r.useSetCookie=r.useGetCookie=r.useGetCookies=r.useCookiesPolling=void 0;var o=e.r(42843),i=e.r(75305),n=e.r(36575),s=function(e){var t=(0,i.useState)(!1),r=t[0],o=t[1];return(0,i.useEffect)(function(){o(!0)},[]),r?e:function(){}},a=function(){var e=(0,i.useContext)(o.CookieContext);if(!e)throw Error("useCookieContext must be used within a CookieProvider");return e};r.useCookiesPolling=function(e,t){var r=t||{},o=r.intervalMs,s=void 0===o?1e3:o,a=r.enabled,c=void 0!==a&&a;(0,i.useEffect)(function(){if(c){var t=(0,n.getCookies)(),r=setInterval(function(){(0,n.revalidateCookies)(e,t)},s);return function(){return clearInterval(r)}}},[e,s])};var c=function(){return s(n.getCookies)};r.useGetCookies=c;var u=function(){return s(n.getCookie)};r.useGetCookie=u;var l=function(){return s(n.hasCookie)};r.useHasCookie=l;var d=function(){return s(n.setCookie)};r.useSetCookie=d;var f=function(){return s(n.deleteCookie)};r.useDeleteCookie=f,r.useCookiesNext=function(){return{getCookies:c(),getCookie:u(),hasCookie:l(),setCookie:d(),deleteCookie:f()}};var v=function(){var e=a();return function(){return null==e?void 0:e.getAll()}};r.useReactiveGetCookies=v;var p=function(){var e=a();return function(t){return null==e?void 0:e.get(t)}};r.useReactiveGetCookie=p;var y=function(){var e=a();return function(t,r,o){return null==e||e.set(t,r),(0,n.setCookie)(t,r,o)}};r.useReactiveSetCookie=y;var h=function(){var e=a();return function(t,r){return null==e||e.delete(t),(0,n.deleteCookie)(t,r)}};r.useReactiveDeleteCookie=h;var g=function(){var e=a();return function(t){return null==e?void 0:e.has(t)}};r.useReactiveHasCookie=g;var m=function(){var e=a();return function(){null==e||e.revalidateCookiesState()}};r.useRevalidateCookiesState=m,r.useReactiveCookiesNext=function(){return{getCookies:v(),getCookie:p(),hasCookie:g(),setCookie:y(),deleteCookie:h(),revalidateCookiesState:m()}}},51318,(e,t,r)=>{"use strict";var o=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.CookiesNextProvider=void 0,i(e.r(36918),r),i(e.r(36575),r);var n=e.r(42843);Object.defineProperty(r,"CookiesNextProvider",{enumerable:!0,get:function(){return n.CookieProvider}}),i(e.r(56324),r)},18411,(e,t,r)=>{"use strict";var o=e.e&&e.e.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)},s=e.e&&e.e.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((o=o.apply(e,t||[])).next())})},a=e.e&&e.e.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(a){return function(c){var u=[a,c];if(r)throw TypeError("Generator is already executing.");for(;n&&(n=0,u[0]&&(s=0)),s;)try{if(r=1,o&&(i=2&u[0]?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,o=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){s=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(6===u[0]&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(e,s)}catch(e){u=[6,e],o=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}},c=e.e&&e.e.__rest||function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&0>t.indexOf(o)&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,o=Object.getOwnPropertySymbols(e);i<o.length;i++)0>t.indexOf(o[i])&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(r[o[i]]=e[o[i]]);return r};Object.defineProperty(r,"__esModule",{value:!0}),r.hasCookie=r.deleteCookie=r.setCookie=r.getCookie=r.getCookies=void 0;var u=e.r(8778),l=e.r(57996),d=function(e){if((0,l.isClientSide)(e))throw Error("You are trying to access cookies on the client side. Please, use the client-side import with `cookies-next/client` instead.")},f=function(e){return!!e&&"getAll"in e&&"set"in e&&"function"==typeof e.getAll&&"function"==typeof e.set},v=function(e){return!!(null==e?void 0:e.req)&&"cookies"in e.req&&f(e.req.cookies)||!!(null==e?void 0:e.res)&&"cookies"in e.res&&f(e.res.cookies)||!!e&&"cookies"in e&&"function"==typeof e.cookies},p=function(e){var t={};return e.getAll().forEach(function(e){var r=e.name,o=e.value;t[r]=o}),t},y=function(e){return s(void 0,void 0,void 0,function(){var t,r;return a(this,function(o){switch(o.label){case 0:if(d(e),!v(e))return[3,2];if(e.req)return[2,p(e.req.cookies)];if(e.res)return[2,p(e.res.cookies)];if(!e.cookies)return[3,2];return t=p,[4,e.cookies()];case 1:return[2,t.apply(void 0,[o.sent()])];case 2:if((null==e?void 0:e.req)&&(r=e.req),null==r?void 0:r.cookies)return[2,r.cookies];if(null==r?void 0:r.headers.cookie)return[2,(0,u.parse)(r.headers.cookie)];return[2,{}]}})})};r.getCookies=y,r.getCookie=function(e,t){return s(void 0,void 0,void 0,function(){var r;return a(this,function(o){switch(o.label){case 0:return d(t),[4,y(t)];case 1:if(void 0===(r=o.sent()[e]))return[2,void 0];return[2,(0,l.decode)(r)]}})})};var h=function(e,t,r){return s(void 0,void 0,void 0,function(){var i,n,s,f,p,y,h,g,m,k,x,C,b,w,j;return a(this,function(a){switch(a.label){case 0:if(d(r),!v(r))return[3,3];if(i=r.req,n=r.res,s=r.cookies,f=c(r,["req","res","cookies"]),p=o({name:e,value:(0,l.stringify)(t)},f),i&&i.cookies.set(p),n&&n.cookies.set(p),!s)return[3,2];return[4,s()];case 1:a.sent().set(p),a.label=2;case 2:return[2];case 3:return y={},r&&(k=(m=r).req,x=m.res,C=c(m,["req","res"]),h=k,g=x,y=C),b=(0,u.serialize)(e,(0,l.stringify)(t),o({path:"/"},y)),g&&h&&(Array.isArray(w=g.getHeader("Set-Cookie"))||(w=w?[String(w)]:[]),g.setHeader("Set-Cookie",w.concat(b)),h&&h.cookies&&(j=h.cookies,""===t?delete j[e]:j[e]=(0,l.stringify)(t)),h&&h.headers&&h.headers.cookie&&(j=(0,u.parse)(h.headers.cookie),""===t?delete j[e]:j[e]=(0,l.stringify)(t),h.headers.cookie=Object.entries(j).reduce(function(e,t){return e.concat("".concat(t[0],"=").concat(t[1],";"))},""))),[2]}})})};r.setCookie=h,r.deleteCookie=function(e,t){return s(void 0,void 0,void 0,function(){return a(this,function(r){return d(t),[2,h(e,"",o(o({},t),{maxAge:-1}))]})})},r.hasCookie=function(e,t){return s(void 0,void 0,void 0,function(){return a(this,function(r){switch(r.label){case 0:if(d(t),!e)return[2,!1];return[4,y(t)];case 1:return[2,r.sent().hasOwnProperty(e)]}})})},n(e.r(36918),r)},14627,(e,t,r)=>{"use strict";var o=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=e.e&&e.e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=e.e&&e.e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t},s=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.CookiesNextProvider=r.useReactiveCookiesNext=r.useReactiveHasCookie=r.useReactiveDeleteCookie=r.useReactiveSetCookie=r.useReactiveGetCookie=r.useReactiveGetCookies=r.useCookiesNext=r.useDeleteCookie=r.useGetCookie=r.useSetCookie=r.useHasCookie=r.useGetCookies=r.hasCookie=r.deleteCookie=r.setCookie=r.getCookie=r.getCookies=void 0;var a=n(e.r(51318)),c=n(e.r(18411));s(e.r(36918),r);var u=e.r(57996);r.getCookies=function(e){return(0,u.isClientSide)(e)?a.getCookies(e):c.getCookies(e)},r.getCookie=function(e,t){return(0,u.isClientSide)(t)?a.getCookie(e,t):c.getCookie(e,t)},r.setCookie=function(e,t,r){return(0,u.isClientSide)(r)?a.setCookie(e,t,r):c.setCookie(e,t,r)},r.deleteCookie=function(e,t){return(0,u.isClientSide)(t)?a.deleteCookie(e,t):c.deleteCookie(e,t)},r.hasCookie=function(e,t){return(0,u.isClientSide)(t)?a.hasCookie(e,t):c.hasCookie(e,t)};var l=e.r(51318);Object.defineProperty(r,"useGetCookies",{enumerable:!0,get:function(){return l.useGetCookies}}),Object.defineProperty(r,"useHasCookie",{enumerable:!0,get:function(){return l.useHasCookie}}),Object.defineProperty(r,"useSetCookie",{enumerable:!0,get:function(){return l.useSetCookie}}),Object.defineProperty(r,"useGetCookie",{enumerable:!0,get:function(){return l.useGetCookie}}),Object.defineProperty(r,"useDeleteCookie",{enumerable:!0,get:function(){return l.useDeleteCookie}}),Object.defineProperty(r,"useCookiesNext",{enumerable:!0,get:function(){return l.useCookiesNext}}),Object.defineProperty(r,"useReactiveGetCookies",{enumerable:!0,get:function(){return l.useReactiveGetCookies}}),Object.defineProperty(r,"useReactiveGetCookie",{enumerable:!0,get:function(){return l.useReactiveGetCookie}}),Object.defineProperty(r,"useReactiveSetCookie",{enumerable:!0,get:function(){return l.useReactiveSetCookie}}),Object.defineProperty(r,"useReactiveDeleteCookie",{enumerable:!0,get:function(){return l.useReactiveDeleteCookie}}),Object.defineProperty(r,"useReactiveHasCookie",{enumerable:!0,get:function(){return l.useReactiveHasCookie}}),Object.defineProperty(r,"useReactiveCookiesNext",{enumerable:!0,get:function(){return l.useReactiveCookiesNext}}),Object.defineProperty(r,"CookiesNextProvider",{enumerable:!0,get:function(){return l.CookiesNextProvider}})},54558,e=>{"use strict";var t=e.i(14627);let r="ip_creative_user_id",o={maxAge:2592e3,path:"/",sameSite:"lax"},i=()=>{let e=(0,t.getCookie)(r);return e?String(e):null};e.s(["clearUserId",0,()=>{(0,t.deleteCookie)(r)},"getUserId",0,i,"isAuthenticated",0,()=>!!i(),"setUserId",0,e=>{(0,t.setCookie)(r,e,o)}])},82935,29336,e=>{"use strict";var t=e.i(64807);let r=async(e,t={})=>{try{let r=await fetch(`/api/cloud/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){let e=await r.json();return{success:0,message:e.message||`HTTP 请求失败: ${r.status}`}}let o=await r.json();if(1!==o.success)return{success:0,message:o.message||"调用云函数失败"};return{success:1,...o}}catch(t){return console.error(`调用云函数 ${e} 失败:`,t),{success:0,message:t.message||`调用云函数 ${e} 失败`}}};e.s(["callCloudFunction",0,r],29336);var o=e.i(54558);let i=async e=>{try{let i=e||(0,o.getUserId)();if(!i)return{userTier:t.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}};let n=await r("user",{action:"getInfo",userId:i});if(1!==n.success){if("用户不存在"===n.message)return{userTier:t.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}};throw Error(n.message||"获取用户信息失败")}let s=n.data;return{userId:s.userId,phone:s.phone,userTier:s.userTier||t.UserTier.FREE,sceneUsage:s.sceneUsage||{date:new Date().toLocaleDateString(),count:0},memeUsage:s.memeUsage||{date:new Date().toLocaleDateString(),count:0}}}catch(e){return console.error("Get user info error:",e),{userTier:t.UserTier.FREE,sceneUsage:{date:new Date().toLocaleDateString(),count:0},memeUsage:{date:new Date().toLocaleDateString(),count:0}}}},n=async(e,t=1)=>{try{let o=await r("user",{action:"updateSceneUsage",userId:e,increment:t});if(1!==o.success)throw Error(o.message||"更新场景扩展使用次数失败");return o.data.sceneUsage}catch(e){throw console.error("Update scene usage error:",e),Error(e.message||"更新场景扩展使用次数失败")}},s=async(e,t=1)=>{try{let o=await r("user",{action:"updateMemeUsage",userId:e,increment:t});if(1!==o.success)throw Error(o.message||"更新表情包制作使用次数失败");return o.data.memeUsage}catch(e){throw console.error("Update meme usage error:",e),Error(e.message||"更新表情包制作使用次数失败")}};e.s(["getUserInfo",0,i,"updateMemeUsage",0,s,"updateSceneUsage",0,n],82935)},18486,e=>{"use strict";let t=(0,e.i(57475).default)("crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);e.s(["Crown",()=>t],18486)},68163,e=>{"use strict";let t=(0,e.i(57475).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>t],68163)},68946,e=>{"use strict";let t=(0,e.i(57475).default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);e.s(["Square",()=>t],68946)},83832,e=>{"use strict";let t=(0,e.i(57475).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],83832)},24417,e=>{"use strict";var t=e.i(29336),r=e.i(54558);let o=async(e,o,i,n)=>{try{let s=(0,r.getUserId)(),a=await (0,t.callCloudFunction)("history",{action:"save",userId:s||void 0,type:e,url:o,prompt:i,style:n});if(1!==a.success)return console.error("Failed to save history:",a.message),null;return a.data}catch(e){return console.error("Save history error:",e),null}},i=async e=>{try{let o=(0,r.getUserId)(),i=await (0,t.callCloudFunction)("history",{action:"delete",userId:o||void 0,historyId:e});return 1===i.success}catch(e){return console.error("Delete history error:",e),!1}};e.s(["deleteHistory",0,i,"saveHistory",0,o])},39382,e=>{"use strict";var t=e.i(1972),r=e.i(75305),o=e.i(83832),i=e.i(57475);let n=(0,i.default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),s=(0,i.default)("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);var a=e.i(98844);let c=(0,i.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),u=(0,i.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var l=e.i(64807);let d=e.i(60164).default.env.NEXT_PUBLIC_PAYMENT_API_URL||"https://your-api-domain.com/api/payment",f=async e=>{try{let t=await fetch(`${d}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.message||"创建订单失败")}return await t.json()}catch(e){throw console.error("Create payment order error:",e),e}},v=async e=>{try{let t=await fetch(`${d}/query/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("查询订单失败");return await t.json()}catch(e){throw console.error("Query order status error:",e),e}},p=async(e,t=30,r=2e3)=>{for(let o=0;o<t;o++)try{let t=await v(e);if("SUCCESS"===t.status||"FAILED"===t.status||"CANCELLED"===t.status)return t;await new Promise(e=>setTimeout(e,r))}catch(e){if(console.error(`Poll attempt ${o+1} failed:`,e),o===t-1)throw e;await new Promise(e=>setTimeout(e,r))}throw Error("支付超时，请稍后查询订单状态")};var y=e.i(54558);e.s(["default",0,({isOpen:e,onClose:i,onSuccess:d,amount:v,productName:h,productDesc:g})=>{let[m,k]=(0,r.useState)(null),[x,C]=(0,r.useState)(!1),[b,w]=(0,r.useState)(null),[j,P]=(0,r.useState)("idle");if(!e)return null;let S=async()=>{if(!m)return void w("请选择支付方式");C(!0),w(null),P("processing");try{let e={amount:Math.round(100*v),productName:h,productDesc:g,paymentMethod:m,userId:(0,y.getUserId)()||void 0},{orderId:t,paymentParams:r}=await f(e);if(m===l.PaymentMethod.WECHAT)await new Promise((e,t)=>{window.WeixinJSBridge?window.WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:r.appId,timeStamp:r.timeStamp,nonceStr:r.nonceStr,package:r.package,signType:r.signType,paySign:r.paySign},r=>{"get_brand_wcpay_request:ok"===r.err_msg?e():t(Error(r.err_msg||"支付失败"))}):window.wx?window.wx.chooseWXPay({timestamp:r.timeStamp,nonceStr:r.nonceStr,package:r.package,signType:r.signType,paySign:r.paySign,success:()=>{e()},fail:e=>{t(Error(e.errMsg||"支付失败"))}}):t(Error("请在微信中打开"))});else{let e;m===l.PaymentMethod.ALIPAY&&await (e=r.orderString,new Promise((t,r)=>{let o=document.createElement("form");o.method="POST",o.action="https://openapi.alipay.com/gateway.do",o.style.display="none",new URLSearchParams(e).forEach((e,t)=>{let r=document.createElement("input");r.type="hidden",r.name=t,r.value=e,o.appendChild(r)}),document.body.appendChild(o),o.submit(),t()}))}let o=await p(t);"SUCCESS"===o.status?(P("success"),setTimeout(()=>{d(),O()},1500)):(P("failed"),w("支付失败，请重试"))}catch(e){console.error("Payment error:",e),P("failed"),w(e.message||"支付失败，请重试")}finally{C(!1)}},O=()=>{x||(k(null),w(null),P("idle"),i())};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-md md:max-w-lg mx-4 overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,t.jsxs)("div",{className:"relative bg-gradient-to-r from-violet-600 to-violet-700 p-6 text-white",children:[(0,t.jsx)("button",{onClick:O,disabled:x,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition-colors disabled:opacity-50",children:(0,t.jsx)(o.X,{size:20})}),(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"升级会员"}),(0,t.jsx)("p",{className:"text-violet-100 text-sm mt-1",children:g||"解锁更多功能"})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"text-center py-4 bg-gray-50 rounded-2xl",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500 mb-1",children:"支付金额"}),(0,t.jsxs)("div",{className:"text-4xl font-bold text-gray-900",children:["¥",(0,t.jsx)("span",{children:v.toFixed(2)})]})]}),"idle"===j&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:"选择支付方式"}),(0,t.jsxs)("button",{onClick:()=>k(l.PaymentMethod.WECHAT),disabled:x,className:`w-full p-4 rounded-xl border-2 transition-all flex items-center gap-4 ${m===l.PaymentMethod.WECHAT?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-violet-200"} ${x?"opacity-50 cursor-not-allowed":""}`,children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${m===l.PaymentMethod.WECHAT?"bg-violet-100":"bg-gray-100"}`,children:(0,t.jsx)(s,{size:24,className:m===l.PaymentMethod.WECHAT?"text-violet-600":"text-gray-600"})}),(0,t.jsxs)("div",{className:"flex-1 text-left",children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:"微信支付"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"推荐使用"})]}),m===l.PaymentMethod.WECHAT&&(0,t.jsx)("div",{className:"w-5 h-5 rounded-full bg-violet-600 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]}),(0,t.jsxs)("button",{onClick:()=>k(l.PaymentMethod.ALIPAY),disabled:x,className:`w-full p-4 rounded-xl border-2 transition-all flex items-center gap-4 ${m===l.PaymentMethod.ALIPAY?"border-violet-500 bg-violet-50":"border-gray-200 hover:border-violet-200"} ${x?"opacity-50 cursor-not-allowed":""}`,children:[(0,t.jsx)("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${m===l.PaymentMethod.ALIPAY?"bg-violet-100":"bg-gray-100"}`,children:(0,t.jsx)(n,{size:24,className:m===l.PaymentMethod.ALIPAY?"text-violet-600":"text-gray-600"})}),(0,t.jsxs)("div",{className:"flex-1 text-left",children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:"支付宝"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"安全便捷"})]}),m===l.PaymentMethod.ALIPAY&&(0,t.jsx)("div",{className:"w-5 h-5 rounded-full bg-violet-600 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]})]}),"processing"===j&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[(0,t.jsx)(a.Loader2,{className:"w-12 h-12 text-violet-600 animate-spin"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:"正在处理支付..."}),(0,t.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:"请完成支付操作"})]})]}),"success"===j&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[(0,t.jsx)(c,{className:"w-16 h-16 text-green-500"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900 text-lg",children:"支付成功！"}),(0,t.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:"正在为您升级会员..."})]})]}),"failed"===j&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[(0,t.jsx)(u,{className:"w-16 h-16 text-red-500"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900 text-lg",children:"支付失败"}),(0,t.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:b||"请重试"})]})]}),b&&"idle"===j&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:b}),"idle"===j&&(0,t.jsx)("button",{onClick:S,disabled:!m||x,className:`w-full py-4 rounded-xl font-semibold text-white transition-all flex items-center justify-center gap-2 ${!m||x?"bg-gray-300 cursor-not-allowed":"bg-violet-600 hover:bg-violet-700 active:scale-95"}`,children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.Loader2,{className:"animate-spin",size:18}),"处理中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n,{size:18}),"确认支付 ¥",v.toFixed(2)]})}),"failed"===j&&(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:O,className:"flex-1 py-3 rounded-xl font-semibold border-2 border-gray-200 text-gray-700 hover:bg-gray-50",children:"取消"}),(0,t.jsx)("button",{onClick:()=>{P("idle"),w(null)},className:"flex-1 py-3 rounded-xl font-semibold bg-violet-600 text-white hover:bg-violet-700",children:"重试"})]})]})]})})}],39382)}]);