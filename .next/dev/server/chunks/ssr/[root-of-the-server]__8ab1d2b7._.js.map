{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/lib/cloud.ts"],"sourcesContent":["/**\n * äº‘å‡½æ•°è°ƒç”¨å°è£…ï¼ˆé€šè¿‡ Next.js API è·¯ç”±ï¼‰\n * åœ¨æœåŠ¡ç«¯ä½¿ç”¨ wx-server-sdk è°ƒç”¨äº‘å‡½æ•°\n */\n\n// API åŸºç¡€è·¯å¾„\nconst API_BASE_URL = \"/api/cloud\";\n\n/**\n * è°ƒç”¨äº‘å‡½æ•°ï¼ˆé€šè¿‡ Next.js API è·¯ç”±ï¼‰\n * @param name äº‘å‡½æ•°åç§°\n * @param data ä¼ é€’ç»™äº‘å‡½æ•°çš„æ•°æ®\n * @returns äº‘å‡½æ•°è¿”å›ç»“æœ\n */\nexport const callCloudFunction = async (\n  name: string,\n  data: any = {}\n): Promise<any> => {\n  try {\n    const response = await fetch(`${API_BASE_URL}/${name}`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(data),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      return {\n        success: 0,\n        message: error.message || `HTTP è¯·æ±‚å¤±è´¥: ${response.status}`,\n      };\n    }\n\n    const result = await response.json();\n\n    // å¦‚æœ API è¿”å›çš„ success ä¸æ˜¯ 1ï¼Œè¿”å›å¤±è´¥ç»“æœ\n    if (result.success !== 1) {\n      return {\n        success: 0,\n        message: result.message || \"è°ƒç”¨äº‘å‡½æ•°å¤±è´¥\",\n      };\n    }\n\n    // æˆåŠŸæ—¶è¿”å›åŒ…å« success: 1 çš„ç»“æœ\n    return {\n      success: 1,\n      ...result,\n    };\n  } catch (error: any) {\n    console.error(`è°ƒç”¨äº‘å‡½æ•° ${name} å¤±è´¥:`, error);\n    return {\n      success: 0,\n      message: error.message || `è°ƒç”¨äº‘å‡½æ•° ${name} å¤±è´¥`,\n    };\n  }\n};\n"],"names":[],"mappings":"AAAA;;;CAGC,GAED,WAAW;;;;;AACX,MAAM,eAAe;AAQd,MAAM,oBAAoB,OAC/B,MACA,OAAY,CAAC,CAAC;IAEd,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,GAAG,aAAa,CAAC,EAAE,MAAM,EAAE;YACtD,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;YACjC,OAAO;gBACL,SAAS;gBACT,SAAS,MAAM,OAAO,IAAI,CAAC,WAAW,EAAE,SAAS,MAAM,EAAE;YAC3D;QACF;QAEA,MAAM,SAAS,MAAM,SAAS,IAAI;QAElC,iCAAiC;QACjC,IAAI,OAAO,OAAO,KAAK,GAAG;YACxB,OAAO;gBACL,SAAS;gBACT,SAAS,OAAO,OAAO,IAAI;YAC7B;QACF;QAEA,yBAAyB;QACzB,OAAO;YACL,SAAS;YACT,GAAG,MAAM;QACX;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,CAAC,MAAM,EAAE,KAAK,IAAI,CAAC,EAAE;QACnC,OAAO;YACL,SAAS;YACT,SAAS,MAAM,OAAO,IAAI,CAAC,MAAM,EAAE,KAAK,GAAG,CAAC;QAC9C;IACF;AACF"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/lib/cookies.ts"],"sourcesContent":["/**\n * Cookie å·¥å…·å‡½æ•°\n * ç”¨äºæŒä¹…åŒ–ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼ˆåªå­˜å‚¨ç”¨æˆ·IDï¼‰\n */\n\nimport { getCookie, setCookie, deleteCookie } from 'cookies-next';\n\n// Cookie é”®å\nconst USER_ID_KEY = 'ip_creative_user_id';\n\n// Cookie é€‰é¡¹ï¼ˆ30å¤©è¿‡æœŸï¼‰\nconst COOKIE_OPTIONS = {\n  maxAge: 60 * 60 * 24 * 30, // 30å¤©\n  path: '/',\n  sameSite: 'lax' as const,\n} as const;\n\n/**\n * ä¿å­˜ç”¨æˆ·IDåˆ° cookie\n */\nexport const setUserId = (userId: string) => {\n  setCookie(USER_ID_KEY, userId, COOKIE_OPTIONS);\n};\n\n/**\n * ä» cookie è·å–ç”¨æˆ·ID\n */\nexport const getUserId = (): string | null => {\n  const userId = getCookie(USER_ID_KEY);\n  return userId ? String(userId) : null;\n};\n\n/**\n * æ¸…é™¤ç”¨æˆ·ID cookie\n */\nexport const clearUserId = () => {\n  deleteCookie(USER_ID_KEY);\n};\n\n/**\n * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼ˆé€šè¿‡ cookieï¼‰\n */\nexport const isAuthenticated = (): boolean => {\n  return !!getUserId();\n};\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;AAED;;AAEA,YAAY;AACZ,MAAM,cAAc;AAEpB,mBAAmB;AACnB,MAAM,iBAAiB;IACrB,QAAQ,KAAK,KAAK,KAAK;IACvB,MAAM;IACN,UAAU;AACZ;AAKO,MAAM,YAAY,CAAC;IACxB,IAAA,sXAAS,EAAC,aAAa,QAAQ;AACjC;AAKO,MAAM,YAAY;IACvB,MAAM,SAAS,IAAA,sXAAS,EAAC;IACzB,OAAO,SAAS,OAAO,UAAU;AACnC;AAKO,MAAM,cAAc;IACzB,IAAA,yXAAY,EAAC;AACf;AAKO,MAAM,kBAAkB;IAC7B,OAAO,CAAC,CAAC;AACX"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/services/userService.ts"],"sourcesContent":["import { UserTier, DailyUsage } from \"@/types\";\nimport { callCloudFunction } from \"@/lib/cloud\";\nimport { getUserId } from \"@/lib/cookies\";\n\nexport interface UserInfo {\n  userId?: string;\n  phone?: string;\n  userTier: UserTier;\n  sceneUsage: DailyUsage;\n  memeUsage: DailyUsage;\n}\n\n/**\n * è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…æ‹¬ä½¿ç”¨æ¬¡æ•°ï¼‰\n * @param userId ç”¨æˆ·IDï¼ˆå¯é€‰ï¼Œå¦‚æœä¸æä¾›åˆ™ä» localStorage æˆ– cookie è·å–ï¼‰\n * @returns ç”¨æˆ·ä¿¡æ¯\n */\nexport const getUserInfo = async (userId?: string): Promise<UserInfo> => {\n  try {\n    // å¦‚æœæ²¡æœ‰æä¾› userIdï¼Œå°è¯•ä» cookie è·å–\n    const storedUserId = userId || getUserId();\n\n    if (!storedUserId) {\n      return {\n        userTier: UserTier.FREE,\n        sceneUsage: { date: new Date().toLocaleDateString(), count: 0 },\n        memeUsage: { date: new Date().toLocaleDateString(), count: 0 },\n      };\n    }\n\n    const result = await callCloudFunction(\"user\", {\n      action: \"getInfo\",\n      userId: storedUserId,\n    });\n\n    // å¤„ç†äº‘å‡½æ•°è¿”å›ç»“æœï¼ˆAPI è·¯ç”±ç›´æ¥è¿”å› { success, data }ï¼‰\n    const response = result;\n\n    if (response.success !== 1) {\n      if (response.message === \"ç”¨æˆ·ä¸å­˜åœ¨\") {\n        return {\n          userTier: UserTier.FREE,\n          sceneUsage: { date: new Date().toLocaleDateString(), count: 0 },\n          memeUsage: { date: new Date().toLocaleDateString(), count: 0 },\n        };\n      }\n      throw new Error(response.message || \"è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥\");\n    }\n\n    const data = response.data;\n\n    return {\n      userId: data.userId,\n      phone: data.phone,\n      userTier: data.userTier || UserTier.FREE,\n      sceneUsage: data.sceneUsage || {\n        date: new Date().toLocaleDateString(),\n        count: 0,\n      },\n      memeUsage: data.memeUsage || {\n        date: new Date().toLocaleDateString(),\n        count: 0,\n      },\n    };\n  } catch (error) {\n    console.error(\"Get user info error:\", error);\n    // è¿”å›é»˜è®¤å€¼è€Œä¸æ˜¯æŠ›å‡ºé”™è¯¯ï¼Œç¡®ä¿åº”ç”¨å¯ä»¥ç»§ç»­è¿è¡Œ\n    return {\n      userTier: UserTier.FREE,\n      sceneUsage: { date: new Date().toLocaleDateString(), count: 0 },\n      memeUsage: { date: new Date().toLocaleDateString(), count: 0 },\n    };\n  }\n};\n\n/**\n * æ›´æ–°åœºæ™¯æ‰©å±•ä½¿ç”¨æ¬¡æ•°\n * @param userId ç”¨æˆ·ID\n * @param increment å¢åŠ çš„æ•°é‡ï¼ˆé»˜è®¤ä¸º 1ï¼‰\n * @returns æ›´æ–°åçš„ä½¿ç”¨æ¬¡æ•°\n */\nexport const updateSceneUsage = async (\n  userId: string,\n  increment: number = 1\n): Promise<DailyUsage> => {\n  try {\n    const result = await callCloudFunction(\"user\", {\n      action: \"updateSceneUsage\",\n      userId,\n      increment,\n    });\n\n    // å¤„ç†äº‘å‡½æ•°è¿”å›ç»“æœï¼ˆAPI è·¯ç”±ç›´æ¥è¿”å› { success, data }ï¼‰\n    const response = result;\n\n    if (response.success !== 1) {\n      throw new Error(response.message || \"æ›´æ–°åœºæ™¯æ‰©å±•ä½¿ç”¨æ¬¡æ•°å¤±è´¥\");\n    }\n\n    return response.data.sceneUsage;\n  } catch (error: any) {\n    console.error(\"Update scene usage error:\", error);\n    throw new Error(error.message || \"æ›´æ–°åœºæ™¯æ‰©å±•ä½¿ç”¨æ¬¡æ•°å¤±è´¥\");\n  }\n};\n\n/**\n * æ›´æ–°è¡¨æƒ…åŒ…åˆ¶ä½œä½¿ç”¨æ¬¡æ•°\n * @param userId ç”¨æˆ·ID\n * @param increment å¢åŠ çš„æ•°é‡ï¼ˆé»˜è®¤ä¸º 1ï¼‰\n * @returns æ›´æ–°åçš„ä½¿ç”¨æ¬¡æ•°\n */\nexport const updateMemeUsage = async (\n  userId: string,\n  increment: number = 1\n): Promise<DailyUsage> => {\n  try {\n    const result = await callCloudFunction(\"user\", {\n      action: \"updateMemeUsage\",\n      userId,\n      increment,\n    });\n\n    // å¤„ç†äº‘å‡½æ•°è¿”å›ç»“æœï¼ˆAPI è·¯ç”±ç›´æ¥è¿”å› { success, data }ï¼‰\n    const response = result;\n\n    if (response.success !== 1) {\n      throw new Error(response.message || \"æ›´æ–°è¡¨æƒ…åŒ…åˆ¶ä½œä½¿ç”¨æ¬¡æ•°å¤±è´¥\");\n    }\n\n    return response.data.memeUsage;\n  } catch (error: any) {\n    console.error(\"Update meme usage error:\", error);\n    throw new Error(error.message || \"æ›´æ–°è¡¨æƒ…åŒ…åˆ¶ä½œä½¿ç”¨æ¬¡æ•°å¤±è´¥\");\n  }\n};\n\n/**\n * æ›´æ–°ç”¨æˆ·ä¼šå‘˜ç­‰çº§\n * @param userId ç”¨æˆ·ID\n * @param userTier æ–°çš„ä¼šå‘˜ç­‰çº§\n * @returns æ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯\n */\nexport const updateUserTier = async (\n  userId: string,\n  userTier: UserTier\n): Promise<UserInfo> => {\n  try {\n    const result = await callCloudFunction(\"user\", {\n      action: \"updateTier\",\n      userId,\n      userTier,\n    });\n\n    // å¤„ç†äº‘å‡½æ•°è¿”å›ç»“æœï¼ˆAPI è·¯ç”±ç›´æ¥è¿”å› { success, data }ï¼‰\n    const response = result;\n\n    if (response.success !== 1) {\n      throw new Error(response.message || \"æ›´æ–°ä¼šå‘˜ç­‰çº§å¤±è´¥\");\n    }\n\n    const data = response.data;\n    return {\n      userId: data.userId,\n      userTier: data.userTier,\n      sceneUsage: data.sceneUsage,\n      memeUsage: data.memeUsage,\n    };\n  } catch (error: any) {\n    console.error(\"Update user tier error:\", error);\n    throw new Error(error.message || \"æ›´æ–°ä¼šå‘˜ç­‰çº§å¤±è´¥\");\n  }\n};\n\n/**\n * åˆ›å»ºæˆ–åˆå§‹åŒ–ç”¨æˆ·\n * @returns ç”¨æˆ·ä¿¡æ¯\n */\nexport const createOrInitUser = async (): Promise<UserInfo> => {\n  try {\n    // é€šè¿‡ API è·¯ç”±è°ƒç”¨ï¼ˆå¦‚æœéœ€è¦å®ç°åˆå§‹åŒ–åŠŸèƒ½ï¼‰\n    const result = await callCloudFunction(\"user\", {\n      action: \"init\",\n    });\n\n    const response = result;\n\n    if (response.success !== 1) {\n      throw new Error(response.message || \"åˆå§‹åŒ–ç”¨æˆ·å¤±è´¥\");\n    }\n\n    const data = response.data;\n\n    // ä¿å­˜ userId åˆ° cookieï¼ˆå¦‚æœéœ€è¦ï¼‰\n    if (data.userId) {\n      const { setUserId } = await import(\"@/lib/cookies\");\n      setUserId(data.userId);\n    }\n\n    return {\n      userId: data.userId,\n      userTier: data.userTier || UserTier.FREE,\n      sceneUsage: data.sceneUsage || {\n        date: new Date().toLocaleDateString(),\n        count: 0,\n      },\n      memeUsage: data.memeUsage || {\n        date: new Date().toLocaleDateString(),\n        count: 0,\n      },\n    };\n  } catch (error: any) {\n    console.error(\"Create or init user error:\", error);\n    throw new Error(error.message || \"åˆå§‹åŒ–ç”¨æˆ·å¤±è´¥\");\n  }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 278, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/services/historyService.ts"],"sourcesContent":["/**\n * å†å²è®°å½•æœåŠ¡\n * ç”¨äºä¿å­˜å’Œè·å–ç”¨æˆ·çš„åˆ›ä½œå†å²\n */\n\nimport { GeneratedImage } from '@/types';\nimport { callCloudFunction } from '@/lib/cloud';\nimport { getUserId } from '@/lib/cookies';\n\nexport interface HistoryItem extends GeneratedImage {\n  userId?: string;\n  type: 'scene' | 'meme'; // åœºæ™¯æ‰©å±•æˆ–è¡¨æƒ…åŒ…\n  createdAt?: Date;\n}\n\nexport interface SaveHistoryRequest {\n  userId?: string;\n  type: 'scene' | 'meme';\n  url: string;\n  prompt: string;\n  style?: string;\n}\n\n/**\n * ä¿å­˜å†å²è®°å½•åˆ°æ•°æ®åº“\n */\nexport const saveHistory = async (\n  type: 'scene' | 'meme',\n  url: string,\n  prompt: string,\n  style?: string\n): Promise<HistoryItem | null> => {\n  try {\n    const userId = getUserId();\n\n    const result = await callCloudFunction('history', {\n      action: 'save',\n      userId: userId || undefined,\n      type,\n      url,\n      prompt,\n      style,\n    });\n\n    if (result.success !== 1) {\n      console.error('Failed to save history:', result.message);\n      return null;\n    }\n\n    return result.data;\n  } catch (error) {\n    console.error('Save history error:', error);\n    return null;\n  }\n};\n\n/**\n * è·å–ç”¨æˆ·çš„å†å²è®°å½•åˆ—è¡¨\n */\nexport const getHistory = async (\n  userId?: string,\n  limit: number = 50\n): Promise<HistoryItem[]> => {\n  try {\n    const targetUserId = userId || getUserId();\n\n    if (!targetUserId) {\n      return [];\n    }\n\n    const result = await callCloudFunction('history', {\n      action: 'getList',\n      userId: targetUserId,\n      limit,\n    });\n\n    if (result.success !== 1) {\n      console.error('Failed to get history:', result.message);\n      return [];\n    }\n\n    return result.data || [];\n  } catch (error) {\n    console.error('Get history error:', error);\n    return [];\n  }\n};\n\n/**\n * åˆ é™¤å†å²è®°å½•\n */\nexport const deleteHistory = async (historyId: string): Promise<boolean> => {\n  try {\n    const userId = getUserId();\n\n    const result = await callCloudFunction('history', {\n      action: 'delete',\n      userId: userId || undefined,\n      historyId,\n    });\n\n    return result.success === 1;\n  } catch (error) {\n    console.error('Delete history error:', error);\n    return false;\n  }\n};\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AAGD;AACA;;;AAmBO,MAAM,cAAc,OACzB,MACA,KACA,QACA;IAEA,IAAI;QACF,MAAM,SAAS,IAAA,2HAAS;QAExB,MAAM,SAAS,MAAM,IAAA,iIAAiB,EAAC,WAAW;YAChD,QAAQ;YACR,QAAQ,UAAU;YAClB;YACA;YACA;YACA;QACF;QAEA,IAAI,OAAO,OAAO,KAAK,GAAG;YACxB,QAAQ,KAAK,CAAC,2BAA2B,OAAO,OAAO;YACvD,OAAO;QACT;QAEA,OAAO,OAAO,IAAI;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;IACT;AACF;AAKO,MAAM,aAAa,OACxB,QACA,QAAgB,EAAE;IAElB,IAAI;QACF,MAAM,eAAe,UAAU,IAAA,2HAAS;QAExC,IAAI,CAAC,cAAc;YACjB,OAAO,EAAE;QACX;QAEA,MAAM,SAAS,MAAM,IAAA,iIAAiB,EAAC,WAAW;YAChD,QAAQ;YACR,QAAQ;YACR;QACF;QAEA,IAAI,OAAO,OAAO,KAAK,GAAG;YACxB,QAAQ,KAAK,CAAC,0BAA0B,OAAO,OAAO;YACtD,OAAO,EAAE;QACX;QAEA,OAAO,OAAO,IAAI,IAAI,EAAE;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,EAAE;IACX;AACF;AAKO,MAAM,gBAAgB,OAAO;IAClC,IAAI;QACF,MAAM,SAAS,IAAA,2HAAS;QAExB,MAAM,SAAS,MAAM,IAAA,iIAAiB,EAAC,WAAW;YAChD,QAAQ;YACR,QAAQ,UAAU;YAClB;QACF;QAEA,OAAO,OAAO,OAAO,KAAK;IAC5B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;IACT;AACF"}},
    {"offset": {"line": 353, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/services/geminiService.ts"],"sourcesContent":["// ä½¿ç”¨ Next.js API è·¯ç”±ä»£ç† Gemini API è°ƒç”¨ï¼ˆæœåŠ¡ç«¯ï¼‰\nconst API_BASE_URL = \"/api/gemini/generate\";\n\n/**\n * Resize image if it exceeds max dimensions to prevent API errors.\n */\nconst resizeImage = async (\n  base64Str: string,\n  maxWidth = 1024,\n  maxHeight = 1024\n): Promise<string> => {\n  return new Promise((resolve) => {\n    const img = new Image();\n    img.src = base64Str;\n    img.onload = () => {\n      let width = img.width;\n      let height = img.height;\n\n      if (width <= maxWidth && height <= maxHeight) {\n        resolve(base64Str);\n        return;\n      }\n\n      if (width > height) {\n        if (width > maxWidth) {\n          height = Math.round((height *= maxWidth / width));\n          width = maxWidth;\n        }\n      } else {\n        if (height > maxHeight) {\n          width = Math.round((width *= maxHeight / height));\n          height = maxHeight;\n        }\n      }\n\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = width;\n      canvas.height = height;\n      const ctx = canvas.getContext(\"2d\");\n      ctx?.drawImage(img, 0, 0, width, height);\n      resolve(canvas.toDataURL(\"image/jpeg\", 0.9)); // Use JPEG 0.9 for reasonable quality/size\n    };\n    img.onerror = () => resolve(base64Str); // Fallback\n  });\n};\n\n/**\n * Generates a new image based on an input image and a text prompt using Gemini 2.5 Flash Image.\n */\nexport const generateExtendedScene = async (\n  base64Image: string,\n  mimeType: string,\n  prompt: string,\n  aspectRatio?: string,\n  imageSize?: \"1K\" | \"2K\" | \"4K\",\n  imageFormat?: \"PNG\" | \"JPEG\" | \"WEBP\"\n): Promise<string> => {\n  try {\n    // Optimize image size before sending\n    const optimizedImage = await resizeImage(base64Image);\n\n    // æå– mimeTypeï¼ˆä¿ç•™åŸå§‹æ ¼å¼ä¿¡æ¯ï¼‰\n    let detectedMimeType = \"image/jpeg\";\n    if (base64Image.startsWith(\"data:image/png\")) {\n      detectedMimeType = \"image/png\";\n    } else if (base64Image.startsWith(\"data:image/webp\")) {\n      detectedMimeType = \"image/webp\";\n    } else if (\n      base64Image.startsWith(\"data:image/jpeg\") ||\n      base64Image.startsWith(\"data:image/jpg\")\n    ) {\n      detectedMimeType = \"image/jpeg\";\n    }\n\n    const cleanBase64 = optimizedImage.replace(\n      /^data:image\\/(png|jpeg|jpg|webp);base64,/,\n      \"\"\n    );\n\n    // éªŒè¯ base64 æ•°æ®\n    if (!cleanBase64 || cleanBase64.length === 0) {\n      throw new Error(\"Invalid base64 image data\");\n    }\n\n    const generationConfig: any = {\n      responseModalities: [\"IMAGE\"],\n    };\n\n    // Add imageConfig if aspectRatio, imageSize, or imageFormat is provided\n    if (aspectRatio || imageSize || imageFormat) {\n      generationConfig.imageConfig = {};\n      if (aspectRatio) {\n        // aspectRatio æ ¼å¼ï¼šä¾‹å¦‚ \"16:9\", \"1:1\" ç­‰\n        generationConfig.imageConfig.aspectRatio = aspectRatio;\n      }\n      // æš‚æ—¶æ³¨é‡Šæ‰ imageSize çš„è®¾ç½®\n      // if (imageSize) {\n      //   // imageSize æ ¼å¼ï¼šå¯èƒ½æ˜¯ \"1K\", \"2K\", \"4K\" æˆ–å…¶ä»–æ ¼å¼\n      //   generationConfig.imageConfig.imageSize = imageSize;\n      // }\n      if (imageFormat) {\n        // outputFormat éœ€è¦å°å†™ï¼šä¾‹å¦‚ \"png\", \"jpeg\", \"webp\"\n        generationConfig.imageConfig.outputFormat = imageFormat.toLowerCase();\n      }\n    }\n\n    const requestBody = {\n      contents: [\n        {\n          parts: [\n            {\n              inlineData: {\n                data: cleanBase64,\n                mimeType: detectedMimeType,\n              },\n            },\n            {\n              text: prompt,\n            },\n          ],\n        },\n      ],\n      generationConfig,\n    };\n\n    const response = await fetch(API_BASE_URL, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(requestBody),\n    });\n\n    if (!response.ok) {\n      let errorMessage = `API request failed: ${response.status} ${response.statusText}`;\n      try {\n        const errorData = await response.json();\n        console.error(\"Gemini API Error:\", errorData);\n        console.error(\n          \"Request generationConfig:\",\n          JSON.stringify(generationConfig, null, 2)\n        );\n\n        // æå–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯\n        if (errorData.error) {\n          const error = errorData.error;\n          errorMessage =\n            error.message ||\n            error.localized_message ||\n            JSON.stringify(error) ||\n            errorMessage;\n        } else {\n          errorMessage = JSON.stringify(errorData) || errorMessage;\n        }\n      } catch (e) {\n        const errorText = await response.text();\n        console.error(\"Gemini API Error (text):\", errorText);\n        errorMessage = errorText || errorMessage;\n      }\n      throw new Error(errorMessage);\n    }\n\n    const data = await response.json();\n    const parts = data.candidates?.[0]?.content?.parts;\n    if (!parts) {\n      throw new Error(\"No content generated\");\n    }\n\n    for (const part of parts) {\n      if (part.inlineData && part.inlineData.data) {\n        const outputMimeType = part.inlineData.mimeType || \"image/png\";\n        return `data:${outputMimeType};base64,${part.inlineData.data}`;\n      }\n    }\n\n    throw new Error(\"No image data found in the response\");\n  } catch (error) {\n    console.error(\"Gemini API Error:\", error);\n    throw error;\n  }\n};\n\n/**\n * Generates a meme/sticker version of the input image.\n */\nexport const generateSticker = async (\n  base64Image: string,\n  moodPrompt: string\n): Promise<string> => {\n  try {\n    // Optimize image size before sending\n    const optimizedImage = await resizeImage(base64Image);\n    const cleanBase64 = optimizedImage.replace(\n      /^data:image\\/(png|jpeg|webp);base64,/,\n      \"\"\n    );\n\n    const fullPrompt = `Turn the main character in this image into a high-quality die-cut sticker. \n    Style: Vector art, flat color, thick white outline, white background. \n    Expression/Action: ${moodPrompt}. \n    Ensure the character is isolated on a pure white background. \n    Do not add text inside the image.`;\n\n    const requestBody = {\n      contents: [\n        {\n          parts: [\n            {\n              inlineData: {\n                data: cleanBase64,\n                mimeType: \"image/jpeg\",\n              },\n            },\n            {\n              text: fullPrompt,\n            },\n          ],\n        },\n      ],\n      generationConfig: {\n        responseModalities: [\"IMAGE\"],\n      },\n    };\n\n    const response = await fetch(API_BASE_URL, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(requestBody),\n    });\n\n    if (!response.ok) {\n      let errorMessage: string;\n      try {\n        const errorData = await response.json();\n        errorMessage =\n          errorData.error || errorData.details || JSON.stringify(errorData);\n      } catch {\n        errorMessage = `API request failed: ${response.status} ${response.statusText}`;\n      }\n      throw new Error(errorMessage);\n    }\n\n    const data = await response.json();\n    const parts = data.candidates?.[0]?.content?.parts;\n    if (!parts) throw new Error(\"No content generated\");\n\n    for (const part of parts) {\n      if (part.inlineData && part.inlineData.data) {\n        const outputMimeType = part.inlineData.mimeType || \"image/png\";\n        return `data:${outputMimeType};base64,${part.inlineData.data}`;\n      }\n    }\n    throw new Error(\"No image data found\");\n  } catch (error) {\n    console.error(\"Sticker Generation Error:\", error);\n    throw error;\n  }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 565, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/lib/constants.tsx"],"sourcesContent":["'use client';\n\nimport { Square, Activity, RefreshCcw } from 'lucide-react';\nimport { AnimationType } from '@/types';\n\nexport const PRESET_STYLES = [\n  {\n    id: 'realistic',\n    label: 'å†™å®æ‘„å½±',\n    value:\n      'photorealistic, 8k, highly detailed, cinematic lighting, realistic textures',\n  },\n  {\n    id: 'anime',\n    label: 'æ—¥ç³»åŠ¨æ¼«',\n    value:\n      'anime style, studio ghibli, vibrant colors, cel shading, detailed background',\n  },\n  {\n    id: 'watercolor',\n    label: 'æ¸…æ–°æ°´å½©',\n    value: 'watercolor painting, soft edges, artistic, pastel colors, dreamy atmosphere',\n  },\n  {\n    id: 'cyberpunk',\n    label: 'èµ›åšæœ‹å…‹',\n    value: 'cyberpunk, neon lights, futuristic city, high contrast, tech noir',\n  },\n  {\n    id: '3d',\n    label: '3D æ¸²æŸ“',\n    value:\n      '3D render, blender, unreal engine 5, c4d, clay material, soft lighting',\n  },\n  {\n    id: 'illustration',\n    label: 'æ‰å¹³æ’ç”»',\n    value: 'flat illustration, vector art, minimal, clean lines, bold colors',\n  },\n  {\n    id: 'oil',\n    label: 'æ²¹ç”»é£æ ¼',\n    value:\n      'oil painting, textured brushstrokes, classical art style, van gogh style',\n  },\n  {\n    id: 'pixel',\n    label: 'åƒç´ è‰ºæœ¯',\n    value: 'pixel art, 8-bit, retro game style, blocky',\n  },\n];\n\nexport const MOOD_PACKS = [\n  { id: 'custom', label: 'è‡ªå®šä¹‰', items: [] },\n  {\n    id: 'worker',\n    label: 'æ‰“å·¥äºº',\n    items: [\n      { text: 'æ”¶åˆ°', prompt: 'æ•¬ç¤¼ï¼Œçœ¼ç¥åšå®šï¼Œæˆ´ç€é¢†å¸¦ï¼ŒèŒä¸šæ„Ÿ' },\n      { text: 'ä¸‹ç­', prompt: 'é£å¿«åœ°é€ƒè·‘ï¼Œå¼€å¿ƒï¼Œæ¨¡ç³Šçš„èƒŒæ™¯' },\n      { text: 'å¤ªéš¾äº†', prompt: 'èººåœ¨åœ°ä¸Šï¼Œç²¾ç–²åŠ›å°½ï¼Œæµç€å¤¸å¼ çš„çœ¼æ³ª' },\n      { text: 'æ‘¸é±¼', prompt: 'å–ç€å’–å•¡ï¼Œæˆ´ç€å¢¨é•œï¼Œæ‚ é—²æ”¾æ¾' },\n    ],\n  },\n  {\n    id: 'daily',\n    label: 'æ—¥å¸¸',\n    items: [\n      { text: 'æ—©ä¸Šå¥½', prompt: 'æŒ¥æ‰‹ï¼Œå¼€å¿ƒå¤§ç¬‘ï¼Œé˜³å…‰èƒŒæ™¯' },\n      { text: 'æ™šå®‰', prompt: 'ç¡è§‰ï¼Œæˆ´ç€ç¡å¸½ï¼Œå®‰è¯¦' },\n      { text: 'è°¢è°¢', prompt: 'é èº¬ï¼ŒåŒæ‰‹æ¯”å¿ƒï¼Œæ„Ÿæ¿€' },\n      { text: 'ï¼Ÿ', prompt: 'å›°æƒ‘çš„è¡¨æƒ…ï¼Œæ»¡å¤´é—®å·' },\n    ],\n  },\n];\n\nexport const ANIMATION_OPTIONS = [\n  { id: AnimationType.NONE, label: 'é™æ€', icon: <Square size={14} /> },\n  { id: AnimationType.SHAKE, label: 'é¢¤æŠ–', icon: <Activity size={14} /> },\n  {\n    id: AnimationType.PULSE,\n    label: 'è„‰å†²',\n    icon: <div className=\"w-3 h-3 rounded-full border-2 border-current\"></div>,\n  },\n  {\n    id: AnimationType.ZOOM,\n    label: 'æ”¾å¤§',\n    icon: <div className=\"text-xs\">ğŸ”</div>,\n  },\n  { id: AnimationType.SPIN, label: 'æ—‹è½¬', icon: <RefreshCcw size={14} /> },\n];\n\nexport const STORAGE_KEY = 'ip_creative_history_v1';\nexport const USER_TIER_KEY = 'ip_creative_user_tier';\nexport const DAILY_USAGE_KEY = 'ip_creative_daily_usage';\nexport const MAX_HISTORY_ITEMS = 10;\nexport const FREE_DAILY_LIMIT = 5;\nexport const PREMIUM_DAILY_LIMIT = 50;\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAEA;AAAA;AAAA;AACA;AAHA;;;;AAKO,MAAM,gBAAgB;IAC3B;QACE,IAAI;QACJ,OAAO;QACP,OACE;IACJ;IACA;QACE,IAAI;QACJ,OAAO;QACP,OACE;IACJ;IACA;QACE,IAAI;QACJ,OAAO;QACP,OAAO;IACT;IACA;QACE,IAAI;QACJ,OAAO;QACP,OAAO;IACT;IACA;QACE,IAAI;QACJ,OAAO;QACP,OACE;IACJ;IACA;QACE,IAAI;QACJ,OAAO;QACP,OAAO;IACT;IACA;QACE,IAAI;QACJ,OAAO;QACP,OACE;IACJ;IACA;QACE,IAAI;QACJ,OAAO;QACP,OAAO;IACT;CACD;AAEM,MAAM,aAAa;IACxB;QAAE,IAAI;QAAU,OAAO;QAAO,OAAO,EAAE;IAAC;IACxC;QACE,IAAI;QACJ,OAAO;QACP,OAAO;YACL;gBAAE,MAAM;gBAAM,QAAQ;YAAmB;YACzC;gBAAE,MAAM;gBAAM,QAAQ;YAAiB;YACvC;gBAAE,MAAM;gBAAO,QAAQ;YAAoB;YAC3C;gBAAE,MAAM;gBAAM,QAAQ;YAAiB;SACxC;IACH;IACA;QACE,IAAI;QACJ,OAAO;QACP,OAAO;YACL;gBAAE,MAAM;gBAAO,QAAQ;YAAe;YACtC;gBAAE,MAAM;gBAAM,QAAQ;YAAa;YACnC;gBAAE,MAAM;gBAAM,QAAQ;YAAa;YACnC;gBAAE,MAAM;gBAAK,QAAQ;YAAa;SACnC;IACH;CACD;AAEM,MAAM,oBAAoB;IAC/B;QAAE,IAAI,sHAAa,CAAC,IAAI;QAAE,OAAO;QAAM,oBAAM,+YAAC,oSAAM;YAAC,MAAM;;;;;;IAAO;IAClE;QAAE,IAAI,sHAAa,CAAC,KAAK;QAAE,OAAO;QAAM,oBAAM,+YAAC,0SAAQ;YAAC,MAAM;;;;;;IAAO;IACrE;QACE,IAAI,sHAAa,CAAC,KAAK;QACvB,OAAO;QACP,oBAAM,+YAAC;YAAI,WAAU;;;;;;IACvB;IACA;QACE,IAAI,sHAAa,CAAC,IAAI;QACtB,OAAO;QACP,oBAAM,+YAAC;YAAI,WAAU;sBAAU;;;;;;IACjC;IACA;QAAE,IAAI,sHAAa,CAAC,IAAI;QAAE,OAAO;QAAM,oBAAM,+YAAC,oTAAU;YAAC,MAAM;;;;;;IAAO;CACvE;AAEM,MAAM,cAAc;AACpB,MAAM,gBAAgB;AACtB,MAAM,kBAAkB;AACxB,MAAM,oBAAoB;AAC1B,MAAM,mBAAmB;AACzB,MAAM,sBAAsB"}},
    {"offset": {"line": 755, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/components/Loader.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { Loader2, Sparkles } from 'lucide-react';\n\ninterface LoaderProps {\n  message?: string;\n}\n\nconst Loader: React.FC<LoaderProps> = ({ message = \"æ­£åœ¨ç”Ÿæˆåˆ›æ„...\" }) => {\n  return (\n    <div className=\"flex flex-col items-center justify-center space-y-4 p-8 text-center\">\n      <div className=\"relative\">\n        <div className=\"absolute inset-0 bg-violet-500 blur-xl opacity-20 rounded-full animate-pulse\"></div>\n        <Loader2 className=\"relative text-violet-600 w-12 h-12 animate-spin\" />\n      </div>\n      <div className=\"space-y-2\">\n        <h3 className=\"text-lg font-semibold text-gray-800 flex items-center justify-center gap-2\">\n          <Sparkles className=\"w-4 h-4 text-amber-400\" />\n          AI æ­£åœ¨æ€è€ƒ\n        </h3>\n        <p className=\"text-sm text-gray-500 max-w-xs mx-auto\">{message}</p>\n      </div>\n    </div>\n  );\n};\n\nexport default Loader;"],"names":[],"mappings":";;;;;AAGA;AAAA;AAHA;;;AASA,MAAM,SAAgC,CAAC,EAAE,UAAU,WAAW,EAAE;IAC9D,qBACE,+YAAC;QAAI,WAAU;;0BACb,+YAAC;gBAAI,WAAU;;kCACb,+YAAC;wBAAI,WAAU;;;;;;kCACf,+YAAC,gTAAO;wBAAC,WAAU;;;;;;;;;;;;0BAErB,+YAAC;gBAAI,WAAU;;kCACb,+YAAC;wBAAG,WAAU;;0CACZ,+YAAC,0SAAQ;gCAAC,WAAU;;;;;;4BAA2B;;;;;;;kCAGjD,+YAAC;wBAAE,WAAU;kCAA0C;;;;;;;;;;;;;;;;;;AAI/D;uCAEe"}},
    {"offset": {"line": 838, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/services/paymentService.ts"],"sourcesContent":["import { PaymentMethod, CreateOrderRequest, CreateOrderResponse, PaymentOrder } from '../types';\n\n// é…ç½®ï¼šåç«¯ API åœ°å€\n// è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ä¸ºä½ çš„åç«¯ API åœ°å€\n// Next.js ç¯å¢ƒå˜é‡éœ€è¦ä»¥ NEXT_PUBLIC_ å¼€å¤´æ‰èƒ½åœ¨å®¢æˆ·ç«¯è®¿é—®\nconst PAYMENT_API_BASE_URL = process.env.NEXT_PUBLIC_PAYMENT_API_URL || 'https://your-api-domain.com/api/payment';\n\n/**\n * åˆ›å»ºæ”¯ä»˜è®¢å•\n * @param request è®¢å•è¯·æ±‚å‚æ•°\n * @returns æ”¯ä»˜å‚æ•°ï¼ˆç”¨äºè°ƒèµ·æ”¯ä»˜ï¼‰\n */\nexport const createPaymentOrder = async (\n  request: CreateOrderRequest\n): Promise<CreateOrderResponse> => {\n  try {\n    const response = await fetch(`${PAYMENT_API_BASE_URL}/create`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(request),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.message || 'åˆ›å»ºè®¢å•å¤±è´¥');\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Create payment order error:', error);\n    throw error;\n  }\n};\n\n/**\n * æŸ¥è¯¢è®¢å•çŠ¶æ€\n * @param orderId è®¢å•ID\n * @returns è®¢å•ä¿¡æ¯\n */\nexport const queryOrderStatus = async (orderId: string): Promise<PaymentOrder> => {\n  try {\n    const response = await fetch(`${PAYMENT_API_BASE_URL}/query/${orderId}`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error('æŸ¥è¯¢è®¢å•å¤±è´¥');\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Query order status error:', error);\n    throw error;\n  }\n};\n\n/**\n * è°ƒèµ·å¾®ä¿¡æ”¯ä»˜\n * @param params å¾®ä¿¡æ”¯ä»˜å‚æ•°\n * @returns Promise<void>\n */\nexport const launchWechatPay = (params: {\n  appId: string;\n  timeStamp: string;\n  nonceStr: string;\n  package: string;\n  signType: string;\n  paySign: string;\n}): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    // æ£€æŸ¥æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒ\n    if (typeof window === 'undefined' || !(window as any).WeixinJSBridge) {\n      // å¦‚æœä¸åœ¨å¾®ä¿¡ç¯å¢ƒï¼Œå°è¯•ä½¿ç”¨ JSSDK\n      if ((window as any).wx) {\n        // ä½¿ç”¨å¾®ä¿¡ JSSDK è°ƒèµ·æ”¯ä»˜\n        (window as any).wx.chooseWXPay({\n          timestamp: params.timeStamp,\n          nonceStr: params.nonceStr,\n          package: params.package,\n          signType: params.signType,\n          paySign: params.paySign,\n          success: () => {\n            resolve();\n          },\n          fail: (err: any) => {\n            reject(new Error(err.errMsg || 'æ”¯ä»˜å¤±è´¥'));\n          },\n        });\n      } else {\n        reject(new Error('è¯·åœ¨å¾®ä¿¡ä¸­æ‰“å¼€'));\n      }\n      return;\n    }\n\n    // ä½¿ç”¨ WeixinJSBridge è°ƒèµ·æ”¯ä»˜\n    (window as any).WeixinJSBridge.invoke(\n      'getBrandWCPayRequest',\n      {\n        appId: params.appId,\n        timeStamp: params.timeStamp,\n        nonceStr: params.nonceStr,\n        package: params.package,\n        signType: params.signType,\n        paySign: params.paySign,\n      },\n      (res: any) => {\n        if (res.err_msg === 'get_brand_wcpay_request:ok') {\n          resolve();\n        } else {\n          reject(new Error(res.err_msg || 'æ”¯ä»˜å¤±è´¥'));\n        }\n      }\n    );\n  });\n};\n\n/**\n * è°ƒèµ·æ”¯ä»˜å®æ”¯ä»˜\n * @param orderString æ”¯ä»˜å®è®¢å•å­—ç¬¦ä¸²\n * @returns Promise<void>\n */\nexport const launchAlipay = (orderString: string): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    // åˆ›å»ºéšè—çš„è¡¨å•å¹¶æäº¤\n    const form = document.createElement('form');\n    form.method = 'POST';\n    form.action = 'https://openapi.alipay.com/gateway.do';\n    form.style.display = 'none';\n\n    // è§£æ orderString å¹¶åˆ›å»ºè¡¨å•å­—æ®µ\n    // orderString æ ¼å¼é€šå¸¸æ˜¯ï¼šapp_id=xxx&biz_content=xxx&charset=xxx&...\n    const params = new URLSearchParams(orderString);\n    params.forEach((value, key) => {\n      const input = document.createElement('input');\n      input.type = 'hidden';\n      input.name = key;\n      input.value = value;\n      form.appendChild(input);\n    });\n\n    document.body.appendChild(form);\n    form.submit();\n\n    // æ³¨æ„ï¼šæ”¯ä»˜å®æ”¯ä»˜åä¼šåœ¨æ–°çª—å£æ‰“å¼€ï¼Œæ— æ³•ç›´æ¥ç›‘å¬ç»“æœ\n    // éœ€è¦é€šè¿‡è½®è¯¢è®¢å•çŠ¶æ€æ¥ç¡®è®¤æ”¯ä»˜ç»“æœ\n    resolve();\n  });\n};\n\n/**\n * è½®è¯¢è®¢å•çŠ¶æ€ç›´åˆ°æ”¯ä»˜å®Œæˆæˆ–è¶…æ—¶\n * @param orderId è®¢å•ID\n * @param maxAttempts æœ€å¤§å°è¯•æ¬¡æ•°\n * @param interval è½®è¯¢é—´éš”ï¼ˆæ¯«ç§’ï¼‰\n * @returns è®¢å•çŠ¶æ€\n */\nexport const pollOrderStatus = async (\n  orderId: string,\n  maxAttempts = 30,\n  interval = 2000\n): Promise<PaymentOrder> => {\n  for (let i = 0; i < maxAttempts; i++) {\n    try {\n      const order = await queryOrderStatus(orderId);\n      if (order.status === 'SUCCESS' || order.status === 'FAILED' || order.status === 'CANCELLED') {\n        return order;\n      }\n      // ç­‰å¾…åç»§ç»­è½®è¯¢\n      await new Promise((resolve) => setTimeout(resolve, interval));\n    } catch (error) {\n      console.error(`Poll attempt ${i + 1} failed:`, error);\n      if (i === maxAttempts - 1) {\n        throw error;\n      }\n      await new Promise((resolve) => setTimeout(resolve, interval));\n    }\n  }\n  throw new Error('æ”¯ä»˜è¶…æ—¶ï¼Œè¯·ç¨åæŸ¥è¯¢è®¢å•çŠ¶æ€');\n};\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 968, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/components/PaymentModal.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport { X, CreditCard, Smartphone, Loader2, CheckCircle, XCircle } from 'lucide-react';\nimport { PaymentMethod, CreateOrderRequest } from '@/types';\nimport { createPaymentOrder, launchWechatPay, launchAlipay, pollOrderStatus } from '@/services/paymentService';\nimport { getUserId } from '@/lib/cookies';\n\ninterface PaymentModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  amount: number; // é‡‘é¢ï¼ˆå…ƒï¼‰\n  productName: string;\n  productDesc?: string;\n}\n\nconst PaymentModal: React.FC<PaymentModalProps> = ({\n  isOpen,\n  onClose,\n  onSuccess,\n  amount,\n  productName,\n  productDesc,\n}) => {\n  const [selectedMethod, setSelectedMethod] = useState<PaymentMethod | null>(null);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [paymentStatus, setPaymentStatus] = useState<'idle' | 'processing' | 'success' | 'failed'>('idle');\n\n  if (!isOpen) return null;\n\n  const handlePayment = async () => {\n    if (!selectedMethod) {\n      setError('è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼');\n      return;\n    }\n\n    setIsProcessing(true);\n    setError(null);\n    setPaymentStatus('processing');\n\n    try {\n      // 1. åˆ›å»ºè®¢å•\n      const request: CreateOrderRequest = {\n        amount: Math.round(amount * 100), // è½¬æ¢ä¸ºåˆ†\n        productName,\n        productDesc,\n        paymentMethod: selectedMethod,\n        userId: getUserId() || undefined, // å¦‚æœæœ‰ç”¨æˆ·ID\n      };\n\n      const orderResponse = await createPaymentOrder(request);\n      const { orderId, paymentParams } = orderResponse;\n\n      // 2. è°ƒèµ·æ”¯ä»˜\n      if (selectedMethod === PaymentMethod.WECHAT) {\n        await launchWechatPay(paymentParams as any);\n      } else if (selectedMethod === PaymentMethod.ALIPAY) {\n        await launchAlipay((paymentParams as any).orderString);\n      }\n\n      // 3. è½®è¯¢è®¢å•çŠ¶æ€\n      const order = await pollOrderStatus(orderId);\n\n      if (order.status === 'SUCCESS') {\n        setPaymentStatus('success');\n        setTimeout(() => {\n          onSuccess();\n          handleClose();\n        }, 1500);\n      } else {\n        setPaymentStatus('failed');\n        setError('æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•');\n      }\n    } catch (err: any) {\n      console.error('Payment error:', err);\n      setPaymentStatus('failed');\n      setError(err.message || 'æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (!isProcessing) {\n      setSelectedMethod(null);\n      setError(null);\n      setPaymentStatus('idle');\n      onClose();\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200 p-4\">\n      <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md md:max-w-lg mx-4 overflow-hidden animate-in zoom-in-95 duration-200\">\n        {/* Header */}\n        <div className=\"relative bg-gradient-to-r from-violet-600 to-violet-700 p-6 text-white\">\n          <button\n            onClick={handleClose}\n            disabled={isProcessing}\n            className=\"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition-colors disabled:opacity-50\"\n          >\n            <X size={20} />\n          </button>\n          <h2 className=\"text-2xl font-bold\">å‡çº§ä¼šå‘˜</h2>\n          <p className=\"text-violet-100 text-sm mt-1\">{productDesc || 'è§£é”æ›´å¤šåŠŸèƒ½'}</p>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 space-y-6\">\n          {/* Amount Display */}\n          <div className=\"text-center py-4 bg-gray-50 rounded-2xl\">\n            <div className=\"text-sm text-gray-500 mb-1\">æ”¯ä»˜é‡‘é¢</div>\n            <div className=\"text-4xl font-bold text-gray-900\">\n              Â¥<span>{amount.toFixed(2)}</span>\n            </div>\n          </div>\n\n          {/* Payment Methods */}\n          {paymentStatus === 'idle' && (\n            <div className=\"space-y-3\">\n              <div className=\"text-sm font-semibold text-gray-700 mb-2\">é€‰æ‹©æ”¯ä»˜æ–¹å¼</div>\n              \n              <button\n                onClick={() => setSelectedMethod(PaymentMethod.WECHAT)}\n                disabled={isProcessing}\n                className={`w-full p-4 rounded-xl border-2 transition-all flex items-center gap-4 ${\n                  selectedMethod === PaymentMethod.WECHAT\n                    ? 'border-violet-500 bg-violet-50'\n                    : 'border-gray-200 hover:border-violet-200'\n                } ${isProcessing ? 'opacity-50 cursor-not-allowed' : ''}`}\n              >\n                <div className={`w-12 h-12 rounded-lg flex items-center justify-center ${\n                  selectedMethod === PaymentMethod.WECHAT ? 'bg-violet-100' : 'bg-gray-100'\n                }`}>\n                  <Smartphone size={24} className={selectedMethod === PaymentMethod.WECHAT ? 'text-violet-600' : 'text-gray-600'} />\n                </div>\n                <div className=\"flex-1 text-left\">\n                  <div className=\"font-semibold text-gray-900\">å¾®ä¿¡æ”¯ä»˜</div>\n                  <div className=\"text-xs text-gray-500\">æ¨èä½¿ç”¨</div>\n                </div>\n                {selectedMethod === PaymentMethod.WECHAT && (\n                  <div className=\"w-5 h-5 rounded-full bg-violet-600 flex items-center justify-center\">\n                    <div className=\"w-2 h-2 rounded-full bg-white\"></div>\n                  </div>\n                )}\n              </button>\n\n              <button\n                onClick={() => setSelectedMethod(PaymentMethod.ALIPAY)}\n                disabled={isProcessing}\n                className={`w-full p-4 rounded-xl border-2 transition-all flex items-center gap-4 ${\n                  selectedMethod === PaymentMethod.ALIPAY\n                    ? 'border-violet-500 bg-violet-50'\n                    : 'border-gray-200 hover:border-violet-200'\n                } ${isProcessing ? 'opacity-50 cursor-not-allowed' : ''}`}\n              >\n                <div className={`w-12 h-12 rounded-lg flex items-center justify-center ${\n                  selectedMethod === PaymentMethod.ALIPAY ? 'bg-violet-100' : 'bg-gray-100'\n                }`}>\n                  <CreditCard size={24} className={selectedMethod === PaymentMethod.ALIPAY ? 'text-violet-600' : 'text-gray-600'} />\n                </div>\n                <div className=\"flex-1 text-left\">\n                  <div className=\"font-semibold text-gray-900\">æ”¯ä»˜å®</div>\n                  <div className=\"text-xs text-gray-500\">å®‰å…¨ä¾¿æ·</div>\n                </div>\n                {selectedMethod === PaymentMethod.ALIPAY && (\n                  <div className=\"w-5 h-5 rounded-full bg-violet-600 flex items-center justify-center\">\n                    <div className=\"w-2 h-2 rounded-full bg-white\"></div>\n                  </div>\n                )}\n              </button>\n            </div>\n          )}\n\n          {/* Processing Status */}\n          {paymentStatus === 'processing' && (\n            <div className=\"flex flex-col items-center justify-center py-8 space-y-4\">\n              <Loader2 className=\"w-12 h-12 text-violet-600 animate-spin\" />\n              <div className=\"text-center\">\n                <div className=\"font-semibold text-gray-900\">æ­£åœ¨å¤„ç†æ”¯ä»˜...</div>\n                <div className=\"text-sm text-gray-500 mt-1\">è¯·å®Œæˆæ”¯ä»˜æ“ä½œ</div>\n              </div>\n            </div>\n          )}\n\n          {/* Success Status */}\n          {paymentStatus === 'success' && (\n            <div className=\"flex flex-col items-center justify-center py-8 space-y-4\">\n              <CheckCircle className=\"w-16 h-16 text-green-500\" />\n              <div className=\"text-center\">\n                <div className=\"font-semibold text-gray-900 text-lg\">æ”¯ä»˜æˆåŠŸï¼</div>\n                <div className=\"text-sm text-gray-500 mt-1\">æ­£åœ¨ä¸ºæ‚¨å‡çº§ä¼šå‘˜...</div>\n              </div>\n            </div>\n          )}\n\n          {/* Failed Status */}\n          {paymentStatus === 'failed' && (\n            <div className=\"flex flex-col items-center justify-center py-8 space-y-4\">\n              <XCircle className=\"w-16 h-16 text-red-500\" />\n              <div className=\"text-center\">\n                <div className=\"font-semibold text-gray-900 text-lg\">æ”¯ä»˜å¤±è´¥</div>\n                <div className=\"text-sm text-gray-500 mt-1\">{error || 'è¯·é‡è¯•'}</div>\n              </div>\n            </div>\n          )}\n\n          {/* Error Message */}\n          {error && paymentStatus === 'idle' && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm\">\n              {error}\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          {paymentStatus === 'idle' && (\n            <button\n              onClick={handlePayment}\n              disabled={!selectedMethod || isProcessing}\n              className={`w-full py-4 rounded-xl font-semibold text-white transition-all flex items-center justify-center gap-2 ${\n                !selectedMethod || isProcessing\n                  ? 'bg-gray-300 cursor-not-allowed'\n                  : 'bg-violet-600 hover:bg-violet-700 active:scale-95'\n              }`}\n            >\n              {isProcessing ? (\n                <>\n                  <Loader2 className=\"animate-spin\" size={18} />\n                  å¤„ç†ä¸­...\n                </>\n              ) : (\n                <>\n                  <CreditCard size={18} />\n                  ç¡®è®¤æ”¯ä»˜ Â¥{amount.toFixed(2)}\n                </>\n              )}\n            </button>\n          )}\n\n          {paymentStatus === 'failed' && (\n            <div className=\"flex gap-3\">\n              <button\n                onClick={handleClose}\n                className=\"flex-1 py-3 rounded-xl font-semibold border-2 border-gray-200 text-gray-700 hover:bg-gray-50\"\n              >\n                å–æ¶ˆ\n              </button>\n              <button\n                onClick={() => {\n                  setPaymentStatus('idle');\n                  setError(null);\n                }}\n                className=\"flex-1 py-3 rounded-xl font-semibold bg-violet-600 text-white hover:bg-violet-700\"\n              >\n                é‡è¯•\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PaymentModal;\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1497, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/components/QuotaModal.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { X, Zap, LogIn, Crown } from 'lucide-react';\nimport { UserStatus } from '@/store/slices/userSlice';\n\ninterface QuotaModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onLogin?: () => void;\n  onUpgrade?: () => void;\n  userStatus: UserStatus;\n  remainingQuota: number;\n  limit: number;\n  type: 'scene' | 'meme'; // åœºæ™¯æ‰©å±•æˆ–è¡¨æƒ…åŒ…åˆ¶ä½œ\n}\n\nconst QuotaModal: React.FC<QuotaModalProps> = ({\n  isOpen,\n  onClose,\n  onLogin,\n  onUpgrade,\n  userStatus,\n  remainingQuota,\n  limit,\n  type,\n}) => {\n  if (!isOpen) return null;\n\n  const typeText = type === 'scene' ? 'åœºæ™¯æ‰©å±•' : 'è¡¨æƒ…åŒ…åˆ¶ä½œ';\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200\">\n      <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-in zoom-in-95 duration-200\">\n        <div className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center\">\n                <Zap size={24} className=\"text-red-600\" />\n              </div>\n              <h3 className=\"text-xl font-bold text-gray-900\">\n                é¢åº¦ä¸è¶³\n              </h3>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X size={20} className=\"text-gray-500\" />\n            </button>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"bg-gray-50 rounded-2xl p-4\">\n              <div className=\"text-center space-y-2\">\n                <p className=\"text-sm text-gray-600\">å‰©ä½™ {typeText} é¢åº¦</p>\n                <p className=\"text-3xl font-bold text-gray-900\">\n                  {remainingQuota} <span className=\"text-lg text-gray-500\">/ {limit}</span>\n                </p>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              {userStatus === UserStatus.GUEST ? (\n                <>\n                  <p className=\"text-gray-700 text-center\">\n                    æ¸¸å®¢ä½“éªŒæ¬¡æ•°å·²ç”¨å®Œï¼\n                  </p>\n                  <p className=\"text-sm text-gray-500 text-center\">\n                    ç™»å½•åå¯è·å¾—æ¯æ—¥ 5 æ¬¡ {typeText} é¢åº¦\n                  </p>\n                  <button\n                    onClick={() => {\n                      onClose();\n                      onLogin?.();\n                    }}\n                    className=\"w-full py-3 rounded-xl font-semibold bg-violet-600 text-white hover:bg-violet-700 transition-colors flex items-center justify-center gap-2\"\n                  >\n                    <LogIn size={18} />\n                    ç«‹å³ç™»å½•\n                  </button>\n                </>\n              ) : (\n                <>\n                  <p className=\"text-gray-700 text-center\">\n                    {typeText}é¢åº¦ä¸è¶³ï¼\n                  </p>\n                  <p className=\"text-sm text-gray-500 text-center\">\n                    å‡çº§ä¼šå‘˜å¯è·å–æ¯æ—¥ 50 æ¬¡ {typeText} é¢åº¦\n                  </p>\n                  <button\n                    onClick={() => {\n                      onClose();\n                      onUpgrade?.();\n                    }}\n                    className=\"w-full py-3 rounded-xl font-semibold bg-amber-400 text-amber-900 hover:bg-amber-300 transition-colors flex items-center justify-center gap-2 shadow-lg shadow-amber-900/20\"\n                  >\n                    <Crown size={18} />\n                    å‡çº§ä¼šå‘˜\n                  </button>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QuotaModal;\n\n"],"names":[],"mappings":";;;;;AAGA;AAAA;AAAA;AAAA;AACA;AAJA;;;;AAiBA,MAAM,aAAwC,CAAC,EAC7C,MAAM,EACN,OAAO,EACP,OAAO,EACP,SAAS,EACT,UAAU,EACV,cAAc,EACd,KAAK,EACL,IAAI,EACL;IACC,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,WAAW,SAAS,UAAU,SAAS;IAE7C,qBACE,+YAAC;QAAI,WAAU;kBACb,cAAA,+YAAC;YAAI,WAAU;sBACb,cAAA,+YAAC;gBAAI,WAAU;;kCACb,+YAAC;wBAAI,WAAU;;0CACb,+YAAC;gCAAI,WAAU;;kDACb,+YAAC;wCAAI,WAAU;kDACb,cAAA,+YAAC,2RAAG;4CAAC,MAAM;4CAAI,WAAU;;;;;;;;;;;kDAE3B,+YAAC;wCAAG,WAAU;kDAAkC;;;;;;;;;;;;0CAIlD,+YAAC;gCACC,SAAS;gCACT,WAAU;0CAEV,cAAA,+YAAC,qRAAC;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;;;;;;;kCAI3B,+YAAC;wBAAI,WAAU;;0CACb,+YAAC;gCAAI,WAAU;0CACb,cAAA,+YAAC;oCAAI,WAAU;;sDACb,+YAAC;4CAAE,WAAU;;gDAAwB;gDAAI;gDAAS;;;;;;;sDAClD,+YAAC;4CAAE,WAAU;;gDACV;gDAAe;8DAAC,+YAAC;oDAAK,WAAU;;wDAAwB;wDAAG;;;;;;;;;;;;;;;;;;;;;;;;0CAKlE,+YAAC;gCAAI,WAAU;0CACZ,eAAe,0IAAU,CAAC,KAAK,iBAC9B;;sDACE,+YAAC;4CAAE,WAAU;sDAA4B;;;;;;sDAGzC,+YAAC;4CAAE,WAAU;;gDAAoC;gDACjC;gDAAS;;;;;;;sDAEzB,+YAAC;4CACC,SAAS;gDACP;gDACA;4CACF;4CACA,WAAU;;8DAEV,+YAAC,qSAAK;oDAAC,MAAM;;;;;;gDAAM;;;;;;;;iEAKvB;;sDACE,+YAAC;4CAAE,WAAU;;gDACV;gDAAS;;;;;;;sDAEZ,+YAAC;4CAAE,WAAU;;gDAAoC;gDAC/B;gDAAS;;;;;;;sDAE3B,+YAAC;4CACC,SAAS;gDACP;gDACA;4CACF;4CACA,WAAU;;8DAEV,+YAAC,iSAAK;oDAAC,MAAM;;;;;;gDAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWvC;uCAEe"}},
    {"offset": {"line": 1782, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/app/meme-editor/page.tsx"],"sourcesContent":["'use client';\n\nimport { useRouter } from 'next/navigation';\nimport { useEffect } from 'react';\nimport { ChevronLeft, Layers, Play, Smile, Wand2, Package, Loader2, Square, Activity, RefreshCcw, Zap } from 'lucide-react';\nimport { useAppSelector, useAppDispatch } from '@/store/hooks';\nimport { updateMemeDraft, setActiveDraftIndex, setSelectedMoodPack, setIsExporting } from '@/store/slices/memeSlice';\nimport { updateMemeUsage, setMemeUsage } from '@/store/slices/userSlice';\nimport { updateMemeUsage as updateMemeUsageAPI } from '@/services/userService';\nimport { saveHistory } from '@/services/historyService';\nimport { setIsPaymentModalOpen, setIsQuotaModalOpen } from '@/store/slices/appSlice';\nimport { setUserTier } from '@/store/slices/userSlice';\nimport { UserTier } from '@/types';\nimport { generateSticker } from '@/services/geminiService';\nimport { MOOD_PACKS, ANIMATION_OPTIONS } from '@/lib/constants';\nimport { getTodayDateString, normalizeDateString } from '@/lib/date-utils';\nimport { AnimationType } from '@/types';\nimport Loader from '@/components/Loader';\nimport PaymentModal from '@/components/PaymentModal';\nimport QuotaModal from '@/components/QuotaModal';\nimport JSZip from 'jszip';\n\ndeclare global {\n  interface Window {\n    gifshot?: any;\n  }\n}\n\nexport default function MemeEditorPage() {\n  const router = useRouter();\n  const dispatch = useAppDispatch();\n  const memeDrafts = useAppSelector((state) => state.meme.memeDrafts);\n  const activeDraftIndex = useAppSelector((state) => state.meme.activeDraftIndex);\n  const selectedMoodPack = useAppSelector((state) => state.meme.selectedMoodPack);\n  const isExporting = useAppSelector((state) => state.meme.isExporting);\n  const memeUsage = useAppSelector((state) => state.user.memeUsage);\n  const userStatus = useAppSelector((state) => state.user.status);\n  const userId = useAppSelector((state) => state.user.userId);\n  const userTier = useAppSelector((state) => state.user.userTier);\n  const isPaymentModalOpen = useAppSelector((state) => state.app.isPaymentModalOpen);\n  const isQuotaModalOpen = useAppSelector((state) => state.app.isQuotaModalOpen);\n\n  const activeDraft = memeDrafts[activeDraftIndex];\n  const pendingCount = memeDrafts.filter(\n    (d) => d.status === 'pending' || d.status === 'error'\n  ).length;\n\n  const GUEST_DAILY_LIMIT = 1; // æ¸¸å®¢1æ¬¡\n  const FREE_DAILY_LIMIT = 5; // æ™®é€šç”¨æˆ·5æ¬¡\n  const PREMIUM_DAILY_LIMIT = 50; // ä¼šå‘˜50æ¬¡\n\n  const getLimit = () => {\n    if (userTier === 'PREMIUM') return PREMIUM_DAILY_LIMIT;\n    if (userStatus === 'LOGGED_IN') return FREE_DAILY_LIMIT;\n    return GUEST_DAILY_LIMIT; // æ¸¸å®¢\n  };\n  const isQuotaReached = (amount = 1) => {\n    const today = getTodayDateString();\n    const usageDate = normalizeDateString(memeUsage.date);\n    if (usageDate !== today) return false;\n    return memeUsage.count + amount > getLimit();\n  };\n  const remainingQuota = () => {\n    const today = getTodayDateString();\n    const usageDate = normalizeDateString(memeUsage.date);\n    if (usageDate !== today) return getLimit();\n    return Math.max(0, getLimit() - memeUsage.count);\n  };\n\n  // Animation Preview Class\n  let animClass = '';\n  if (activeDraft?.animation === AnimationType.SHAKE) animClass = 'animate-shake';\n  if (activeDraft?.animation === AnimationType.PULSE) animClass = 'animate-pulse-fast';\n  if (activeDraft?.animation === AnimationType.ZOOM) animClass = 'animate-zoom';\n  if (activeDraft?.animation === AnimationType.SPIN) animClass = 'animate-spin-slow';\n\n  const applyMoodPack = (packId: string) => {\n    dispatch(setSelectedMoodPack(packId));\n    if (packId === 'custom') return;\n\n    const pack = MOOD_PACKS.find((p) => p.id === packId);\n    if (!pack) return;\n\n    // æ‰¹é‡æ›´æ–°æ‰€æœ‰è‰ç¨¿\n    memeDrafts.forEach((draft, idx) => {\n      const moodItem = pack.items[idx % pack.items.length];\n      dispatch(updateMemeDraft({ \n        index: idx, \n        draft: {\n          text: moodItem.text,\n          moodPrompt: moodItem.prompt,\n          status: 'pending' as const,\n        }\n      }));\n    });\n  };\n\n  const handleGenerateMemes = async () => {\n    if (pendingCount === 0) return;\n\n    // å…ˆæ£€æŸ¥æ¬¡æ•°\n    if (isQuotaReached(pendingCount)) {\n      dispatch(setIsQuotaModalOpen(true));\n      return;\n    }\n\n    // Update UI to generating\n    memeDrafts.forEach((draft, idx) => {\n      if (draft.status === 'pending' || draft.status === 'error') {\n        dispatch(updateMemeDraft({ index: idx, draft: { status: 'generating' } }));\n      }\n    });\n\n    // Process one by one\n    for (let i = 0; i < memeDrafts.length; i++) {\n      const draft = memeDrafts[i];\n      if (draft.status !== 'pending' && draft.status !== 'error') continue;\n\n      try {\n        const resultUrl = await generateSticker(draft.sourceUrl, draft.moodPrompt);\n        dispatch(updateMemeDraft({ \n          index: i, \n          draft: { generatedUrl: resultUrl, status: 'done' } \n        }));\n        // è¡¨æƒ…åŒ…ç”ŸæˆæˆåŠŸï¼Œå¢åŠ ä½¿ç”¨æ¬¡æ•°\n        dispatch(updateMemeUsage(1));\n        \n        // å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼ŒåŒæ­¥åˆ°åç«¯\n        if (userStatus === 'LOGGED_IN' && userId) {\n          try {\n            const updatedUsage = await updateMemeUsageAPI(userId, 1);\n            dispatch(setMemeUsage(updatedUsage));\n          } catch (error) {\n            console.error('Failed to sync meme usage to backend:', error);\n          }\n        }\n\n        // ä¿å­˜å†å²è®°å½•åˆ°æ•°æ®åº“\n        await saveHistory(\n          'meme',\n          resultUrl,\n          draft.moodPrompt || draft.text,\n          undefined\n        );\n      } catch (e) {\n        dispatch(updateMemeDraft({ index: i, draft: { status: 'error' } }));\n      }\n    }\n  };\n\n  const createGif = async (draft: typeof activeDraft, width = 240, height = 240): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      if (draft.animation === AnimationType.NONE || !draft.generatedUrl) {\n        resolve(draft.generatedUrl || '');\n        return;\n      }\n\n      const frames: string[] = [];\n      const numFrames = 10;\n      const canvas = document.createElement('canvas');\n      canvas.width = width;\n      canvas.height = height;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.src = draft.generatedUrl;\n\n      img.onload = () => {\n        ctx.font = 'bold 24px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n\n        const drawFrame = (frameIndex: number) => {\n          ctx.clearRect(0, 0, width, height);\n          ctx.save();\n\n          let scale = 1;\n          let tx = 0;\n          let rotate = 0;\n          const t = frameIndex / numFrames;\n\n          if (draft.animation === AnimationType.SHAKE) {\n            const offset = 4;\n            if (frameIndex % 2 === 0) {\n              tx = offset; rotate = 2;\n            } else {\n              tx = -offset; rotate = -2;\n            }\n          } else if (draft.animation === AnimationType.PULSE) {\n            scale = 1 + Math.sin(t * Math.PI * 2) * 0.1;\n          } else if (draft.animation === AnimationType.ZOOM) {\n            scale = 1 + t * 0.2;\n          } else if (draft.animation === AnimationType.SPIN) {\n            rotate = t * 360;\n          }\n\n          ctx.translate(width / 2, height / 2);\n          ctx.rotate((rotate * Math.PI) / 180);\n          ctx.scale(scale, scale);\n          ctx.translate(-width / 2, -height / 2);\n\n          const scaleFactor = Math.min(width / img.width, 200 / img.height);\n          const w = img.width * scaleFactor;\n          const h = img.height * scaleFactor;\n          const x = (width - w) / 2;\n          const y = (200 - h) / 2;\n\n          ctx.drawImage(img, x, y, w, h);\n\n          ctx.fillStyle = 'white';\n          ctx.strokeStyle = 'black';\n          ctx.lineWidth = 4;\n          ctx.strokeText(draft.text, 120, 220);\n          ctx.fillText(draft.text, 120, 220);\n\n          frames.push(canvas.toDataURL('image/png'));\n        };\n\n        for (let i = 0; i < numFrames; i++) {\n          drawFrame(i);\n        }\n\n        if (typeof window.gifshot !== 'undefined') {\n          window.gifshot.createGIF(\n            {\n              images: frames,\n              gifWidth: width,\n              gifHeight: height,\n              interval: 0.1,\n              numFrames: numFrames,\n            },\n            (obj: any) => {\n              if (!obj.error) {\n                resolve(obj.image);\n              } else {\n                reject(obj.errorMsg);\n              }\n            }\n          );\n        } else {\n          reject('gifshot library not loaded');\n        }\n      };\n    });\n  };\n\n  const exportWeChatPackage = async () => {\n    dispatch(setIsExporting(true));\n    try {\n      const zip = new JSZip();\n      const completedDrafts = memeDrafts.filter((d) => d.status === 'done' && d.generatedUrl);\n\n      if (completedDrafts.length === 0) {\n        alert('æ²¡æœ‰å¯å¯¼å‡ºçš„è¡¨æƒ…åŒ…');\n        dispatch(setIsExporting(false));\n        return;\n      }\n\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n\n      canvas.width = 240;\n      canvas.height = 240;\n\n      for (let i = 0; i < completedDrafts.length; i++) {\n        const draft = completedDrafts[i];\n        if (draft.animation !== AnimationType.NONE) {\n          try {\n            const gifBase64 = await createGif(draft);\n            const base64Data = gifBase64.split(',')[1];\n            zip.file(`sticker_${i + 1}.gif`, base64Data, { base64: true });\n          } catch (e) {\n            console.error('GIF creation failed', e);\n          }\n        } else {\n          const img = new Image();\n          img.crossOrigin = 'anonymous';\n          img.src = draft.generatedUrl!;\n\n          await new Promise((resolve) => {\n            img.onload = () => {\n              ctx.clearRect(0, 0, 240, 240);\n              const scale = Math.min(240 / img.width, 200 / img.height);\n              const w = img.width * scale;\n              const h = img.height * scale;\n              const x = (240 - w) / 2;\n              const y = (200 - h) / 2;\n              ctx.drawImage(img, x, y, w, h);\n              ctx.font = 'bold 24px sans-serif';\n              ctx.textAlign = 'center';\n              ctx.fillStyle = 'white';\n              ctx.strokeStyle = 'black';\n              ctx.lineWidth = 4;\n              ctx.strokeText(draft.text, 120, 220);\n              ctx.fillText(draft.text, 120, 220);\n              const dataUrl = canvas.toDataURL('image/png');\n              const base64Data = dataUrl.split(',')[1];\n              zip.file(`sticker_${i + 1}.png`, base64Data, { base64: true });\n              resolve(null);\n            };\n          });\n        }\n      }\n\n      zip.file('README.txt', 'è¿™äº›è¡¨æƒ…åŒ…ç”± IP åˆ›æƒ³åŠ AI ç”Ÿæˆã€‚\\nGIF å»ºè®®ç›´æ¥å‘é€ç»™æ–‡ä»¶åŠ©æ‰‹å†æ·»åŠ è¡¨æƒ…ã€‚');\n      const content = await zip.generateAsync({ type: 'blob' });\n      const url = URL.createObjectURL(content);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `meme-pack-${Date.now()}.zip`;\n      a.click();\n      URL.revokeObjectURL(url);\n    } catch (e) {\n      console.error('Export failed', e);\n      alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');\n    } finally {\n      dispatch(setIsExporting(false));\n    }\n  };\n\n  // å¦‚æœæ²¡æœ‰è‰ç¨¿ï¼Œé‡å®šå‘åˆ°é¦–é¡µ\n  useEffect(() => {\n    if (memeDrafts.length === 0) {\n      router.push('/');\n    }\n  }, [memeDrafts.length, router]);\n\n  if (!activeDraft || memeDrafts.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center space-y-4\">\n          <p className=\"text-gray-500\">æœªæ‰¾åˆ°è¡¨æƒ…åŒ…è‰ç¨¿</p>\n          <button\n            onClick={() => router.push('/')}\n            className=\"px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors\"\n          >\n            è¿”å›é¦–é¡µ\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col min-h-screen bg-gray-50 pb-24 md:pt-16\">\n      <header className=\"bg-white px-4 md:hidden py-3 sticky top-0 z-10 shadow-sm border-b border-gray-100 flex items-center justify-between\">\n        <button\n          onClick={() => router.push('/profile')}\n          className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n        >\n          <ChevronLeft size={24} className=\"text-gray-600\" />\n        </button>\n        <h2 className=\"font-bold text-lg text-gray-800\">è¡¨æƒ…åŒ…å·¥åŠ</h2>\n        <div className=\"w-8\"></div>\n      </header>\n\n      <div className=\"flex-1 p-6 md:p-12 space-y-6 overflow-y-auto max-w-6xl mx-auto w-full\">\n        {/* é¢åº¦æ˜¾ç¤º */}\n        <div className=\"flex items-center justify-end mb-2\">\n          <div\n            className={`flex items-center gap-2 text-sm font-medium px-4 py-2 rounded-full border ${\n              isQuotaReached()\n                ? 'bg-red-50 text-red-600 border-red-200'\n                : 'bg-violet-50 text-violet-700 border-violet-200'\n            }`}\n          >\n            <Zap size={16} fill=\"currentColor\" />\n            <span className=\"font-semibold\">\n              è¡¨æƒ…åŒ…ï¼š{remainingQuota()} / {getLimit()}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"md:grid md:grid-cols-2 md:gap-8 md:items-start\">\n          {/* Left Column - Preview Area */}\n          <div className=\"space-y-6\">\n            <div className=\"bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-gray-100 p-6 md:p-8 flex flex-col items-center justify-center relative md:rounded-2xl md:shadow-sm\">\n              <div className=\"w-64 h-64 md:w-80 md:h-80 lg:w-96 lg:h-96 bg-white rounded-lg shadow-xl border-4 border-white relative flex items-center justify-center\">\n                <div className={`w-full h-full relative overflow-hidden ${animClass}`}>\n                  {activeDraft.generatedUrl ? (\n                    <>\n                      <img src={activeDraft.generatedUrl} className=\"w-full h-full object-contain p-4\" />\n                      <div className=\"absolute bottom-4 left-0 right-0 text-center pointer-events-none\">\n                        <span className=\"text-2xl font-bold text-white stroke-black drop-shadow-md\" style={{ textShadow: '2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000' }}>\n                          {activeDraft.text}\n                        </span>\n                      </div>\n                    </>\n                  ) : (\n                    <div className=\"text-center p-4 opacity-50\">\n                      <img src={activeDraft.sourceUrl} className=\"w-full h-full object-contain opacity-30 blur-sm\" />\n                      <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <span className=\"bg-gray-800 text-white px-3 py-1 rounded-full text-xs\">ç­‰å¾…ç”Ÿæˆ</span>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                {activeDraft.status === 'generating' && (\n                  <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center z-10 rounded-md\">\n                    <Loader message=\"\" />\n                  </div>\n                )}\n              </div>\n              {memeDrafts.length > 1 && (\n                <div className=\"mt-6 flex gap-2 overflow-x-auto max-w-full p-2 bg-white/50 rounded-xl backdrop-blur-md md:flex-wrap md:justify-center\">\n                  {memeDrafts.map((draft, idx) => (\n                    <div\n                      key={draft.id}\n                      onClick={() => dispatch(setActiveDraftIndex(idx))}\n                      className={`w-12 h-12 md:w-16 md:h-16 rounded-lg border-2 flex-shrink-0 overflow-hidden cursor-pointer relative transition-all hover:scale-105 ${\n                        idx === activeDraftIndex ? 'border-violet-600 ring-2 ring-violet-200' : 'border-gray-200'\n                      }`}\n                    >\n                      <img src={draft.generatedUrl || draft.sourceUrl} className=\"w-full h-full object-cover\" />\n                      {draft.status === 'done' && <div className=\"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border border-white\"></div>}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Right Column - Controls */}\n          <div className=\"space-y-6\">\n            <div className=\"space-y-3\">\n              <label className=\"text-sm font-semibold text-gray-800 ml-1 flex items-center gap-2\">\n                <Smile size={16} className=\"text-violet-500\" /> æƒ…ç»ªå¥—é¤\n              </label>\n              <div className=\"flex gap-2 overflow-x-auto md:flex-wrap md:overflow-x-visible pb-2 no-scrollbar\">\n                {MOOD_PACKS.map((pack) => (\n                  <button\n                    key={pack.id}\n                    onClick={() => applyMoodPack(pack.id)}\n                    className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${\n                      selectedMoodPack === pack.id\n                        ? 'bg-amber-100 text-amber-700 border border-amber-200'\n                        : 'bg-white border border-gray-200 text-gray-600 hover:border-amber-200 hover:bg-gray-50'\n                    }`}\n                  >\n                    {pack.label}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <label className=\"text-sm font-semibold text-gray-800 ml-1 flex items-center gap-2\">\n                <Play size={16} className=\"text-violet-500\" /> åŠ¨æ€ç‰¹æ•ˆ\n              </label>\n              <div className=\"flex gap-2 flex-wrap\">\n                {ANIMATION_OPTIONS.map((anim) => (\n                  <button\n                    key={anim.id}\n                    onClick={() => {\n                      dispatch(updateMemeDraft({ \n                        index: activeDraftIndex, \n                        draft: { animation: anim.id } \n                      }));\n                    }}\n                    className={`px-3 py-2 rounded-lg text-xs font-medium flex items-center gap-2 border transition-colors whitespace-nowrap ${\n                      activeDraft.animation === anim.id\n                        ? 'bg-violet-50 border-violet-500 text-violet-700 shadow-sm ring-1 ring-violet-200'\n                        : 'bg-white border-gray-200 text-gray-600 hover:border-violet-200 hover:bg-gray-50'\n                    }`}\n                  >\n                    {anim.icon}\n                    {anim.label}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <label className=\"text-sm font-semibold text-gray-800 ml-1 flex items-center gap-2\">\n                <Layers size={16} className=\"text-violet-500\" /> è¡¨æƒ…æ–‡æ¡ˆ\n              </label>\n              <input\n                type=\"text\"\n                value={activeDraft.text}\n                onChange={(e) => {\n                  dispatch(updateMemeDraft({ \n                    index: activeDraftIndex, \n                    draft: { text: e.target.value } \n                  }));\n                }}\n                className=\"w-full p-4 rounded-2xl border border-gray-200 bg-white focus:ring-2 focus:ring-violet-500 focus:border-transparent outline-none text-gray-700 shadow-sm text-sm\"\n              />\n            </div>\n\n            <div className=\"space-y-3\">\n              <label className=\"text-sm font-semibold text-gray-800 ml-1 flex items-center gap-2\">\n                <Wand2 size={16} className=\"text-violet-500\" /> åŠ¨ä½œæŒ‡ä»¤\n              </label>\n              <input\n                type=\"text\"\n                value={activeDraft.moodPrompt}\n                placeholder=\"ä¾‹å¦‚ï¼šå¤§ç¬‘ã€æŒ¥æ‰‹\"\n                onChange={(e) => {\n                  dispatch(updateMemeDraft({ \n                    index: activeDraftIndex, \n                    draft: { \n                      moodPrompt: e.target.value,\n                      status: 'pending'\n                    } \n                  }));\n                }}\n                className=\"w-full p-4 rounded-2xl border border-gray-200 bg-white focus:ring-2 focus:ring-violet-500 focus:border-transparent outline-none text-gray-700 shadow-sm text-sm\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"px-6 md:px-12 pb-4 pt-2 bg-gradient-to-t from-gray-50 to-transparent max-w-6xl mx-auto w-full\">\n        {pendingCount > 0 ? (\n          <>\n            <button\n              onClick={handleGenerateMemes}\n              disabled={isQuotaReached(pendingCount)}\n              className={`w-full py-4 rounded-2xl font-semibold shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95 ${\n                isQuotaReached(pendingCount)\n                  ? 'bg-gray-200 text-gray-400 cursor-not-allowed'\n                  : 'bg-violet-600 text-white shadow-violet-200 hover:bg-violet-700'\n              }`}\n            >\n              <Wand2 size={18} />\n              {isQuotaReached(pendingCount) \n                ? 'è¡¨æƒ…åŒ…åˆ¶ä½œé¢åº¦å·²ç”¨å®Œ' \n                : memeDrafts.length > 1 \n                  ? `ç”Ÿæˆå…¨éƒ¨ (${pendingCount})` \n                  : 'ç”Ÿæˆè¡¨æƒ…'}\n            </button>\n            {isQuotaReached(pendingCount) && (\n              <p\n                onClick={() => dispatch(setIsPaymentModalOpen(true))}\n                className=\"text-center text-xs text-violet-600 mt-2 cursor-pointer hover:underline\"\n              >\n                å‡çº§ä¼šå‘˜è·å–æ›´å¤šè¡¨æƒ…åŒ…åˆ¶ä½œé¢åº¦ &rarr;\n              </p>\n            )}\n          </>\n        ) : (\n          <button\n            onClick={exportWeChatPackage}\n            disabled={isExporting}\n            className={`w-full py-4 rounded-2xl font-semibold shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95 ${\n              isExporting\n                ? 'bg-green-400 cursor-wait text-white'\n                : 'bg-green-500 text-white shadow-green-200 hover:bg-green-600'\n            }`}\n          >\n            {isExporting ? (\n              <Loader2 className=\"animate-spin\" size={18} />\n            ) : (\n              <Package size={18} />\n            )}\n            {memeDrafts.length > 1 ? 'å¯¼å‡ºè¡¨æƒ…åŒ… (ZIP)' : 'ä¿å­˜è¡¨æƒ…'}\n          </button>\n        )}\n      </div>\n\n      {/* Payment Modal */}\n      <PaymentModal\n        isOpen={isPaymentModalOpen}\n        onClose={() => dispatch(setIsPaymentModalOpen(false))}\n        onSuccess={() => {\n          dispatch(setUserTier(UserTier.PREMIUM));\n          dispatch(setIsPaymentModalOpen(false));\n        }}\n        amount={29.9}\n        productName=\"IP åˆ›æƒ³åŠä¼šå‘˜\"\n        productDesc=\"è§£é”æ¯æ—¥ 50 æ¬¡åœºæ™¯æ‰©å±•å’Œ 50 æ¬¡è¡¨æƒ…åŒ…åˆ¶ä½œé¢åº¦\"\n      />\n\n      {/* Quota Modal */}\n      <QuotaModal\n        isOpen={isQuotaModalOpen}\n        onClose={() => dispatch(setIsQuotaModalOpen(false))}\n        onLogin={() => router.push('/login')}\n        onUpgrade={() => dispatch(setIsPaymentModalOpen(true))}\n        userStatus={userStatus}\n        remainingQuota={remainingQuota()}\n        limit={getLimit()}\n        type=\"meme\"\n      />\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}