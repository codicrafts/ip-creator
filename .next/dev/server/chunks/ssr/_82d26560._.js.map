{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/app/providers/ReduxProvider.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/providers/ReduxProvider.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/providers/ReduxProvider.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,uYAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAmS,GAChU,iEACA","ignoreList":[0]}},
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/app/providers/ReduxProvider.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/providers/ReduxProvider.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/providers/ReduxProvider.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,uYAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA+Q,GAC5S,6CACA","ignoreList":[0]}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/app/components/TabBarWrapper.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/components/TabBarWrapper.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/TabBarWrapper.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,uYAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAoS,GACjU,kEACA","ignoreList":[0]}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/app/components/TabBarWrapper.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/components/TabBarWrapper.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/TabBarWrapper.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,uYAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAgR,GAC7S,8CACA","ignoreList":[0]}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/types.ts"],"sourcesContent":["export enum AppView {\n  HOME = 'HOME',\n  UPLOAD = 'UPLOAD',\n  EDIT = 'EDIT',\n  RESULT = 'RESULT',\n  PROFILE = 'PROFILE',\n  MEME_EDITOR = 'MEME_EDITOR'\n}\n\nexport interface GeneratedImage {\n  id: string; // Added unique ID\n  url: string;\n  timestamp: number;\n  prompt: string;\n  style?: string; // Optional style info\n}\n\nexport enum LoadingState {\n  IDLE = 'IDLE',\n  UPLOADING = 'UPLOADING',\n  GENERATING = 'GENERATING',\n  ERROR = 'ERROR',\n  SUCCESS = 'SUCCESS'\n}\n\nexport enum UserTier {\n  FREE = 'FREE',\n  PREMIUM = 'PREMIUM'\n}\n\nexport interface DailyUsage {\n  date: string; // YYYY-MM-DD\n  count: number;\n}\n\nexport enum AnimationType {\n  NONE = 'none',\n  SHAKE = 'shake',\n  PULSE = 'pulse',\n  ZOOM = 'zoom',\n  SPIN = 'spin'\n}\n\nexport interface MemeDraft {\n  id: string;\n  sourceUrl: string;\n  generatedUrl: string | null;\n  text: string; // The text overlay\n  moodPrompt: string; // e.g., \"laughing out loud\"\n  status: 'pending' | 'generating' | 'done' | 'error';\n  animation: AnimationType;\n}\n\n// Payment Types\nexport enum PaymentMethod {\n  WECHAT = 'WECHAT',\n  ALIPAY = 'ALIPAY'\n}\n\nexport enum PaymentStatus {\n  PENDING = 'PENDING',\n  SUCCESS = 'SUCCESS',\n  FAILED = 'FAILED',\n  CANCELLED = 'CANCELLED'\n}\n\nexport interface PaymentOrder {\n  orderId: string;\n  amount: number; // 金额（分）\n  productName: string;\n  productDesc?: string;\n  paymentMethod: PaymentMethod;\n  status: PaymentStatus;\n  createdAt: number;\n  paidAt?: number;\n}\n\nexport interface CreateOrderRequest {\n  amount: number; // 金额（分）\n  productName: string;\n  productDesc?: string;\n  paymentMethod: PaymentMethod;\n  userId?: string;\n}\n\nexport interface CreateOrderResponse {\n  orderId: string;\n  paymentParams: WechatPaymentParams | AlipayPaymentParams;\n}\n\n// 微信支付参数\nexport interface WechatPaymentParams {\n  appId: string;\n  timeStamp: string;\n  nonceStr: string;\n  package: string; // prepay_id=xxx\n  signType: string;\n  paySign: string;\n}\n\n// 支付宝支付参数\nexport interface AlipayPaymentParams {\n  orderString: string; // 支付宝订单字符串\n}"],"names":[],"mappings":";;;;;;;;;;;;;;AAAO,IAAA,AAAK,iCAAA;;;;;;;WAAA;;AAiBL,IAAA,AAAK,sCAAA;;;;;;WAAA;;AAQL,IAAA,AAAK,kCAAA;;;WAAA;;AAUL,IAAA,AAAK,uCAAA;;;;;;WAAA;;AAmBL,IAAA,AAAK,uCAAA;;;WAAA;;AAKL,IAAA,AAAK,uCAAA;;;;;WAAA"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/lib/date-utils.ts"],"sourcesContent":["/**\n * 日期工具函数\n * 统一日期格式，避免不同环境下的格式差异\n */\n\n/**\n * 获取今天的日期字符串（格式：YYYY-MM-DD）\n */\nexport function getTodayDateString(): string {\n  const today = new Date();\n  const year = today.getFullYear();\n  const month = String(today.getMonth() + 1).padStart(2, '0');\n  const day = String(today.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * 将日期转换为统一格式（YYYY-MM-DD）\n * 如果输入是字符串，尝试解析并转换\n */\nexport function normalizeDateString(date: string | Date): string {\n  if (date instanceof Date) {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  }\n  \n  // 如果是字符串，尝试解析\n  const dateObj = new Date(date);\n  if (!isNaN(dateObj.getTime())) {\n    const year = dateObj.getFullYear();\n    const month = String(dateObj.getMonth() + 1).padStart(2, '0');\n    const day = String(dateObj.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  }\n  \n  // 如果已经是 YYYY-MM-DD 格式，直接返回\n  if (/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n    return date;\n  }\n  \n  // 尝试解析其他格式（如 M/D/YYYY 或 YYYY/M/D）\n  const parts = date.split(/[\\/\\-]/);\n  if (parts.length === 3) {\n    let year: string, month: string, day: string;\n    \n    // 判断格式：如果第一部分是4位数，则是 YYYY/M/D\n    if (parts[0].length === 4) {\n      year = parts[0];\n      month = parts[1].padStart(2, '0');\n      day = parts[2].padStart(2, '0');\n    } else {\n      // 否则是 M/D/YYYY\n      month = parts[0].padStart(2, '0');\n      day = parts[1].padStart(2, '0');\n      year = parts[2];\n    }\n    \n    return `${year}-${month}-${day}`;\n  }\n  \n  // 如果无法解析，返回原字符串\n  return date;\n}\n\n"],"names":[],"mappings":"AAAA;;;CAGC,GAED;;CAEC;;;;;;AACM,SAAS;IACd,MAAM,QAAQ,IAAI;IAClB,MAAM,OAAO,MAAM,WAAW;IAC9B,MAAM,QAAQ,OAAO,MAAM,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;IACvD,MAAM,MAAM,OAAO,MAAM,OAAO,IAAI,QAAQ,CAAC,GAAG;IAChD,OAAO,GAAG,KAAK,CAAC,EAAE,MAAM,CAAC,EAAE,KAAK;AAClC;AAMO,SAAS,oBAAoB,IAAmB;IACrD,IAAI,gBAAgB,MAAM;QACxB,MAAM,OAAO,KAAK,WAAW;QAC7B,MAAM,QAAQ,OAAO,KAAK,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;QACtD,MAAM,MAAM,OAAO,KAAK,OAAO,IAAI,QAAQ,CAAC,GAAG;QAC/C,OAAO,GAAG,KAAK,CAAC,EAAE,MAAM,CAAC,EAAE,KAAK;IAClC;IAEA,cAAc;IACd,MAAM,UAAU,IAAI,KAAK;IACzB,IAAI,CAAC,MAAM,QAAQ,OAAO,KAAK;QAC7B,MAAM,OAAO,QAAQ,WAAW;QAChC,MAAM,QAAQ,OAAO,QAAQ,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;QACzD,MAAM,MAAM,OAAO,QAAQ,OAAO,IAAI,QAAQ,CAAC,GAAG;QAClD,OAAO,GAAG,KAAK,CAAC,EAAE,MAAM,CAAC,EAAE,KAAK;IAClC;IAEA,2BAA2B;IAC3B,IAAI,sBAAsB,IAAI,CAAC,OAAO;QACpC,OAAO;IACT;IAEA,kCAAkC;IAClC,MAAM,QAAQ,KAAK,KAAK,CAAC;IACzB,IAAI,MAAM,MAAM,KAAK,GAAG;QACtB,IAAI,MAAc,OAAe;QAEjC,8BAA8B;QAC9B,IAAI,KAAK,CAAC,EAAE,CAAC,MAAM,KAAK,GAAG;YACzB,OAAO,KAAK,CAAC,EAAE;YACf,QAAQ,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,GAAG;YAC7B,MAAM,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,GAAG;QAC7B,OAAO;YACL,eAAe;YACf,QAAQ,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,GAAG;YAC7B,MAAM,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,GAAG;YAC3B,OAAO,KAAK,CAAC,EAAE;QACjB;QAEA,OAAO,GAAG,KAAK,CAAC,EAAE,MAAM,CAAC,EAAE,KAAK;IAClC;IAEA,gBAAgB;IAChB,OAAO;AACT"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/lib/server-auth.ts"],"sourcesContent":["/**\n * 服务端认证工具函数\n * 用于在 SSR 侧获取用户信息\n */\n\nimport { cookies } from 'next/headers';\nimport { UserTier, DailyUsage, GeneratedImage } from '@/types';\nimport { UserInfo } from '@/services/userService';\nimport { getTodayDateString } from '@/lib/date-utils';\n\nconst USER_ID_KEY = 'ip_creative_user_id';\n\n/**\n * 在服务端获取用户ID（从 cookie）\n */\nexport async function getServerUserId(): Promise<string | null> {\n  const cookieStore = await cookies();\n  const userId = cookieStore.get(USER_ID_KEY);\n  return userId?.value || null;\n}\n\n/**\n * 在服务端获取用户信息\n * @returns 用户信息\n */\nexport async function getServerUserInfo(): Promise<UserInfo> {\n  try {\n    const userId = await getServerUserId();\n\n    if (!userId) {\n      const today = getTodayDateString();\n      return {\n        userTier: UserTier.FREE,\n        sceneUsage: { date: today, count: 0 },\n        memeUsage: { date: today, count: 0 },\n      };\n    }\n\n    // 直接从数据库获取用户信息（服务端）\n    const { getUserInfoFromDB } = await import('@/lib/db');\n    const userData = await getUserInfoFromDB(userId);\n\n    if (!userData) {\n      const today = getTodayDateString();\n      return {\n        userTier: UserTier.FREE,\n        sceneUsage: { date: today, count: 0 },\n        memeUsage: { date: today, count: 0 },\n      };\n    }\n\n    return userData;\n  } catch (error) {\n    console.error('Get server user info error:', error);\n    const today = getTodayDateString();\n    return {\n      userTier: UserTier.FREE,\n      sceneUsage: { date: today, count: 0 },\n      memeUsage: { date: today, count: 0 },\n    };\n  }\n}\n\n/**\n * 在服务端获取用户历史记录\n * @returns 历史记录列表\n */\nexport async function getServerHistory(): Promise<GeneratedImage[]> {\n  try {\n    const userId = await getServerUserId();\n\n    if (!userId) {\n      return [];\n    }\n\n    // 直接从数据库获取历史记录（服务端）\n    const { getCloudDB } = await import('@/lib/db');\n    const { db } = await getCloudDB();\n\n    const query = db.collection(\"history\")\n      .where({ userId: userId })\n      .orderBy(\"timestamp\", \"desc\")\n      .limit(50);\n\n    const result = await query.get();\n    const historyList = result.data.map((item: any) => ({\n      id: item._id,\n      url: item.url,\n      timestamp: item.timestamp,\n      prompt: item.prompt,\n      style: item.style,\n    }));\n\n    return historyList;\n  } catch (error) {\n    console.error('Get server history error:', error);\n    return [];\n  }\n}\n\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AAED;AACA;AAEA;;;;AAEA,MAAM,cAAc;AAKb,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,yQAAO;IACjC,MAAM,SAAS,YAAY,GAAG,CAAC;IAC/B,OAAO,QAAQ,SAAS;AAC1B;AAMO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM;QAErB,IAAI,CAAC,QAAQ;YACX,MAAM,QAAQ,IAAA,0IAAkB;YAChC,OAAO;gBACL,UAAU,iHAAQ,CAAC,IAAI;gBACvB,YAAY;oBAAE,MAAM;oBAAO,OAAO;gBAAE;gBACpC,WAAW;oBAAE,MAAM;oBAAO,OAAO;gBAAE;YACrC;QACF;QAEA,oBAAoB;QACpB,MAAM,EAAE,iBAAiB,EAAE,GAAG;QAC9B,MAAM,WAAW,MAAM,kBAAkB;QAEzC,IAAI,CAAC,UAAU;YACb,MAAM,QAAQ,IAAA,0IAAkB;YAChC,OAAO;gBACL,UAAU,iHAAQ,CAAC,IAAI;gBACvB,YAAY;oBAAE,MAAM;oBAAO,OAAO;gBAAE;gBACpC,WAAW;oBAAE,MAAM;oBAAO,OAAO;gBAAE;YACrC;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM,QAAQ,IAAA,0IAAkB;QAChC,OAAO;YACL,UAAU,iHAAQ,CAAC,IAAI;YACvB,YAAY;gBAAE,MAAM;gBAAO,OAAO;YAAE;YACpC,WAAW;gBAAE,MAAM;gBAAO,OAAO;YAAE;QACrC;IACF;AACF;AAMO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM;QAErB,IAAI,CAAC,QAAQ;YACX,OAAO,EAAE;QACX;QAEA,oBAAoB;QACpB,MAAM,EAAE,UAAU,EAAE,GAAG;QACvB,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;QAErB,MAAM,QAAQ,GAAG,UAAU,CAAC,WACzB,KAAK,CAAC;YAAE,QAAQ;QAAO,GACvB,OAAO,CAAC,aAAa,QACrB,KAAK,CAAC;QAET,MAAM,SAAS,MAAM,MAAM,GAAG;QAC9B,MAAM,cAAc,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,OAAc,CAAC;gBAClD,IAAI,KAAK,GAAG;gBACZ,KAAK,KAAK,GAAG;gBACb,WAAW,KAAK,SAAS;gBACzB,QAAQ,KAAK,MAAM;gBACnB,OAAO,KAAK,KAAK;YACnB,CAAC;QAED,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 301, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/store/slices/userSlice.ts"],"sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { UserTier, DailyUsage } from '@/types';\n\nexport enum UserStatus {\n  GUEST = 'GUEST', // 游客\n  LOGGED_IN = 'LOGGED_IN', // 已登录\n}\n\nexport interface UserState {\n  status: UserStatus; // 用户状态：游客或已登录\n  userId: string | null; // 用户ID（登录后才有）\n  phone: string | null; // 手机号（登录后才有）\n  userTier: UserTier;\n  sceneUsage: DailyUsage; // 场景扩展使用量\n  memeUsage: DailyUsage; // 表情包制作使用量\n}\n\nconst initialState: UserState = {\n  status: UserStatus.GUEST,\n  userId: null,\n  phone: null,\n  userTier: UserTier.FREE,\n  sceneUsage: { date: new Date().toLocaleDateString(), count: 0 },\n  memeUsage: { date: new Date().toLocaleDateString(), count: 0 },\n};\n\nconst userSlice = createSlice({\n  name: 'user',\n  initialState,\n  reducers: {\n    setUserStatus: (state, action: PayloadAction<UserStatus>) => {\n      state.status = action.payload;\n    },\n    setUserId: (state, action: PayloadAction<string | null>) => {\n      state.userId = action.payload;\n    },\n    setUserPhone: (state, action: PayloadAction<string | null>) => {\n      state.phone = action.payload;\n    },\n    setUserTier: (state, action: PayloadAction<UserTier>) => {\n      state.userTier = action.payload;\n    },\n    setUserInfo: (state, action: PayloadAction<{ userId: string; phone: string; userTier: UserTier }>) => {\n      state.userId = action.payload.userId;\n      state.phone = action.payload.phone;\n      state.userTier = action.payload.userTier;\n      state.status = UserStatus.LOGGED_IN;\n    },\n    clearUserInfo: (state) => {\n      state.status = UserStatus.GUEST;\n      state.userId = null;\n      state.phone = null;\n      state.userTier = UserTier.FREE;\n      state.sceneUsage = { date: new Date().toLocaleDateString(), count: 0 };\n      state.memeUsage = { date: new Date().toLocaleDateString(), count: 0 };\n    },\n    setSceneUsage: (state, action: PayloadAction<DailyUsage>) => {\n      state.sceneUsage = action.payload;\n    },\n    setMemeUsage: (state, action: PayloadAction<DailyUsage>) => {\n      state.memeUsage = action.payload;\n    },\n    // 兼容旧代码，保留 dailyUsage（映射到 sceneUsage）\n    setDailyUsage: (state, action: PayloadAction<DailyUsage>) => {\n      state.sceneUsage = action.payload;\n    },\n    updateSceneUsage: (state, action: PayloadAction<number>) => {\n      const today = new Date().toLocaleDateString();\n      if (state.sceneUsage.date !== today) {\n        state.sceneUsage = { date: today, count: action.payload };\n      } else {\n        state.sceneUsage.count += action.payload;\n      }\n    },\n    updateMemeUsage: (state, action: PayloadAction<number>) => {\n      const today = new Date().toLocaleDateString();\n      if (state.memeUsage.date !== today) {\n        state.memeUsage = { date: today, count: action.payload };\n      } else {\n        state.memeUsage.count += action.payload;\n      }\n    },\n    // 兼容旧代码\n    updateUsage: (state, action: PayloadAction<number>) => {\n      const today = new Date().toLocaleDateString();\n      if (state.sceneUsage.date !== today) {\n        state.sceneUsage = { date: today, count: action.payload };\n      } else {\n        state.sceneUsage.count += action.payload;\n      }\n    },\n    resetDailyUsage: (state) => {\n      const today = new Date().toLocaleDateString();\n      if (state.sceneUsage.date !== today) {\n        state.sceneUsage = { date: today, count: 0 };\n      }\n      if (state.memeUsage.date !== today) {\n        state.memeUsage = { date: today, count: 0 };\n      }\n    },\n  },\n});\n\nexport const {\n  setUserStatus,\n  setUserId,\n  setUserPhone,\n  setUserTier,\n  setUserInfo,\n  clearUserInfo,\n  setSceneUsage,\n  setMemeUsage,\n  setDailyUsage,\n  updateSceneUsage,\n  updateMemeUsage,\n  updateUsage,\n  resetDailyUsage,\n} = userSlice.actions;\n\nexport default userSlice.reducer;\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 459, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/app/layout.tsx"],"sourcesContent":["import type { Metadata } from \"next\";\nimport \"./globals.css\";\nimport Script from \"next/script\";\nimport ReduxProvider from \"./providers/ReduxProvider\";\nimport TabBarWrapper from \"./components/TabBarWrapper\";\nimport { getServerUserInfo, getServerHistory } from \"@/lib/server-auth\";\nimport { UserStatus } from \"@/store/slices/userSlice\";\nimport { GeneratedImage, UserTier } from \"@/types\";\nimport { UserInfo } from \"@/services/userService\";\n\nexport const metadata: Metadata = {\n  title: \"IP 创想坊\",\n  description: \"AI 赋能创意，一键生成场景与表情包\",\n};\n\n// 标记为动态渲染，因为使用了 cookies\nexport const dynamic = \"force-dynamic\";\n\nexport default async function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  // 在 SSR 侧获取用户信息和历史记录\n  let userInfo: UserInfo;\n  let history: GeneratedImage[];\n\n  try {\n    userInfo = await getServerUserInfo();\n  } catch (error) {\n    console.error(\"Get server user info error:\", error);\n    const today = new Date().toLocaleDateString();\n    userInfo = {\n      userId: undefined,\n      phone: undefined,\n      userTier: UserTier.FREE,\n      sceneUsage: { date: today, count: 0 },\n      memeUsage: { date: today, count: 0 },\n    };\n  }\n\n  try {\n    history = await getServerHistory();\n  } catch (error) {\n    console.error(\"Get server history error:\", error);\n    history = [];\n  }\n\n  // 准备初始状态\n  const initialUserState = {\n    status: userInfo.userId ? UserStatus.LOGGED_IN : UserStatus.GUEST,\n    userId: userInfo.userId || null,\n    phone: userInfo.phone || null,\n    userTier: userInfo.userTier,\n    sceneUsage: userInfo.sceneUsage,\n    memeUsage: userInfo.memeUsage,\n  };\n\n  return (\n    <html lang=\"zh-CN\">\n      <head>\n        <meta\n          name=\"viewport\"\n          content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\"\n        />\n        <Script\n          src=\"https://cdnjs.cloudflare.com/ajax/libs/gifshot/0.3.2/gifshot.min.js\"\n          strategy=\"lazyOnload\"\n        />\n      </head>\n      <body\n        className=\"bg-gray-50 text-gray-900 antialiased selection:bg-violet-200 selection:text-violet-900\"\n        style={{ backgroundColor: \"#f9fafb\" }}\n      >\n        <ReduxProvider\n          initialUserState={initialUserState}\n          initialHistory={history}\n        >\n          {children}\n          <TabBarWrapper />\n        </ReduxProvider>\n      </body>\n    </html>\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAGO,MAAM,WAAqB;IAChC,OAAO;IACP,aAAa;AACf;AAGO,MAAM,UAAU;AAER,eAAe,WAAW,EACvC,QAAQ,EAGR;IACA,qBAAqB;IACrB,IAAI;IACJ,IAAI;IAEJ,IAAI;QACF,WAAW,MAAM,IAAA,0IAAiB;IACpC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM,QAAQ,IAAI,OAAO,kBAAkB;QAC3C,WAAW;YACT,QAAQ;YACR,OAAO;YACP,UAAU,iHAAQ,CAAC,IAAI;YACvB,YAAY;gBAAE,MAAM;gBAAO,OAAO;YAAE;YACpC,WAAW;gBAAE,MAAM;gBAAO,OAAO;YAAE;QACrC;IACF;IAEA,IAAI;QACF,UAAU,MAAM,IAAA,yIAAgB;IAClC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,UAAU,EAAE;IACd;IAEA,SAAS;IACT,MAAM,mBAAmB;QACvB,QAAQ,SAAS,MAAM,GAAG,0IAAU,CAAC,SAAS,GAAG,0IAAU,CAAC,KAAK;QACjE,QAAQ,SAAS,MAAM,IAAI;QAC3B,OAAO,SAAS,KAAK,IAAI;QACzB,UAAU,SAAS,QAAQ;QAC3B,YAAY,SAAS,UAAU;QAC/B,WAAW,SAAS,SAAS;IAC/B;IAEA,qBACE,6WAAC;QAAK,MAAK;;0BACT,6WAAC;;kCACC,6WAAC;wBACC,MAAK;wBACL,SAAQ;;;;;;kCAEV,6WAAC,wQAAM;wBACL,KAAI;wBACJ,UAAS;;;;;;;;;;;;0BAGb,6WAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,iBAAiB;gBAAU;0BAEpC,cAAA,6WAAC,6IAAa;oBACZ,kBAAkB;oBAClB,gBAAgB;;wBAEf;sCACD,6WAAC,8IAAa;;;;;;;;;;;;;;;;;;;;;;AAKxB"}}]
}