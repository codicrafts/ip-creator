{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/constant.js"],"sourcesContent":["var ErrorCode;\r\n(function (ErrorCode) {\r\n    ErrorCode[\"DocIDError\"] = \"\\u6587\\u6863ID\\u4E0D\\u5408\\u6CD5\";\r\n    ErrorCode[\"CollNameError\"] = \"\\u96C6\\u5408\\u540D\\u79F0\\u4E0D\\u5408\\u6CD5\";\r\n    ErrorCode[\"OpStrError\"] = \"\\u64CD\\u4F5C\\u7B26\\u4E0D\\u5408\\u6CD5\";\r\n    ErrorCode[\"DirectionError\"] = \"\\u6392\\u5E8F\\u5B57\\u7B26\\u4E0D\\u5408\\u6CD5\";\r\n    ErrorCode[\"IntergerError\"] = \"must be integer\";\r\n    ErrorCode[\"BooleanError\"] = \"must be boolean\";\r\n    ErrorCode[\"ArrayError\"] = \"must be array\";\r\n    ErrorCode[\"QueryParamTypeError\"] = \"\\u67E5\\u8BE2\\u53C2\\u6570\\u5FC5\\u987B\\u4E3A\\u5BF9\\u8C61\";\r\n    ErrorCode[\"QueryParamValueError\"] = \"\\u67E5\\u8BE2\\u53C2\\u6570\\u5BF9\\u8C61\\u503C\\u4E0D\\u80FD\\u5747\\u4E3Aundefined\";\r\n    ErrorCode[\"CentersPhereError\"] = \"centersPhere\\u7ED3\\u6784\\u4E0D\\u5408\\u6CD5\";\r\n})(ErrorCode || (ErrorCode = {}));\r\nconst FieldType = {\r\n    String: 'String',\r\n    Number: 'Number',\r\n    Object: 'Object',\r\n    Array: 'Array',\r\n    Boolean: 'Boolean',\r\n    Null: 'Null',\r\n    GeoPoint: 'GeoPoint',\r\n    GeoLineString: 'GeoLineString',\r\n    GeoPolygon: 'GeoPolygon',\r\n    GeoMultiPoint: 'GeoMultiPoint',\r\n    GeoMultiLineString: 'GeoMultiLineString',\r\n    GeoMultiPolygon: 'GeoMultiPolygon',\r\n    Date: 'Date',\r\n    Command: 'Command',\r\n    ServerDate: 'ServerDate',\r\n    BsonDate: 'BsonDate'\r\n};\r\nconst OrderDirectionList = ['desc', 'asc'];\r\nconst WhereFilterOpList = ['<', '<=', '==', '>=', '>'];\r\nvar Opeartor;\r\n(function (Opeartor) {\r\n    Opeartor[\"lt\"] = \"<\";\r\n    Opeartor[\"gt\"] = \">\";\r\n    Opeartor[\"lte\"] = \"<=\";\r\n    Opeartor[\"gte\"] = \">=\";\r\n    Opeartor[\"eq\"] = \"==\";\r\n})(Opeartor || (Opeartor = {}));\r\nconst OperatorMap = {\r\n    [Opeartor.eq]: '$eq',\r\n    [Opeartor.lt]: '$lt',\r\n    [Opeartor.lte]: '$lte',\r\n    [Opeartor.gt]: '$gt',\r\n    [Opeartor.gte]: '$gte'\r\n};\r\nconst UpdateOperatorList = [\r\n    '$set',\r\n    '$inc',\r\n    '$mul',\r\n    '$unset',\r\n    '$push',\r\n    '$pop',\r\n    '$unshift',\r\n    '$shift',\r\n    '$currentDate',\r\n    '$each',\r\n    '$position'\r\n];\r\nvar QueryType;\r\n(function (QueryType) {\r\n    QueryType[\"WHERE\"] = \"WHERE\";\r\n    QueryType[\"DOC\"] = \"DOC\";\r\n})(QueryType || (QueryType = {}));\r\nexport { ErrorCode, FieldType, WhereFilterOpList, Opeartor, OperatorMap, OrderDirectionList, UpdateOperatorList, QueryType };\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,IAAI;AACJ,CAAC,SAAU,SAAS;IAChB,SAAS,CAAC,aAAa,GAAG;IAC1B,SAAS,CAAC,gBAAgB,GAAG;IAC7B,SAAS,CAAC,aAAa,GAAG;IAC1B,SAAS,CAAC,iBAAiB,GAAG;IAC9B,SAAS,CAAC,gBAAgB,GAAG;IAC7B,SAAS,CAAC,eAAe,GAAG;IAC5B,SAAS,CAAC,aAAa,GAAG;IAC1B,SAAS,CAAC,sBAAsB,GAAG;IACnC,SAAS,CAAC,uBAAuB,GAAG;IACpC,SAAS,CAAC,oBAAoB,GAAG;AACrC,CAAC,EAAE,aAAa,CAAC,YAAY,CAAC,CAAC;AAC/B,MAAM,YAAY;IACd,QAAQ;IACR,QAAQ;IACR,QAAQ;IACR,OAAO;IACP,SAAS;IACT,MAAM;IACN,UAAU;IACV,eAAe;IACf,YAAY;IACZ,eAAe;IACf,oBAAoB;IACpB,iBAAiB;IACjB,MAAM;IACN,SAAS;IACT,YAAY;IACZ,UAAU;AACd;AACA,MAAM,qBAAqB;IAAC;IAAQ;CAAM;AAC1C,MAAM,oBAAoB;IAAC;IAAK;IAAM;IAAM;IAAM;CAAI;AACtD,IAAI;AACJ,CAAC,SAAU,QAAQ;IACf,QAAQ,CAAC,KAAK,GAAG;IACjB,QAAQ,CAAC,KAAK,GAAG;IACjB,QAAQ,CAAC,MAAM,GAAG;IAClB,QAAQ,CAAC,MAAM,GAAG;IAClB,QAAQ,CAAC,KAAK,GAAG;AACrB,CAAC,EAAE,YAAY,CAAC,WAAW,CAAC,CAAC;AAC7B,MAAM,cAAc;IAChB,CAAC,SAAS,EAAE,CAAC,EAAE;IACf,CAAC,SAAS,EAAE,CAAC,EAAE;IACf,CAAC,SAAS,GAAG,CAAC,EAAE;IAChB,CAAC,SAAS,EAAE,CAAC,EAAE;IACf,CAAC,SAAS,GAAG,CAAC,EAAE;AACpB;AACA,MAAM,qBAAqB;IACvB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACH;AACD,IAAI;AACJ,CAAC,SAAU,SAAS;IAChB,SAAS,CAAC,QAAQ,GAAG;IACrB,SAAS,CAAC,MAAM,GAAG;AACvB,CAAC,EAAE,aAAa,CAAC,YAAY,CAAC,CAAC","ignoreList":[0]}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/utils/symbol.js"],"sourcesContent":["const _symbols = [];\r\nconst __internalMark__ = {};\r\nclass HiddenSymbol {\r\n    constructor(target) {\r\n        Object.defineProperties(this, {\r\n            target: {\r\n                enumerable: false,\r\n                writable: false,\r\n                configurable: false,\r\n                value: target,\r\n            },\r\n        });\r\n    }\r\n}\r\nexport class InternalSymbol extends HiddenSymbol {\r\n    constructor(target, __mark__) {\r\n        if (__mark__ !== __internalMark__) {\r\n            throw new TypeError('InternalSymbol cannot be constructed with new operator');\r\n        }\r\n        super(target);\r\n    }\r\n    static for(target) {\r\n        for (let i = 0, len = _symbols.length; i < len; i++) {\r\n            if (_symbols[i].target === target) {\r\n                return _symbols[i].instance;\r\n            }\r\n        }\r\n        const symbol = new InternalSymbol(target, __internalMark__);\r\n        _symbols.push({\r\n            target,\r\n            instance: symbol,\r\n        });\r\n        return symbol;\r\n    }\r\n}\r\nexport default InternalSymbol;\r\n"],"names":[],"mappings":";;;;;;AAAA,MAAM,WAAW,EAAE;AACnB,MAAM,mBAAmB,CAAC;AAC1B,MAAM;IACF,YAAY,MAAM,CAAE;QAChB,OAAO,gBAAgB,CAAC,IAAI,EAAE;YAC1B,QAAQ;gBACJ,YAAY;gBACZ,UAAU;gBACV,cAAc;gBACd,OAAO;YACX;QACJ;IACJ;AACJ;AACO,MAAM,uBAAuB;IAChC,YAAY,MAAM,EAAE,QAAQ,CAAE;QAC1B,IAAI,aAAa,kBAAkB;YAC/B,MAAM,IAAI,UAAU;QACxB;QACA,KAAK,CAAC;IACV;IACA,OAAO,IAAI,MAAM,EAAE;QACf,IAAK,IAAI,IAAI,GAAG,MAAM,SAAS,MAAM,EAAE,IAAI,KAAK,IAAK;YACjD,IAAI,QAAQ,CAAC,EAAE,CAAC,MAAM,KAAK,QAAQ;gBAC/B,OAAO,QAAQ,CAAC,EAAE,CAAC,QAAQ;YAC/B;QACJ;QACA,MAAM,SAAS,IAAI,eAAe,QAAQ;QAC1C,SAAS,IAAI,CAAC;YACV;YACA,UAAU;QACd;QACA,OAAO;IACX;AACJ;uCACe","ignoreList":[0]}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/helper/symbol.js"],"sourcesContent":["import InternalSymbol from '../utils/symbol';\r\nexport * from '../utils/symbol';\r\nexport const SYMBOL_UNSET_FIELD_NAME = InternalSymbol.for('UNSET_FIELD_NAME');\r\nexport const SYMBOL_UPDATE_COMMAND = InternalSymbol.for('UPDATE_COMMAND');\r\nexport const SYMBOL_QUERY_COMMAND = InternalSymbol.for('QUERY_COMMAND');\r\nexport const SYMBOL_LOGIC_COMMAND = InternalSymbol.for('LOGIC_COMMAND');\r\nexport const SYMBOL_GEO_POINT = InternalSymbol.for('GEO_POINT');\r\nexport const SYMBOL_GEO_LINE_STRING = InternalSymbol.for('SYMBOL_GEO_LINE_STRING');\r\nexport const SYMBOL_GEO_POLYGON = InternalSymbol.for('SYMBOL_GEO_POLYGON');\r\nexport const SYMBOL_GEO_MULTI_POINT = InternalSymbol.for('SYMBOL_GEO_MULTI_POINT');\r\nexport const SYMBOL_GEO_MULTI_LINE_STRING = InternalSymbol.for('SYMBOL_GEO_MULTI_LINE_STRING');\r\nexport const SYMBOL_GEO_MULTI_POLYGON = InternalSymbol.for('SYMBOL_GEO_MULTI_POLYGON');\r\nexport const SYMBOL_SERVER_DATE = InternalSymbol.for('SERVER_DATE');\r\nexport const SYMBOL_REGEXP = InternalSymbol.for('REGEXP');\r\nexport const SYMBOL_OBJECTID = InternalSymbol.for('OBJECTID');\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;AAEO,MAAM,0BAA0B,0PAAc,CAAC,GAAG,CAAC;AACnD,MAAM,wBAAwB,0PAAc,CAAC,GAAG,CAAC;AACjD,MAAM,uBAAuB,0PAAc,CAAC,GAAG,CAAC;AAChD,MAAM,uBAAuB,0PAAc,CAAC,GAAG,CAAC;AAChD,MAAM,mBAAmB,0PAAc,CAAC,GAAG,CAAC;AAC5C,MAAM,yBAAyB,0PAAc,CAAC,GAAG,CAAC;AAClD,MAAM,qBAAqB,0PAAc,CAAC,GAAG,CAAC;AAC9C,MAAM,yBAAyB,0PAAc,CAAC,GAAG,CAAC;AAClD,MAAM,+BAA+B,0PAAc,CAAC,GAAG,CAAC;AACxD,MAAM,2BAA2B,0PAAc,CAAC,GAAG,CAAC;AACpD,MAAM,qBAAqB,0PAAc,CAAC,GAAG,CAAC;AAC9C,MAAM,gBAAgB,0PAAc,CAAC,GAAG,CAAC;AACzC,MAAM,kBAAkB,0PAAc,CAAC,GAAG,CAAC","ignoreList":[0]}},
    {"offset": {"line": 207, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/utils/type.js"],"sourcesContent":["import { InternalSymbol } from './symbol';\r\nexport const getType = (x) => Object.prototype.toString.call(x).slice(8, -1).toLowerCase();\r\nexport const isObject = (x) => getType(x) === 'object';\r\nexport const isString = (x) => getType(x) === 'string';\r\nexport const isNumber = (x) => getType(x) === 'number';\r\nexport const isPromise = (x) => getType(x) === 'promise';\r\nexport const isFunction = (x) => typeof x === 'function';\r\nexport const isArray = (x) => Array.isArray(x);\r\nexport const isDate = (x) => getType(x) === 'date';\r\nexport const isRegExp = (x) => getType(x) === 'regexp';\r\nexport const isInternalObject = (x) => x && (x._internalType instanceof InternalSymbol);\r\nexport const isPlainObject = (obj) => {\r\n    if (typeof obj !== 'object' || obj === null)\r\n        return false;\r\n    let proto = obj;\r\n    while (Object.getPrototypeOf(proto) !== null) {\r\n        proto = Object.getPrototypeOf(proto);\r\n    }\r\n    return Object.getPrototypeOf(obj) === proto;\r\n};\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACO,MAAM,UAAU,CAAC,IAAM,OAAO,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,GAAG,WAAW;AACjF,MAAM,WAAW,CAAC,IAAM,QAAQ,OAAO;AACvC,MAAM,WAAW,CAAC,IAAM,QAAQ,OAAO;AACvC,MAAM,WAAW,CAAC,IAAM,QAAQ,OAAO;AACvC,MAAM,YAAY,CAAC,IAAM,QAAQ,OAAO;AACxC,MAAM,aAAa,CAAC,IAAM,OAAO,MAAM;AACvC,MAAM,UAAU,CAAC,IAAM,MAAM,OAAO,CAAC;AACrC,MAAM,SAAS,CAAC,IAAM,QAAQ,OAAO;AACrC,MAAM,WAAW,CAAC,IAAM,QAAQ,OAAO;AACvC,MAAM,mBAAmB,CAAC,IAAM,KAAM,EAAE,aAAa,YAAY,iQAAc;AAC/E,MAAM,gBAAgB,CAAC;IAC1B,IAAI,OAAO,QAAQ,YAAY,QAAQ,MACnC,OAAO;IACX,IAAI,QAAQ;IACZ,MAAO,OAAO,cAAc,CAAC,WAAW,KAAM;QAC1C,QAAQ,OAAO,cAAc,CAAC;IAClC;IACA,OAAO,OAAO,cAAc,CAAC,SAAS;AAC1C","ignoreList":[0]}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/geo/lineString.js"],"sourcesContent":["import { SYMBOL_GEO_LINE_STRING } from '../helper/symbol';\r\nimport { Point } from './point';\r\nimport { isArray, isNumber } from '../utils/type';\r\nexport class LineString {\r\n    constructor(points) {\r\n        if (!isArray(points)) {\r\n            throw new TypeError(`\"points\" must be of type Point[]. Received type ${typeof points}`);\r\n        }\r\n        if (points.length < 2) {\r\n            throw new Error('\"points\" must contain 2 points at least');\r\n        }\r\n        points.forEach(point => {\r\n            if (!(point instanceof Point)) {\r\n                throw new TypeError(`\"points\" must be of type Point[]. Received type ${typeof point}[]`);\r\n            }\r\n        });\r\n        this.points = points;\r\n    }\r\n    parse(key) {\r\n        return {\r\n            [key]: {\r\n                type: 'LineString',\r\n                coordinates: this.points.map(point => point.toJSON().coordinates)\r\n            }\r\n        };\r\n    }\r\n    toJSON() {\r\n        return {\r\n            type: 'LineString',\r\n            coordinates: this.points.map(point => point.toJSON().coordinates)\r\n        };\r\n    }\r\n    static validate(lineString) {\r\n        if (lineString.type !== 'LineString' || !isArray(lineString.coordinates)) {\r\n            return false;\r\n        }\r\n        for (let point of lineString.coordinates) {\r\n            if (!isNumber(point[0]) || !isNumber(point[1])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    static isClosed(lineString) {\r\n        const firstPoint = lineString.points[0];\r\n        const lastPoint = lineString.points[lineString.points.length - 1];\r\n        if (firstPoint.latitude === lastPoint.latitude && firstPoint.longitude === lastPoint.longitude) {\r\n            return true;\r\n        }\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_GEO_LINE_STRING;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACO,MAAM;IACT,YAAY,MAAM,CAAE;QAChB,IAAI,CAAC,IAAA,wPAAO,EAAC,SAAS;YAClB,MAAM,IAAI,UAAU,CAAC,gDAAgD,EAAE,OAAO,QAAQ;QAC1F;QACA,IAAI,OAAO,MAAM,GAAG,GAAG;YACnB,MAAM,IAAI,MAAM;QACpB;QACA,OAAO,OAAO,CAAC,CAAA;YACX,IAAI,CAAC,CAAC,iBAAiB,qPAAK,GAAG;gBAC3B,MAAM,IAAI,UAAU,CAAC,gDAAgD,EAAE,OAAO,MAAM,EAAE,CAAC;YAC3F;QACJ;QACA,IAAI,CAAC,MAAM,GAAG;IAClB;IACA,MAAM,GAAG,EAAE;QACP,OAAO;YACH,CAAC,IAAI,EAAE;gBACH,MAAM;gBACN,aAAa,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS,MAAM,MAAM,GAAG,WAAW;YACpE;QACJ;IACJ;IACA,SAAS;QACL,OAAO;YACH,MAAM;YACN,aAAa,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS,MAAM,MAAM,GAAG,WAAW;QACpE;IACJ;IACA,OAAO,SAAS,UAAU,EAAE;QACxB,IAAI,WAAW,IAAI,KAAK,gBAAgB,CAAC,IAAA,wPAAO,EAAC,WAAW,WAAW,GAAG;YACtE,OAAO;QACX;QACA,KAAK,IAAI,SAAS,WAAW,WAAW,CAAE;YACtC,IAAI,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,KAAK,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,GAAG;gBAC5C,OAAO;YACX;QACJ;QACA,OAAO;IACX;IACA,OAAO,SAAS,UAAU,EAAE;QACxB,MAAM,aAAa,WAAW,MAAM,CAAC,EAAE;QACvC,MAAM,YAAY,WAAW,MAAM,CAAC,WAAW,MAAM,CAAC,MAAM,GAAG,EAAE;QACjE,IAAI,WAAW,QAAQ,KAAK,UAAU,QAAQ,IAAI,WAAW,SAAS,KAAK,UAAU,SAAS,EAAE;YAC5F,OAAO;QACX;IACJ;IACA,IAAI,gBAAgB;QAChB,OAAO,0RAAsB;IACjC;AACJ","ignoreList":[0]}},
    {"offset": {"line": 320, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/geo/polygon.js"],"sourcesContent":["import { SYMBOL_GEO_POLYGON } from '../helper/symbol';\r\nimport { isArray, isNumber } from '../utils/type';\r\nimport { LineString } from './lineString';\r\nexport class Polygon {\r\n    constructor(lines) {\r\n        if (!isArray(lines)) {\r\n            throw new TypeError(`\"lines\" must be of type LineString[]. Received type ${typeof lines}`);\r\n        }\r\n        if (lines.length === 0) {\r\n            throw new Error('Polygon must contain 1 linestring at least');\r\n        }\r\n        lines.forEach(line => {\r\n            if (!(line instanceof LineString)) {\r\n                throw new TypeError(`\"lines\" must be of type LineString[]. Received type ${typeof line}[]`);\r\n            }\r\n            if (!LineString.isClosed(line)) {\r\n                throw new Error(`LineString ${line.points.map(p => p.toReadableString())} is not a closed cycle`);\r\n            }\r\n        });\r\n        this.lines = lines;\r\n    }\r\n    parse(key) {\r\n        return {\r\n            [key]: {\r\n                type: 'Polygon',\r\n                coordinates: this.lines.map(line => {\r\n                    return line.points.map(point => [point.longitude, point.latitude]);\r\n                })\r\n            }\r\n        };\r\n    }\r\n    toJSON() {\r\n        return {\r\n            type: 'Polygon',\r\n            coordinates: this.lines.map(line => {\r\n                return line.points.map(point => [point.longitude, point.latitude]);\r\n            })\r\n        };\r\n    }\r\n    static validate(polygon) {\r\n        if (polygon.type !== 'Polygon' || !isArray(polygon.coordinates)) {\r\n            return false;\r\n        }\r\n        for (let line of polygon.coordinates) {\r\n            if (!this.isCloseLineString(line)) {\r\n                return false;\r\n            }\r\n            for (let point of line) {\r\n                if (!isNumber(point[0]) || !isNumber(point[1])) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    static isCloseLineString(lineString) {\r\n        const firstPoint = lineString[0];\r\n        const lastPoint = lineString[lineString.length - 1];\r\n        if (firstPoint[0] !== lastPoint[0] || firstPoint[1] !== lastPoint[1]) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_GEO_POLYGON;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACO,MAAM;IACT,YAAY,KAAK,CAAE;QACf,IAAI,CAAC,IAAA,wPAAO,EAAC,QAAQ;YACjB,MAAM,IAAI,UAAU,CAAC,oDAAoD,EAAE,OAAO,OAAO;QAC7F;QACA,IAAI,MAAM,MAAM,KAAK,GAAG;YACpB,MAAM,IAAI,MAAM;QACpB;QACA,MAAM,OAAO,CAAC,CAAA;YACV,IAAI,CAAC,CAAC,gBAAgB,+PAAU,GAAG;gBAC/B,MAAM,IAAI,UAAU,CAAC,oDAAoD,EAAE,OAAO,KAAK,EAAE,CAAC;YAC9F;YACA,IAAI,CAAC,+PAAU,CAAC,QAAQ,CAAC,OAAO;gBAC5B,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,gBAAgB,IAAI,sBAAsB,CAAC;YACpG;QACJ;QACA,IAAI,CAAC,KAAK,GAAG;IACjB;IACA,MAAM,GAAG,EAAE;QACP,OAAO;YACH,CAAC,IAAI,EAAE;gBACH,MAAM;gBACN,aAAa,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;oBACxB,OAAO,KAAK,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS;4BAAC,MAAM,SAAS;4BAAE,MAAM,QAAQ;yBAAC;gBACrE;YACJ;QACJ;IACJ;IACA,SAAS;QACL,OAAO;YACH,MAAM;YACN,aAAa,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;gBACxB,OAAO,KAAK,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS;wBAAC,MAAM,SAAS;wBAAE,MAAM,QAAQ;qBAAC;YACrE;QACJ;IACJ;IACA,OAAO,SAAS,OAAO,EAAE;QACrB,IAAI,QAAQ,IAAI,KAAK,aAAa,CAAC,IAAA,wPAAO,EAAC,QAAQ,WAAW,GAAG;YAC7D,OAAO;QACX;QACA,KAAK,IAAI,QAAQ,QAAQ,WAAW,CAAE;YAClC,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,OAAO;gBAC/B,OAAO;YACX;YACA,KAAK,IAAI,SAAS,KAAM;gBACpB,IAAI,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,KAAK,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,GAAG;oBAC5C,OAAO;gBACX;YACJ;QACJ;QACA,OAAO;IACX;IACA,OAAO,kBAAkB,UAAU,EAAE;QACjC,MAAM,aAAa,UAAU,CAAC,EAAE;QAChC,MAAM,YAAY,UAAU,CAAC,WAAW,MAAM,GAAG,EAAE;QACnD,IAAI,UAAU,CAAC,EAAE,KAAK,SAAS,CAAC,EAAE,IAAI,UAAU,CAAC,EAAE,KAAK,SAAS,CAAC,EAAE,EAAE;YAClE,OAAO;QACX;QACA,OAAO;IACX;IACA,IAAI,gBAAgB;QAChB,OAAO,sRAAkB;IAC7B;AACJ","ignoreList":[0]}},
    {"offset": {"line": 404, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/geo/multiPoint.js"],"sourcesContent":["import { SYMBOL_GEO_MULTI_POINT } from '../helper/symbol';\r\nimport { Point } from './point';\r\nimport { isArray, isNumber } from '../utils/type';\r\nexport class MultiPoint {\r\n    constructor(points) {\r\n        if (!isArray(points)) {\r\n            throw new TypeError(`\"points\" must be of type Point[]. Received type ${typeof points}`);\r\n        }\r\n        if (points.length === 0) {\r\n            throw new Error('\"points\" must contain 1 point at least');\r\n        }\r\n        points.forEach(point => {\r\n            if (!(point instanceof Point)) {\r\n                throw new TypeError(`\"points\" must be of type Point[]. Received type ${typeof point}[]`);\r\n            }\r\n        });\r\n        this.points = points;\r\n    }\r\n    parse(key) {\r\n        return {\r\n            [key]: {\r\n                type: 'MultiPoint',\r\n                coordinates: this.points.map(point => point.toJSON().coordinates)\r\n            }\r\n        };\r\n    }\r\n    toJSON() {\r\n        return {\r\n            type: 'MultiPoint',\r\n            coordinates: this.points.map(point => point.toJSON().coordinates)\r\n        };\r\n    }\r\n    static validate(multiPoint) {\r\n        if (multiPoint.type !== 'MultiPoint' || !isArray(multiPoint.coordinates)) {\r\n            return false;\r\n        }\r\n        for (let point of multiPoint.coordinates) {\r\n            if (!isNumber(point[0]) || !isNumber(point[1])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_GEO_MULTI_POINT;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACO,MAAM;IACT,YAAY,MAAM,CAAE;QAChB,IAAI,CAAC,IAAA,wPAAO,EAAC,SAAS;YAClB,MAAM,IAAI,UAAU,CAAC,gDAAgD,EAAE,OAAO,QAAQ;QAC1F;QACA,IAAI,OAAO,MAAM,KAAK,GAAG;YACrB,MAAM,IAAI,MAAM;QACpB;QACA,OAAO,OAAO,CAAC,CAAA;YACX,IAAI,CAAC,CAAC,iBAAiB,qPAAK,GAAG;gBAC3B,MAAM,IAAI,UAAU,CAAC,gDAAgD,EAAE,OAAO,MAAM,EAAE,CAAC;YAC3F;QACJ;QACA,IAAI,CAAC,MAAM,GAAG;IAClB;IACA,MAAM,GAAG,EAAE;QACP,OAAO;YACH,CAAC,IAAI,EAAE;gBACH,MAAM;gBACN,aAAa,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS,MAAM,MAAM,GAAG,WAAW;YACpE;QACJ;IACJ;IACA,SAAS;QACL,OAAO;YACH,MAAM;YACN,aAAa,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS,MAAM,MAAM,GAAG,WAAW;QACpE;IACJ;IACA,OAAO,SAAS,UAAU,EAAE;QACxB,IAAI,WAAW,IAAI,KAAK,gBAAgB,CAAC,IAAA,wPAAO,EAAC,WAAW,WAAW,GAAG;YACtE,OAAO;QACX;QACA,KAAK,IAAI,SAAS,WAAW,WAAW,CAAE;YACtC,IAAI,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,KAAK,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,GAAG;gBAC5C,OAAO;YACX;QACJ;QACA,OAAO;IACX;IACA,IAAI,gBAAgB;QAChB,OAAO,0RAAsB;IACjC;AACJ","ignoreList":[0]}},
    {"offset": {"line": 462, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/geo/multiLineString.js"],"sourcesContent":["import { SYMBOL_GEO_MULTI_LINE_STRING } from '../helper/symbol';\r\nimport { isArray, isNumber } from '../utils/type';\r\nimport { LineString } from './lineString';\r\nexport class MultiLineString {\r\n    constructor(lines) {\r\n        if (!isArray(lines)) {\r\n            throw new TypeError(`\"lines\" must be of type LineString[]. Received type ${typeof lines}`);\r\n        }\r\n        if (lines.length === 0) {\r\n            throw new Error('Polygon must contain 1 linestring at least');\r\n        }\r\n        lines.forEach(line => {\r\n            if (!(line instanceof LineString)) {\r\n                throw new TypeError(`\"lines\" must be of type LineString[]. Received type ${typeof line}[]`);\r\n            }\r\n        });\r\n        this.lines = lines;\r\n    }\r\n    parse(key) {\r\n        return {\r\n            [key]: {\r\n                type: 'MultiLineString',\r\n                coordinates: this.lines.map(line => {\r\n                    return line.points.map(point => [point.longitude, point.latitude]);\r\n                })\r\n            }\r\n        };\r\n    }\r\n    toJSON() {\r\n        return {\r\n            type: 'MultiLineString',\r\n            coordinates: this.lines.map(line => {\r\n                return line.points.map(point => [point.longitude, point.latitude]);\r\n            })\r\n        };\r\n    }\r\n    static validate(multiLineString) {\r\n        if (multiLineString.type !== 'MultiLineString' || !isArray(multiLineString.coordinates)) {\r\n            return false;\r\n        }\r\n        for (let line of multiLineString.coordinates) {\r\n            for (let point of line) {\r\n                if (!isNumber(point[0]) || !isNumber(point[1])) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_GEO_MULTI_LINE_STRING;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACO,MAAM;IACT,YAAY,KAAK,CAAE;QACf,IAAI,CAAC,IAAA,wPAAO,EAAC,QAAQ;YACjB,MAAM,IAAI,UAAU,CAAC,oDAAoD,EAAE,OAAO,OAAO;QAC7F;QACA,IAAI,MAAM,MAAM,KAAK,GAAG;YACpB,MAAM,IAAI,MAAM;QACpB;QACA,MAAM,OAAO,CAAC,CAAA;YACV,IAAI,CAAC,CAAC,gBAAgB,+PAAU,GAAG;gBAC/B,MAAM,IAAI,UAAU,CAAC,oDAAoD,EAAE,OAAO,KAAK,EAAE,CAAC;YAC9F;QACJ;QACA,IAAI,CAAC,KAAK,GAAG;IACjB;IACA,MAAM,GAAG,EAAE;QACP,OAAO;YACH,CAAC,IAAI,EAAE;gBACH,MAAM;gBACN,aAAa,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;oBACxB,OAAO,KAAK,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS;4BAAC,MAAM,SAAS;4BAAE,MAAM,QAAQ;yBAAC;gBACrE;YACJ;QACJ;IACJ;IACA,SAAS;QACL,OAAO;YACH,MAAM;YACN,aAAa,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;gBACxB,OAAO,KAAK,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS;wBAAC,MAAM,SAAS;wBAAE,MAAM,QAAQ;qBAAC;YACrE;QACJ;IACJ;IACA,OAAO,SAAS,eAAe,EAAE;QAC7B,IAAI,gBAAgB,IAAI,KAAK,qBAAqB,CAAC,IAAA,wPAAO,EAAC,gBAAgB,WAAW,GAAG;YACrF,OAAO;QACX;QACA,KAAK,IAAI,QAAQ,gBAAgB,WAAW,CAAE;YAC1C,KAAK,IAAI,SAAS,KAAM;gBACpB,IAAI,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,KAAK,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,GAAG;oBAC5C,OAAO;gBACX;YACJ;QACJ;QACA,OAAO;IACX;IACA,IAAI,gBAAgB;QAChB,OAAO,gSAA4B;IACvC;AACJ","ignoreList":[0]}},
    {"offset": {"line": 532, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/geo/multiPolygon.js"],"sourcesContent":["import { SYMBOL_GEO_MULTI_POLYGON } from '../helper/symbol';\r\nimport { isArray, isNumber } from '../utils/type';\r\nimport { Polygon } from './polygon';\r\nexport class MultiPolygon {\r\n    constructor(polygons) {\r\n        if (!isArray(polygons)) {\r\n            throw new TypeError(`\"polygons\" must be of type Polygon[]. Received type ${typeof polygons}`);\r\n        }\r\n        if (polygons.length === 0) {\r\n            throw new Error('MultiPolygon must contain 1 polygon at least');\r\n        }\r\n        for (let polygon of polygons) {\r\n            if (!(polygon instanceof Polygon)) {\r\n                throw new TypeError(`\"polygon\" must be of type Polygon[]. Received type ${typeof polygon}[]`);\r\n            }\r\n        }\r\n        this.polygons = polygons;\r\n    }\r\n    parse(key) {\r\n        return {\r\n            [key]: {\r\n                type: 'MultiPolygon',\r\n                coordinates: this.polygons.map(polygon => {\r\n                    return polygon.lines.map(line => {\r\n                        return line.points.map(point => [point.longitude, point.latitude]);\r\n                    });\r\n                })\r\n            }\r\n        };\r\n    }\r\n    toJSON() {\r\n        return {\r\n            type: 'MultiPolygon',\r\n            coordinates: this.polygons.map(polygon => {\r\n                return polygon.lines.map(line => {\r\n                    return line.points.map(point => [point.longitude, point.latitude]);\r\n                });\r\n            })\r\n        };\r\n    }\r\n    static validate(multiPolygon) {\r\n        if (multiPolygon.type !== 'MultiPolygon' || !isArray(multiPolygon.coordinates)) {\r\n            return false;\r\n        }\r\n        for (let polygon of multiPolygon.coordinates) {\r\n            for (let line of polygon) {\r\n                for (let point of line) {\r\n                    if (!isNumber(point[0]) || !isNumber(point[1])) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_GEO_MULTI_POLYGON;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACO,MAAM;IACT,YAAY,QAAQ,CAAE;QAClB,IAAI,CAAC,IAAA,wPAAO,EAAC,WAAW;YACpB,MAAM,IAAI,UAAU,CAAC,oDAAoD,EAAE,OAAO,UAAU;QAChG;QACA,IAAI,SAAS,MAAM,KAAK,GAAG;YACvB,MAAM,IAAI,MAAM;QACpB;QACA,KAAK,IAAI,WAAW,SAAU;YAC1B,IAAI,CAAC,CAAC,mBAAmB,yPAAO,GAAG;gBAC/B,MAAM,IAAI,UAAU,CAAC,mDAAmD,EAAE,OAAO,QAAQ,EAAE,CAAC;YAChG;QACJ;QACA,IAAI,CAAC,QAAQ,GAAG;IACpB;IACA,MAAM,GAAG,EAAE;QACP,OAAO;YACH,CAAC,IAAI,EAAE;gBACH,MAAM;gBACN,aAAa,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAA;oBAC3B,OAAO,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAA;wBACrB,OAAO,KAAK,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS;gCAAC,MAAM,SAAS;gCAAE,MAAM,QAAQ;6BAAC;oBACrE;gBACJ;YACJ;QACJ;IACJ;IACA,SAAS;QACL,OAAO;YACH,MAAM;YACN,aAAa,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAA;gBAC3B,OAAO,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAA;oBACrB,OAAO,KAAK,MAAM,CAAC,GAAG,CAAC,CAAA,QAAS;4BAAC,MAAM,SAAS;4BAAE,MAAM,QAAQ;yBAAC;gBACrE;YACJ;QACJ;IACJ;IACA,OAAO,SAAS,YAAY,EAAE;QAC1B,IAAI,aAAa,IAAI,KAAK,kBAAkB,CAAC,IAAA,wPAAO,EAAC,aAAa,WAAW,GAAG;YAC5E,OAAO;QACX;QACA,KAAK,IAAI,WAAW,aAAa,WAAW,CAAE;YAC1C,KAAK,IAAI,QAAQ,QAAS;gBACtB,KAAK,IAAI,SAAS,KAAM;oBACpB,IAAI,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,KAAK,CAAC,IAAA,yPAAQ,EAAC,KAAK,CAAC,EAAE,GAAG;wBAC5C,OAAO;oBACX;gBACJ;YACJ;QACJ;QACA,OAAO;IACX;IACA,IAAI,gBAAgB;QAChB,OAAO,4RAAwB;IACnC;AACJ","ignoreList":[0]}},
    {"offset": {"line": 608, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/util.js"],"sourcesContent":["import { FieldType } from './constant';\r\nimport { Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon } from './geo/index';\r\nexport class Util {\r\n}\r\nUtil.formatResDocumentData = (documents) => {\r\n    return documents.map(document => {\r\n        return Util.formatField(document);\r\n    });\r\n};\r\nUtil.formatField = document => {\r\n    const keys = Object.keys(document);\r\n    let protoField = {};\r\n    if (Array.isArray(document)) {\r\n        protoField = [];\r\n    }\r\n    keys.forEach(key => {\r\n        const item = document[key];\r\n        const type = Util.whichType(item);\r\n        let realValue;\r\n        switch (type) {\r\n            case FieldType.GeoPoint:\r\n                realValue = new Point(item.coordinates[0], item.coordinates[1]);\r\n                break;\r\n            case FieldType.GeoLineString:\r\n                realValue = new LineString(item.coordinates.map(point => new Point(point[0], point[1])));\r\n                break;\r\n            case FieldType.GeoPolygon:\r\n                realValue = new Polygon(item.coordinates.map(line => new LineString(line.map(([lng, lat]) => new Point(lng, lat)))));\r\n                break;\r\n            case FieldType.GeoMultiPoint:\r\n                realValue = new MultiPoint(item.coordinates.map(point => new Point(point[0], point[1])));\r\n                break;\r\n            case FieldType.GeoMultiLineString:\r\n                realValue = new MultiLineString(item.coordinates.map(line => new LineString(line.map(([lng, lat]) => new Point(lng, lat)))));\r\n                break;\r\n            case FieldType.GeoMultiPolygon:\r\n                realValue = new MultiPolygon(item.coordinates.map(polygon => new Polygon(polygon.map(line => new LineString(line.map(([lng, lat]) => new Point(lng, lat)))))));\r\n                break;\r\n            case FieldType.Date:\r\n                realValue = item;\r\n                break;\r\n            case FieldType.Object:\r\n            case FieldType.Array:\r\n                realValue = Util.formatField(item);\r\n                break;\r\n            case FieldType.ServerDate:\r\n                realValue = new Date(item.$date);\r\n                break;\r\n            default:\r\n                realValue = item;\r\n        }\r\n        if (Array.isArray(protoField)) {\r\n            protoField.push(realValue);\r\n        }\r\n        else {\r\n            protoField[key] = realValue;\r\n        }\r\n    });\r\n    return protoField;\r\n};\r\nUtil.whichType = (obj) => {\r\n    let type = Object.prototype.toString.call(obj).slice(8, -1);\r\n    if (type === FieldType.Date) {\r\n        return FieldType.Date;\r\n    }\r\n    if (type === FieldType.Object) {\r\n        if (obj.$date) {\r\n            type = FieldType.ServerDate;\r\n        }\r\n        else if (Point.validate(obj)) {\r\n            type = FieldType.GeoPoint;\r\n        }\r\n        else if (LineString.validate(obj)) {\r\n            type = FieldType.GeoLineString;\r\n        }\r\n        else if (Polygon.validate(obj)) {\r\n            type = FieldType.GeoPolygon;\r\n        }\r\n        else if (MultiPoint.validate(obj)) {\r\n            type = FieldType.GeoMultiPoint;\r\n        }\r\n        else if (MultiLineString.validate(obj)) {\r\n            type = FieldType.GeoMultiLineString;\r\n        }\r\n        else if (MultiPolygon.validate(obj)) {\r\n            type = FieldType.GeoMultiPolygon;\r\n        }\r\n    }\r\n    return type;\r\n};\r\nUtil.generateDocId = () => {\r\n    let chars = 'ABCDEFabcdef0123456789';\r\n    let autoId = '';\r\n    for (let i = 0; i < 24; i++) {\r\n        autoId += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return autoId;\r\n};\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 714, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/const/code.js"],"sourcesContent":["export const ERRORS = {\r\n    CREATE_WATCH_NET_ERROR: {\r\n        code: 'CREATE_WATCH_NET_ERROR',\r\n        message: 'create watch network error'\r\n    },\r\n    CREATE_WACTH_EXCEED_ERROR: {\r\n        code: 'CREATE_WACTH_EXCEED_ERROR',\r\n        message: 'maximum connections exceed'\r\n    },\r\n    CREATE_WATCH_SERVER_ERROR: {\r\n        code: 'CREATE_WATCH_SERVER_ERROR',\r\n        message: 'create watch server error'\r\n    },\r\n    CONN_ERROR: {\r\n        code: 'CONN_ERROR',\r\n        message: 'connection error'\r\n    },\r\n    INVALID_PARAM: {\r\n        code: 'INVALID_PARAM',\r\n        message: 'Invalid request param'\r\n    },\r\n    INSERT_DOC_FAIL: {\r\n        code: 'INSERT_DOC_FAIL',\r\n        message: 'insert document failed'\r\n    },\r\n    DATABASE_TRANSACTION_CONFLICT: {\r\n        code: 'DATABASE_TRANSACTION_CONFLICT',\r\n        message: 'database transaction conflict'\r\n    },\r\n    DATABASE_REQUEST_FAILED: {\r\n        code: 'DATABASE_REQUEST_FAILED',\r\n        message: 'database request failed'\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,SAAS;IAClB,wBAAwB;QACpB,MAAM;QACN,SAAS;IACb;IACA,2BAA2B;QACvB,MAAM;QACN,SAAS;IACb;IACA,2BAA2B;QACvB,MAAM;QACN,SAAS;IACb;IACA,YAAY;QACR,MAAM;QACN,SAAS;IACb;IACA,eAAe;QACX,MAAM;QACN,SAAS;IACb;IACA,iBAAiB;QACb,MAAM;QACN,SAAS;IACb;IACA,+BAA+B;QAC3B,MAAM;QACN,SAAS;IACb;IACA,yBAAyB;QACrB,MAAM;QACN,SAAS;IACb;AACJ","ignoreList":[0]}},
    {"offset": {"line": 756, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/utils/utils.js"],"sourcesContent":["import { EJSON } from 'bson';\r\nimport { isObject } from './type';\r\nexport const sleep = (ms = 0) => new Promise(r => setTimeout(r, ms));\r\nconst counters = {};\r\nexport const autoCount = (domain = 'any') => {\r\n    if (!counters[domain]) {\r\n        counters[domain] = 0;\r\n    }\r\n    return counters[domain]++;\r\n};\r\nexport const getReqOpts = (apiOptions) => {\r\n    if (apiOptions.timeout !== undefined) {\r\n        return {\r\n            timeout: apiOptions.timeout\r\n        };\r\n    }\r\n    return {};\r\n};\r\nexport const filterUndefined = o => {\r\n    if (!isObject(o)) {\r\n        return o;\r\n    }\r\n    for (let key in o) {\r\n        if (o[key] === undefined) {\r\n            delete o[key];\r\n        }\r\n        else if (isObject(o[key])) {\r\n            o[key] = filterUndefined(o[key]);\r\n        }\r\n    }\r\n    return o;\r\n};\r\nexport const stringifyByEJSON = params => {\r\n    params = filterUndefined(params);\r\n    return EJSON.stringify(params, { relaxed: false });\r\n};\r\nexport const parseByEJSON = params => {\r\n    return EJSON.parse(params);\r\n};\r\nexport class TcbError extends Error {\r\n    constructor(error) {\r\n        super(error.message);\r\n        this.code = error.code;\r\n        this.message = error.message;\r\n    }\r\n}\r\nexport const E = (errObj) => {\r\n    return new TcbError(errObj);\r\n};\r\nexport function processReturn(throwOnCode, res) {\r\n    if (throwOnCode === false) {\r\n        return res;\r\n    }\r\n    throw E(Object.assign({}, res));\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;;;AACO,MAAM,QAAQ,CAAC,KAAK,CAAC,GAAK,IAAI,QAAQ,CAAA,IAAK,WAAW,GAAG;AAChE,MAAM,WAAW,CAAC;AACX,MAAM,YAAY,CAAC,SAAS,KAAK;IACpC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE;QACnB,QAAQ,CAAC,OAAO,GAAG;IACvB;IACA,OAAO,QAAQ,CAAC,OAAO;AAC3B;AACO,MAAM,aAAa,CAAC;IACvB,IAAI,WAAW,OAAO,KAAK,WAAW;QAClC,OAAO;YACH,SAAS,WAAW,OAAO;QAC/B;IACJ;IACA,OAAO,CAAC;AACZ;AACO,MAAM,kBAAkB,CAAA;IAC3B,IAAI,CAAC,IAAA,yPAAQ,EAAC,IAAI;QACd,OAAO;IACX;IACA,IAAK,IAAI,OAAO,EAAG;QACf,IAAI,CAAC,CAAC,IAAI,KAAK,WAAW;YACtB,OAAO,CAAC,CAAC,IAAI;QACjB,OACK,IAAI,IAAA,yPAAQ,EAAC,CAAC,CAAC,IAAI,GAAG;YACvB,CAAC,CAAC,IAAI,GAAG,gBAAgB,CAAC,CAAC,IAAI;QACnC;IACJ;IACA,OAAO;AACX;AACO,MAAM,mBAAmB,CAAA;IAC5B,SAAS,gBAAgB;IACzB,OAAO,uMAAK,CAAC,SAAS,CAAC,QAAQ;QAAE,SAAS;IAAM;AACpD;AACO,MAAM,eAAe,CAAA;IACxB,OAAO,uMAAK,CAAC,KAAK,CAAC;AACvB;AACO,MAAM,iBAAiB;IAC1B,YAAY,KAAK,CAAE;QACf,KAAK,CAAC,MAAM,OAAO;QACnB,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;QACtB,IAAI,CAAC,OAAO,GAAG,MAAM,OAAO;IAChC;AACJ;AACO,MAAM,IAAI,CAAC;IACd,OAAO,IAAI,SAAS;AACxB;AACO,SAAS,cAAc,WAAW,EAAE,GAAG;IAC1C,IAAI,gBAAgB,OAAO;QACvB,OAAO;IACX;IACA,MAAM,EAAE,OAAO,MAAM,CAAC,CAAC,GAAG;AAC9B","ignoreList":[0]}},
    {"offset": {"line": 838, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/validate.js"],"sourcesContent":["import { ErrorCode, WhereFilterOpList, OrderDirectionList, FieldType } from './constant';\r\nimport { Util } from './util';\r\nimport { ERRORS } from './const/code';\r\nimport { E } from './utils/utils';\r\nimport { getType } from './utils/type';\r\nimport { SYMBOL_GEO_POINT } from './helper/symbol';\r\nconst validOptionsKeys = ['limit', 'offset', 'projection', 'order', 'multiple', 'timeout', 'raw'];\r\nexport class Validate {\r\n    static isGeopoint(point, degree) {\r\n        if (Util.whichType(degree) !== FieldType.Number) {\r\n            throw new Error('Geo Point must be number type');\r\n        }\r\n        const degreeAbs = Math.abs(degree);\r\n        if (point === 'latitude' && degreeAbs > 90) {\r\n            throw new Error('latitude should be a number ranges from -90 to 90');\r\n        }\r\n        else if (point === 'longitude' && degreeAbs > 180) {\r\n            throw new Error('longitude should be a number ranges from -180 to 180');\r\n        }\r\n        return true;\r\n    }\r\n    static isInteger(param, num) {\r\n        if (!Number.isInteger(num)) {\r\n            throw new Error(param + ErrorCode.IntergerError);\r\n        }\r\n        return true;\r\n    }\r\n    static mustBeBoolean(param, bool) {\r\n        if (typeof bool !== 'boolean') {\r\n            throw new Error(param + ErrorCode.BooleanError);\r\n        }\r\n        return true;\r\n    }\r\n    static isProjection(param, value) {\r\n        if (getType(value) !== 'object') {\r\n            throw E(Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: `${param} projection must be an object` }));\r\n        }\r\n        for (const key in value) {\r\n            const subValue = value[key];\r\n            if (getType(subValue) === 'number') {\r\n                if (subValue !== 0 && subValue !== 1) {\r\n                    throw E(Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: `if the value in projection is of number, it must be 0 or 1` }));\r\n                }\r\n            }\r\n            else if (getType(subValue) === 'object') {\r\n            }\r\n            else {\r\n                throw E(Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: 'invalid projection' }));\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    static isOrder(param, value) {\r\n        if (getType(value) !== 'object') {\r\n            throw E(Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: `${param} order must be an object` }));\r\n        }\r\n        for (let key in value) {\r\n            const subValue = value[key];\r\n            if (subValue !== 1 && subValue !== -1) {\r\n                throw E(Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: `order value must be 1 or -1` }));\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    static isFieldOrder(direction) {\r\n        if (OrderDirectionList.indexOf(direction) === -1) {\r\n            throw new Error(ErrorCode.DirectionError);\r\n        }\r\n        return true;\r\n    }\r\n    static isFieldPath(path) {\r\n        if (!/^[a-zA-Z0-9-_\\.]/.test(path)) {\r\n            throw new Error();\r\n        }\r\n        return true;\r\n    }\r\n    static isOperator(op) {\r\n        if (WhereFilterOpList.indexOf(op) === -1) {\r\n            throw new Error(ErrorCode.OpStrError);\r\n        }\r\n        return true;\r\n    }\r\n    static isCollName(name) {\r\n        if (!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(name)) {\r\n            throw new Error(ErrorCode.CollNameError);\r\n        }\r\n        return true;\r\n    }\r\n    static isDocID(docId) {\r\n        if (!/^([a-fA-F0-9]){24}$/.test(docId)) {\r\n            throw new Error(ErrorCode.DocIDError);\r\n        }\r\n        return true;\r\n    }\r\n    static isValidOptions(options = {}) {\r\n        if (getType(options) !== 'object') {\r\n            throw E(Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: `options must be an object` }));\r\n        }\r\n        const keys = Object.keys(options);\r\n        for (const index in keys) {\r\n            if (validOptionsKeys.indexOf(keys[index]) < 0) {\r\n                throw E(Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: `${keys[index]} is invalid options key` }));\r\n            }\r\n        }\r\n        const { limit, offset, projection, order } = options;\r\n        const { multiple } = options;\r\n        if (limit !== undefined) {\r\n            Validate.isInteger('limit', limit);\r\n        }\r\n        if (offset !== undefined) {\r\n            Validate.isInteger('offset', offset);\r\n        }\r\n        if (projection !== undefined) {\r\n            Validate.isProjection('projection', projection);\r\n        }\r\n        if (order !== undefined) {\r\n            Validate.isOrder('order', order);\r\n        }\r\n        if (multiple !== undefined) {\r\n            Validate.mustBeBoolean('multiple', multiple);\r\n        }\r\n        if (options.timeout !== undefined) {\r\n            Validate.isInteger('timeout', options.timeout);\r\n        }\r\n        return true;\r\n    }\r\n    static isValidAggregation(stage) {\r\n        if (Object.keys(stage).length !== 1) {\r\n            throw E(Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: `aggregation stage must have one key` }));\r\n        }\r\n        return true;\r\n    }\r\n    static isCentersPhere(param) {\r\n        if (Array.isArray(param) && param.length === 2) {\r\n            if (getType(param[0]) === 'object' &&\r\n                param[0]._internalType === SYMBOL_GEO_POINT &&\r\n                typeof param[1] === 'number') {\r\n                return true;\r\n            }\r\n            if (Array.isArray(param[0]) && param[0].length === 2) {\r\n                const longitude = param[0][0];\r\n                const latitude = param[0][1];\r\n                Validate.isGeopoint('longitude', longitude);\r\n                Validate.isGeopoint('latitude', latitude);\r\n                if (typeof param[1] === 'number') {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        throw new Error(`${ErrorCode.CentersPhereError}`);\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1022, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/geo/point.js"],"sourcesContent":["import { Validate } from '../validate';\r\nimport { SYMBOL_GEO_POINT } from '../helper/symbol';\r\nimport { isArray } from '../utils/type';\r\nexport class Point {\r\n    constructor(longitude, latitude) {\r\n        Validate.isGeopoint('longitude', longitude);\r\n        Validate.isGeopoint('latitude', latitude);\r\n        this.longitude = longitude;\r\n        this.latitude = latitude;\r\n    }\r\n    parse(key) {\r\n        return {\r\n            [key]: {\r\n                type: 'Point',\r\n                coordinates: [this.longitude, this.latitude]\r\n            }\r\n        };\r\n    }\r\n    toJSON() {\r\n        return {\r\n            type: 'Point',\r\n            coordinates: [\r\n                this.longitude,\r\n                this.latitude,\r\n            ],\r\n        };\r\n    }\r\n    toReadableString() {\r\n        return `[${this.longitude},${this.latitude}]`;\r\n    }\r\n    static validate(point) {\r\n        return point.type === 'Point' &&\r\n            isArray(point.coordinates) &&\r\n            Validate.isGeopoint('longitude', point.coordinates[0]) &&\r\n            Validate.isGeopoint('latitude', point.coordinates[1]);\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_GEO_POINT;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AACO,MAAM;IACT,YAAY,SAAS,EAAE,QAAQ,CAAE;QAC7B,oPAAQ,CAAC,UAAU,CAAC,aAAa;QACjC,oPAAQ,CAAC,UAAU,CAAC,YAAY;QAChC,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,QAAQ,GAAG;IACpB;IACA,MAAM,GAAG,EAAE;QACP,OAAO;YACH,CAAC,IAAI,EAAE;gBACH,MAAM;gBACN,aAAa;oBAAC,IAAI,CAAC,SAAS;oBAAE,IAAI,CAAC,QAAQ;iBAAC;YAChD;QACJ;IACJ;IACA,SAAS;QACL,OAAO;YACH,MAAM;YACN,aAAa;gBACT,IAAI,CAAC,SAAS;gBACd,IAAI,CAAC,QAAQ;aAChB;QACL;IACJ;IACA,mBAAmB;QACf,OAAO,CAAC,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;IACjD;IACA,OAAO,SAAS,KAAK,EAAE;QACnB,OAAO,MAAM,IAAI,KAAK,WAClB,IAAA,wPAAO,EAAC,MAAM,WAAW,KACzB,oPAAQ,CAAC,UAAU,CAAC,aAAa,MAAM,WAAW,CAAC,EAAE,KACrD,oPAAQ,CAAC,UAAU,CAAC,YAAY,MAAM,WAAW,CAAC,EAAE;IAC5D;IACA,IAAI,gBAAgB;QAChB,OAAO,oRAAgB;IAC3B;AACJ","ignoreList":[0]}},
    {"offset": {"line": 1098, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/commands/update.js"],"sourcesContent":["import { SYMBOL_UNSET_FIELD_NAME, SYMBOL_UPDATE_COMMAND } from '../helper/symbol';\r\nexport var UPDATE_COMMANDS_LITERAL;\r\n(function (UPDATE_COMMANDS_LITERAL) {\r\n    UPDATE_COMMANDS_LITERAL[\"SET\"] = \"set\";\r\n    UPDATE_COMMANDS_LITERAL[\"REMOVE\"] = \"remove\";\r\n    UPDATE_COMMANDS_LITERAL[\"INC\"] = \"inc\";\r\n    UPDATE_COMMANDS_LITERAL[\"MUL\"] = \"mul\";\r\n    UPDATE_COMMANDS_LITERAL[\"PUSH\"] = \"push\";\r\n    UPDATE_COMMANDS_LITERAL[\"PULL\"] = \"pull\";\r\n    UPDATE_COMMANDS_LITERAL[\"PULL_ALL\"] = \"pullAll\";\r\n    UPDATE_COMMANDS_LITERAL[\"POP\"] = \"pop\";\r\n    UPDATE_COMMANDS_LITERAL[\"SHIFT\"] = \"shift\";\r\n    UPDATE_COMMANDS_LITERAL[\"UNSHIFT\"] = \"unshift\";\r\n    UPDATE_COMMANDS_LITERAL[\"ADD_TO_SET\"] = \"addToSet\";\r\n    UPDATE_COMMANDS_LITERAL[\"BIT\"] = \"bit\";\r\n    UPDATE_COMMANDS_LITERAL[\"RENAME\"] = \"rename\";\r\n    UPDATE_COMMANDS_LITERAL[\"MAX\"] = \"max\";\r\n    UPDATE_COMMANDS_LITERAL[\"MIN\"] = \"min\";\r\n})(UPDATE_COMMANDS_LITERAL || (UPDATE_COMMANDS_LITERAL = {}));\r\nexport class UpdateCommand {\r\n    constructor(operator, operands, fieldName) {\r\n        this._internalType = SYMBOL_UPDATE_COMMAND;\r\n        Object.defineProperties(this, {\r\n            _internalType: {\r\n                enumerable: false,\r\n                configurable: false,\r\n            },\r\n        });\r\n        this.operator = operator;\r\n        this.operands = operands;\r\n        this.fieldName = fieldName || SYMBOL_UNSET_FIELD_NAME;\r\n    }\r\n    _setFieldName(fieldName) {\r\n        const command = new UpdateCommand(this.operator, this.operands, fieldName);\r\n        return command;\r\n    }\r\n}\r\nexport function isUpdateCommand(object) {\r\n    return object && (object instanceof UpdateCommand) && (object._internalType === SYMBOL_UPDATE_COMMAND);\r\n}\r\nexport function isKnownUpdateCommand(object) {\r\n    return isUpdateCommand(object) && (object.operator.toUpperCase() in UPDATE_COMMANDS_LITERAL);\r\n}\r\nexport default UpdateCommand;\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AACO,IAAI;AACX,CAAC,SAAU,uBAAuB;IAC9B,uBAAuB,CAAC,MAAM,GAAG;IACjC,uBAAuB,CAAC,SAAS,GAAG;IACpC,uBAAuB,CAAC,MAAM,GAAG;IACjC,uBAAuB,CAAC,MAAM,GAAG;IACjC,uBAAuB,CAAC,OAAO,GAAG;IAClC,uBAAuB,CAAC,OAAO,GAAG;IAClC,uBAAuB,CAAC,WAAW,GAAG;IACtC,uBAAuB,CAAC,MAAM,GAAG;IACjC,uBAAuB,CAAC,QAAQ,GAAG;IACnC,uBAAuB,CAAC,UAAU,GAAG;IACrC,uBAAuB,CAAC,aAAa,GAAG;IACxC,uBAAuB,CAAC,MAAM,GAAG;IACjC,uBAAuB,CAAC,SAAS,GAAG;IACpC,uBAAuB,CAAC,MAAM,GAAG;IACjC,uBAAuB,CAAC,MAAM,GAAG;AACrC,CAAC,EAAE,2BAA2B,CAAC,0BAA0B,CAAC,CAAC;AACpD,MAAM;IACT,YAAY,QAAQ,EAAE,QAAQ,EAAE,SAAS,CAAE;QACvC,IAAI,CAAC,aAAa,GAAG,yRAAqB;QAC1C,OAAO,gBAAgB,CAAC,IAAI,EAAE;YAC1B,eAAe;gBACX,YAAY;gBACZ,cAAc;YAClB;QACJ;QACA,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,SAAS,GAAG,aAAa,2RAAuB;IACzD;IACA,cAAc,SAAS,EAAE;QACrB,MAAM,UAAU,IAAI,cAAc,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE;QAChE,OAAO;IACX;AACJ;AACO,SAAS,gBAAgB,MAAM;IAClC,OAAO,UAAW,kBAAkB,iBAAmB,OAAO,aAAa,KAAK,yRAAqB;AACzG;AACO,SAAS,qBAAqB,MAAM;IACvC,OAAO,gBAAgB,WAAY,OAAO,QAAQ,CAAC,WAAW,MAAM;AACxE;uCACe","ignoreList":[0]}},
    {"offset": {"line": 1159, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/commands/logic.js"],"sourcesContent":["import { SYMBOL_UNSET_FIELD_NAME, SYMBOL_LOGIC_COMMAND } from '../helper/symbol';\r\nimport { isQueryCommand } from './query';\r\nexport const AND = 'and';\r\nexport const OR = 'or';\r\nexport const NOT = 'not';\r\nexport const NOR = 'nor';\r\nexport var LOGIC_COMMANDS_LITERAL;\r\n(function (LOGIC_COMMANDS_LITERAL) {\r\n    LOGIC_COMMANDS_LITERAL[\"AND\"] = \"and\";\r\n    LOGIC_COMMANDS_LITERAL[\"OR\"] = \"or\";\r\n    LOGIC_COMMANDS_LITERAL[\"NOT\"] = \"not\";\r\n    LOGIC_COMMANDS_LITERAL[\"NOR\"] = \"nor\";\r\n})(LOGIC_COMMANDS_LITERAL || (LOGIC_COMMANDS_LITERAL = {}));\r\nexport class LogicCommand {\r\n    constructor(operator, operands, fieldName) {\r\n        this._internalType = SYMBOL_LOGIC_COMMAND;\r\n        Object.defineProperties(this, {\r\n            _internalType: {\r\n                enumerable: false,\r\n                configurable: false,\r\n            },\r\n        });\r\n        this.operator = operator;\r\n        this.operands = operands;\r\n        this.fieldName = fieldName || SYMBOL_UNSET_FIELD_NAME;\r\n        if (this.fieldName !== SYMBOL_UNSET_FIELD_NAME) {\r\n            if (Array.isArray(operands)) {\r\n                operands = operands.slice();\r\n                this.operands = operands;\r\n                for (let i = 0, len = operands.length; i < len; i++) {\r\n                    const query = operands[i];\r\n                    if (isLogicCommand(query) || isQueryCommand(query)) {\r\n                        operands[i] = query._setFieldName(this.fieldName);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                const query = operands;\r\n                if (isLogicCommand(query) || isQueryCommand(query)) {\r\n                    operands = query._setFieldName(this.fieldName);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _setFieldName(fieldName) {\r\n        const operands = this.operands.map(operand => {\r\n            if (operand instanceof LogicCommand) {\r\n                return operand._setFieldName(fieldName);\r\n            }\r\n            else {\r\n                return operand;\r\n            }\r\n        });\r\n        const command = new LogicCommand(this.operator, operands, fieldName);\r\n        return command;\r\n    }\r\n    and(...__expressions__) {\r\n        const expressions = Array.isArray(arguments[0]) ? arguments[0] : Array.from(arguments);\r\n        expressions.unshift(this);\r\n        return new LogicCommand(LOGIC_COMMANDS_LITERAL.AND, expressions, this.fieldName);\r\n    }\r\n    or(...__expressions__) {\r\n        const expressions = Array.isArray(arguments[0]) ? arguments[0] : Array.from(arguments);\r\n        expressions.unshift(this);\r\n        return new LogicCommand(LOGIC_COMMANDS_LITERAL.OR, expressions, this.fieldName);\r\n    }\r\n}\r\nexport function isLogicCommand(object) {\r\n    return object && (object instanceof LogicCommand) && (object._internalType === SYMBOL_LOGIC_COMMAND);\r\n}\r\nexport function isKnownLogicCommand(object) {\r\n    return isLogicCommand && (object.operator.toUpperCase() in LOGIC_COMMANDS_LITERAL);\r\n}\r\nexport default LogicCommand;\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;;;AACO,MAAM,MAAM;AACZ,MAAM,KAAK;AACX,MAAM,MAAM;AACZ,MAAM,MAAM;AACZ,IAAI;AACX,CAAC,SAAU,sBAAsB;IAC7B,sBAAsB,CAAC,MAAM,GAAG;IAChC,sBAAsB,CAAC,KAAK,GAAG;IAC/B,sBAAsB,CAAC,MAAM,GAAG;IAChC,sBAAsB,CAAC,MAAM,GAAG;AACpC,CAAC,EAAE,0BAA0B,CAAC,yBAAyB,CAAC,CAAC;AAClD,MAAM;IACT,YAAY,QAAQ,EAAE,QAAQ,EAAE,SAAS,CAAE;QACvC,IAAI,CAAC,aAAa,GAAG,wRAAoB;QACzC,OAAO,gBAAgB,CAAC,IAAI,EAAE;YAC1B,eAAe;gBACX,YAAY;gBACZ,cAAc;YAClB;QACJ;QACA,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,SAAS,GAAG,aAAa,2RAAuB;QACrD,IAAI,IAAI,CAAC,SAAS,KAAK,2RAAuB,EAAE;YAC5C,IAAI,MAAM,OAAO,CAAC,WAAW;gBACzB,WAAW,SAAS,KAAK;gBACzB,IAAI,CAAC,QAAQ,GAAG;gBAChB,IAAK,IAAI,IAAI,GAAG,MAAM,SAAS,MAAM,EAAE,IAAI,KAAK,IAAK;oBACjD,MAAM,QAAQ,QAAQ,CAAC,EAAE;oBACzB,IAAI,eAAe,UAAU,IAAA,mQAAc,EAAC,QAAQ;wBAChD,QAAQ,CAAC,EAAE,GAAG,MAAM,aAAa,CAAC,IAAI,CAAC,SAAS;oBACpD;gBACJ;YACJ,OACK;gBACD,MAAM,QAAQ;gBACd,IAAI,eAAe,UAAU,IAAA,mQAAc,EAAC,QAAQ;oBAChD,WAAW,MAAM,aAAa,CAAC,IAAI,CAAC,SAAS;gBACjD;YACJ;QACJ;IACJ;IACA,cAAc,SAAS,EAAE;QACrB,MAAM,WAAW,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAA;YAC/B,IAAI,mBAAmB,cAAc;gBACjC,OAAO,QAAQ,aAAa,CAAC;YACjC,OACK;gBACD,OAAO;YACX;QACJ;QACA,MAAM,UAAU,IAAI,aAAa,IAAI,CAAC,QAAQ,EAAE,UAAU;QAC1D,OAAO;IACX;IACA,IAAI,GAAG,eAAe,EAAE;QACpB,MAAM,cAAc,MAAM,OAAO,CAAC,SAAS,CAAC,EAAE,IAAI,SAAS,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC;QAC5E,YAAY,OAAO,CAAC,IAAI;QACxB,OAAO,IAAI,aAAa,uBAAuB,GAAG,EAAE,aAAa,IAAI,CAAC,SAAS;IACnF;IACA,GAAG,GAAG,eAAe,EAAE;QACnB,MAAM,cAAc,MAAM,OAAO,CAAC,SAAS,CAAC,EAAE,IAAI,SAAS,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC;QAC5E,YAAY,OAAO,CAAC,IAAI;QACxB,OAAO,IAAI,aAAa,uBAAuB,EAAE,EAAE,aAAa,IAAI,CAAC,SAAS;IAClF;AACJ;AACO,SAAS,eAAe,MAAM;IACjC,OAAO,UAAW,kBAAkB,gBAAkB,OAAO,aAAa,KAAK,wRAAoB;AACvG;AACO,SAAS,oBAAoB,MAAM;IACtC,OAAO,kBAAmB,OAAO,QAAQ,CAAC,WAAW,MAAM;AAC/D;uCACe","ignoreList":[0]}},
    {"offset": {"line": 1257, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/commands/query.js"],"sourcesContent":["import { LogicCommand } from './logic';\r\nimport { SYMBOL_QUERY_COMMAND } from '../helper/symbol';\r\nimport { Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon } from '../geo/index';\r\nimport { isNumber } from '../utils/type';\r\nimport { Validate } from '../validate';\r\nexport const EQ = 'eq';\r\nexport const NEQ = 'neq';\r\nexport const GT = 'gt';\r\nexport const GTE = 'gte';\r\nexport const LT = 'lt';\r\nexport const LTE = 'lte';\r\nexport const IN = 'in';\r\nexport const NIN = 'nin';\r\nexport const ALL = 'all';\r\nexport const ELEM_MATCH = 'elemMatch';\r\nexport const EXISTS = 'exists';\r\nexport const SIZE = 'size';\r\nexport const MOD = 'mod';\r\nexport var QUERY_COMMANDS_LITERAL;\r\n(function (QUERY_COMMANDS_LITERAL) {\r\n    QUERY_COMMANDS_LITERAL[\"EQ\"] = \"eq\";\r\n    QUERY_COMMANDS_LITERAL[\"NEQ\"] = \"neq\";\r\n    QUERY_COMMANDS_LITERAL[\"GT\"] = \"gt\";\r\n    QUERY_COMMANDS_LITERAL[\"GTE\"] = \"gte\";\r\n    QUERY_COMMANDS_LITERAL[\"LT\"] = \"lt\";\r\n    QUERY_COMMANDS_LITERAL[\"LTE\"] = \"lte\";\r\n    QUERY_COMMANDS_LITERAL[\"IN\"] = \"in\";\r\n    QUERY_COMMANDS_LITERAL[\"NIN\"] = \"nin\";\r\n    QUERY_COMMANDS_LITERAL[\"ALL\"] = \"all\";\r\n    QUERY_COMMANDS_LITERAL[\"ELEM_MATCH\"] = \"elemMatch\";\r\n    QUERY_COMMANDS_LITERAL[\"EXISTS\"] = \"exists\";\r\n    QUERY_COMMANDS_LITERAL[\"SIZE\"] = \"size\";\r\n    QUERY_COMMANDS_LITERAL[\"MOD\"] = \"mod\";\r\n    QUERY_COMMANDS_LITERAL[\"GEO_NEAR\"] = \"geoNear\";\r\n    QUERY_COMMANDS_LITERAL[\"GEO_WITHIN\"] = \"geoWithin\";\r\n    QUERY_COMMANDS_LITERAL[\"GEO_INTERSECTS\"] = \"geoIntersects\";\r\n})(QUERY_COMMANDS_LITERAL || (QUERY_COMMANDS_LITERAL = {}));\r\nexport class QueryCommand extends LogicCommand {\r\n    constructor(operator, operands, fieldName) {\r\n        super(operator, operands, fieldName);\r\n        this.operator = operator;\r\n        this._internalType = SYMBOL_QUERY_COMMAND;\r\n    }\r\n    toJSON() {\r\n        switch (this.operator) {\r\n            case QUERY_COMMANDS_LITERAL.IN:\r\n            case QUERY_COMMANDS_LITERAL.NIN:\r\n                return {\r\n                    ['$' + this.operator]: this.operands\r\n                };\r\n            case QUERY_COMMANDS_LITERAL.NEQ:\r\n                return {\r\n                    ['$ne']: this.operands[0]\r\n                };\r\n            default:\r\n                return {\r\n                    ['$' + this.operator]: this.operands[0]\r\n                };\r\n        }\r\n    }\r\n    _setFieldName(fieldName) {\r\n        const command = new QueryCommand(this.operator, this.operands, fieldName);\r\n        return command;\r\n    }\r\n    eq(val) {\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.EQ, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    neq(val) {\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.NEQ, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    gt(val) {\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.GT, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    gte(val) {\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.GTE, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    lt(val) {\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.LT, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    lte(val) {\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.LTE, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    in(list) {\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.IN, list, this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    nin(list) {\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.NIN, list, this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    geoNear(val) {\r\n        if (!(val.geometry instanceof Point)) {\r\n            throw new TypeError(`\"geometry\" must be of type Point. Received type ${typeof val.geometry}`);\r\n        }\r\n        if (val.maxDistance !== undefined && !isNumber(val.maxDistance)) {\r\n            throw new TypeError(`\"maxDistance\" must be of type Number. Received type ${typeof val.maxDistance}`);\r\n        }\r\n        if (val.minDistance !== undefined && !isNumber(val.minDistance)) {\r\n            throw new TypeError(`\"minDistance\" must be of type Number. Received type ${typeof val.minDistance}`);\r\n        }\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_NEAR, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    geoWithin(val) {\r\n        if (!(val.geometry instanceof MultiPolygon) &&\r\n            !(val.geometry instanceof Polygon) &&\r\n            !Validate.isCentersPhere(val.centerSphere)) {\r\n            throw new TypeError(`\"geometry\" must be of type Polygon or MultiPolygon. Received type ${typeof val.geometry}`);\r\n        }\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_WITHIN, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n    geoIntersects(val) {\r\n        if (!(val.geometry instanceof Point) &&\r\n            !(val.geometry instanceof LineString) &&\r\n            !(val.geometry instanceof Polygon) &&\r\n            !(val.geometry instanceof MultiPoint) &&\r\n            !(val.geometry instanceof MultiLineString) &&\r\n            !(val.geometry instanceof MultiPolygon)) {\r\n            throw new TypeError(`\"geometry\" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type ${typeof val.geometry}`);\r\n        }\r\n        const command = new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_INTERSECTS, [val], this.fieldName);\r\n        return this.and(command);\r\n    }\r\n}\r\nexport function isQueryCommand(object) {\r\n    return object && object instanceof QueryCommand && object._internalType === SYMBOL_QUERY_COMMAND;\r\n}\r\nexport function isKnownQueryCommand(object) {\r\n    return isQueryCommand(object) && object.operator.toUpperCase() in QUERY_COMMANDS_LITERAL;\r\n}\r\nexport function isComparisonCommand(object) {\r\n    return isQueryCommand(object);\r\n}\r\nexport default QueryCommand;\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1463, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/operator-map.js"],"sourcesContent":["import { QUERY_COMMANDS_LITERAL } from './commands/query';\r\nimport { LOGIC_COMMANDS_LITERAL } from './commands/logic';\r\nimport { UPDATE_COMMANDS_LITERAL } from './commands/update';\r\nexport const OperatorMap = {};\r\nfor (const key in QUERY_COMMANDS_LITERAL) {\r\n    OperatorMap[key] = '$' + key;\r\n}\r\nfor (const key in LOGIC_COMMANDS_LITERAL) {\r\n    OperatorMap[key] = '$' + key;\r\n}\r\nfor (const key in UPDATE_COMMANDS_LITERAL) {\r\n    OperatorMap[key] = '$' + key;\r\n}\r\nOperatorMap[QUERY_COMMANDS_LITERAL.NEQ] = '$ne';\r\nOperatorMap[UPDATE_COMMANDS_LITERAL.REMOVE] = '$unset';\r\nOperatorMap[UPDATE_COMMANDS_LITERAL.SHIFT] = '$pop';\r\nOperatorMap[UPDATE_COMMANDS_LITERAL.UNSHIFT] = '$push';\r\nexport function operatorToString(operator) {\r\n    return OperatorMap[operator] || '$' + operator;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AACO,MAAM,cAAc,CAAC;AAC5B,IAAK,MAAM,OAAO,2QAAsB,CAAE;IACtC,WAAW,CAAC,IAAI,GAAG,MAAM;AAC7B;AACA,IAAK,MAAM,OAAO,2QAAsB,CAAE;IACtC,WAAW,CAAC,IAAI,GAAG,MAAM;AAC7B;AACA,IAAK,MAAM,OAAO,6QAAuB,CAAE;IACvC,WAAW,CAAC,IAAI,GAAG,MAAM;AAC7B;AACA,WAAW,CAAC,2QAAsB,CAAC,GAAG,CAAC,GAAG;AAC1C,WAAW,CAAC,6QAAuB,CAAC,MAAM,CAAC,GAAG;AAC9C,WAAW,CAAC,6QAAuB,CAAC,KAAK,CAAC,GAAG;AAC7C,WAAW,CAAC,6QAAuB,CAAC,OAAO,CAAC,GAAG;AACxC,SAAS,iBAAiB,QAAQ;IACrC,OAAO,WAAW,CAAC,SAAS,IAAI,MAAM;AAC1C","ignoreList":[0]}},
    {"offset": {"line": 1496, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/serverDate/index.js"],"sourcesContent":["import { SYMBOL_SERVER_DATE } from '../helper/symbol';\r\nexport class ServerDate {\r\n    constructor({ offset = 0 } = {}) {\r\n        this.offset = offset;\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_SERVER_DATE;\r\n    }\r\n    parse() {\r\n        return {\r\n            $tcb_server_date: {\r\n                offset: this.offset\r\n            }\r\n        };\r\n    }\r\n}\r\nexport function ServerDateConstructor(opt) {\r\n    return new ServerDate(opt);\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AACO,MAAM;IACT,YAAY,EAAE,SAAS,CAAC,EAAE,GAAG,CAAC,CAAC,CAAE;QAC7B,IAAI,CAAC,MAAM,GAAG;IAClB;IACA,IAAI,gBAAgB;QAChB,OAAO,sRAAkB;IAC7B;IACA,QAAQ;QACJ,OAAO;YACH,kBAAkB;gBACd,QAAQ,IAAI,CAAC,MAAM;YACvB;QACJ;IACJ;AACJ;AACO,SAAS,sBAAsB,GAAG;IACrC,OAAO,IAAI,WAAW;AAC1B","ignoreList":[0]}},
    {"offset": {"line": 1526, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/serializer/datatype.js"],"sourcesContent":["import { SYMBOL_GEO_POINT, SYMBOL_SERVER_DATE, SYMBOL_OBJECTID, SYMBOL_REGEXP } from '../helper/symbol';\r\nimport { getType, isObject, isArray, isDate, isNumber, isInternalObject, isRegExp } from '../utils/type';\r\nimport { Point } from '../geo/index';\r\nimport { ServerDate } from '../serverDate/index';\r\nexport function serialize(val) {\r\n    return serializeHelper(val, [val]);\r\n}\r\nfunction serializeHelper(val, visited) {\r\n    if (isInternalObject(val)) {\r\n        switch (val._internalType) {\r\n            case SYMBOL_GEO_POINT: {\r\n                return val.toJSON();\r\n            }\r\n            case SYMBOL_SERVER_DATE: {\r\n                return val.parse();\r\n            }\r\n            case SYMBOL_REGEXP: {\r\n                return val.parse();\r\n            }\r\n            case SYMBOL_OBJECTID: {\r\n                return val.parse();\r\n            }\r\n            default: {\r\n                return val.toJSON ? val.toJSON() : val;\r\n            }\r\n        }\r\n    }\r\n    else if (isDate(val)) {\r\n        return val;\r\n    }\r\n    else if (isRegExp(val)) {\r\n        return {\r\n            $regularExpression: {\r\n                pattern: val.source,\r\n                options: val.flags\r\n            }\r\n        };\r\n    }\r\n    else if (isArray(val)) {\r\n        return val.map(item => {\r\n            if (visited.indexOf(item) > -1) {\r\n                throw new Error('Cannot convert circular structure to JSON');\r\n            }\r\n            return serializeHelper(item, [...visited, item]);\r\n        });\r\n    }\r\n    else if (isObject(val)) {\r\n        const rawRet = Object.assign({}, val);\r\n        const finalRet = {};\r\n        for (const key in rawRet) {\r\n            if (visited.indexOf(rawRet[key]) > -1) {\r\n                throw new Error('Cannot convert circular structure to JSON');\r\n            }\r\n            if (rawRet[key] !== undefined) {\r\n                finalRet[key] = serializeHelper(rawRet[key], [...visited, rawRet[key]]);\r\n            }\r\n        }\r\n        return finalRet;\r\n    }\r\n    else {\r\n        return val;\r\n    }\r\n}\r\nexport function deserialize(object) {\r\n    const ret = Object.assign({}, object);\r\n    for (const key in ret) {\r\n        switch (key) {\r\n            case '$date': {\r\n                switch (getType(ret[key])) {\r\n                    case 'number': {\r\n                        return new Date(ret[key]);\r\n                    }\r\n                    case 'object': {\r\n                        return new ServerDate(ret[key]);\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case 'type': {\r\n                switch (ret.type) {\r\n                    case 'Point': {\r\n                        if (isArray(ret.coordinates) &&\r\n                            isNumber(ret.coordinates[0]) &&\r\n                            isNumber(ret.coordinates[1])) {\r\n                            return new Point(ret.coordinates[0], ret.coordinates[1]);\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    return object;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AACO,SAAS,UAAU,GAAG;IACzB,OAAO,gBAAgB,KAAK;QAAC;KAAI;AACrC;AACA,SAAS,gBAAgB,GAAG,EAAE,OAAO;IACjC,IAAI,IAAA,iQAAgB,EAAC,MAAM;QACvB,OAAQ,IAAI,aAAa;YACrB,KAAK,oRAAgB;gBAAE;oBACnB,OAAO,IAAI,MAAM;gBACrB;YACA,KAAK,sRAAkB;gBAAE;oBACrB,OAAO,IAAI,KAAK;gBACpB;YACA,KAAK,iRAAa;gBAAE;oBAChB,OAAO,IAAI,KAAK;gBACpB;YACA,KAAK,mRAAe;gBAAE;oBAClB,OAAO,IAAI,KAAK;gBACpB;YACA;gBAAS;oBACL,OAAO,IAAI,MAAM,GAAG,IAAI,MAAM,KAAK;gBACvC;QACJ;IACJ,OACK,IAAI,IAAA,uPAAM,EAAC,MAAM;QAClB,OAAO;IACX,OACK,IAAI,IAAA,yPAAQ,EAAC,MAAM;QACpB,OAAO;YACH,oBAAoB;gBAChB,SAAS,IAAI,MAAM;gBACnB,SAAS,IAAI,KAAK;YACtB;QACJ;IACJ,OACK,IAAI,IAAA,wPAAO,EAAC,MAAM;QACnB,OAAO,IAAI,GAAG,CAAC,CAAA;YACX,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,GAAG;gBAC5B,MAAM,IAAI,MAAM;YACpB;YACA,OAAO,gBAAgB,MAAM;mBAAI;gBAAS;aAAK;QACnD;IACJ,OACK,IAAI,IAAA,yPAAQ,EAAC,MAAM;QACpB,MAAM,SAAS,OAAO,MAAM,CAAC,CAAC,GAAG;QACjC,MAAM,WAAW,CAAC;QAClB,IAAK,MAAM,OAAO,OAAQ;YACtB,IAAI,QAAQ,OAAO,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,GAAG;gBACnC,MAAM,IAAI,MAAM;YACpB;YACA,IAAI,MAAM,CAAC,IAAI,KAAK,WAAW;gBAC3B,QAAQ,CAAC,IAAI,GAAG,gBAAgB,MAAM,CAAC,IAAI,EAAE;uBAAI;oBAAS,MAAM,CAAC,IAAI;iBAAC;YAC1E;QACJ;QACA,OAAO;IACX,OACK;QACD,OAAO;IACX;AACJ;AACO,SAAS,YAAY,MAAM;IAC9B,MAAM,MAAM,OAAO,MAAM,CAAC,CAAC,GAAG;IAC9B,IAAK,MAAM,OAAO,IAAK;QACnB,OAAQ;YACJ,KAAK;gBAAS;oBACV,OAAQ,IAAA,wPAAO,EAAC,GAAG,CAAC,IAAI;wBACpB,KAAK;4BAAU;gCACX,OAAO,IAAI,KAAK,GAAG,CAAC,IAAI;4BAC5B;wBACA,KAAK;4BAAU;gCACX,OAAO,IAAI,iQAAU,CAAC,GAAG,CAAC,IAAI;4BAClC;oBACJ;oBACA;gBACJ;YACA,KAAK;gBAAQ;oBACT,OAAQ,IAAI,IAAI;wBACZ,KAAK;4BAAS;gCACV,IAAI,IAAA,wPAAO,EAAC,IAAI,WAAW,KACvB,IAAA,yPAAQ,EAAC,IAAI,WAAW,CAAC,EAAE,KAC3B,IAAA,yPAAQ,EAAC,IAAI,WAAW,CAAC,EAAE,GAAG;oCAC9B,OAAO,IAAI,qPAAK,CAAC,IAAI,WAAW,CAAC,EAAE,EAAE,IAAI,WAAW,CAAC,EAAE;gCAC3D;gCACA;4BACJ;oBACJ;oBACA;gBACJ;QACJ;IACJ;IACA,OAAO;AACX","ignoreList":[0]}},
    {"offset": {"line": 1646, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/serializer/common.js"],"sourcesContent":["import { getType, isObject, isArray, isDate, isRegExp, isInternalObject } from '../utils/type';\r\nimport { serialize as serializeInternalDataType, deserialize as deserializeInternalDataType } from './datatype';\r\nfunction flatten(query, shouldPreserverObject, parents, visited) {\r\n    const cloned = Object.assign({}, query);\r\n    for (const key in query) {\r\n        if (/^\\$/.test(key))\r\n            continue;\r\n        const value = query[key];\r\n        if (value === undefined) {\r\n            delete cloned[key];\r\n            continue;\r\n        }\r\n        if (!value)\r\n            continue;\r\n        if (isObject(value) && !shouldPreserverObject(value)) {\r\n            if (visited.indexOf(value) > -1) {\r\n                throw new Error('Cannot convert circular structure to JSON');\r\n            }\r\n            const newParents = [...parents, key];\r\n            const newVisited = [...visited, value];\r\n            const flattenedChild = flatten(value, shouldPreserverObject, newParents, newVisited);\r\n            cloned[key] = flattenedChild;\r\n            let hasKeyNotCombined = false;\r\n            for (const childKey in flattenedChild) {\r\n                if (!/^\\$/.test(childKey)) {\r\n                    cloned[`${key}.${childKey}`] = flattenedChild[childKey];\r\n                    delete cloned[key][childKey];\r\n                }\r\n                else {\r\n                    hasKeyNotCombined = true;\r\n                }\r\n            }\r\n            if (!hasKeyNotCombined) {\r\n                delete cloned[key];\r\n            }\r\n        }\r\n    }\r\n    return cloned;\r\n}\r\nexport function flattenQueryObject(query) {\r\n    return flatten(query, isConversionRequired, [], [query]);\r\n}\r\nexport function flattenObject(object) {\r\n    return flatten(object, (_) => false, [], [object]);\r\n}\r\nexport function mergeConditionAfterEncode(query, condition, key) {\r\n    if (!condition[key]) {\r\n        delete query[key];\r\n    }\r\n    for (const conditionKey in condition) {\r\n        if (query[conditionKey]) {\r\n            if (isArray(query[conditionKey])) {\r\n                query[conditionKey].push(condition[conditionKey]);\r\n            }\r\n            else if (isObject(query[conditionKey])) {\r\n                if (isObject(condition[conditionKey])) {\r\n                    Object.assign(query[conditionKey], condition[conditionKey]);\r\n                }\r\n                else {\r\n                    console.warn(`unmergable condition, query is object but condition is ${getType(condition)}, can only overwrite`, condition, key);\r\n                    query[conditionKey] = condition[conditionKey];\r\n                }\r\n            }\r\n            else {\r\n                console.warn(`to-merge query is of type ${getType(query)}, can only overwrite`, query, condition, key);\r\n                query[conditionKey] = condition[conditionKey];\r\n            }\r\n        }\r\n        else {\r\n            query[conditionKey] = condition[conditionKey];\r\n        }\r\n    }\r\n}\r\nexport function isConversionRequired(val) {\r\n    return isInternalObject(val) || isDate(val) || isRegExp(val);\r\n}\r\nexport function encodeInternalDataType(val) {\r\n    return serializeInternalDataType(val);\r\n}\r\nexport function decodeInternalDataType(object) {\r\n    return deserializeInternalDataType(object);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;;;AACA,SAAS,QAAQ,KAAK,EAAE,qBAAqB,EAAE,OAAO,EAAE,OAAO;IAC3D,MAAM,SAAS,OAAO,MAAM,CAAC,CAAC,GAAG;IACjC,IAAK,MAAM,OAAO,MAAO;QACrB,IAAI,MAAM,IAAI,CAAC,MACX;QACJ,MAAM,QAAQ,KAAK,CAAC,IAAI;QACxB,IAAI,UAAU,WAAW;YACrB,OAAO,MAAM,CAAC,IAAI;YAClB;QACJ;QACA,IAAI,CAAC,OACD;QACJ,IAAI,IAAA,yPAAQ,EAAC,UAAU,CAAC,sBAAsB,QAAQ;YAClD,IAAI,QAAQ,OAAO,CAAC,SAAS,CAAC,GAAG;gBAC7B,MAAM,IAAI,MAAM;YACpB;YACA,MAAM,aAAa;mBAAI;gBAAS;aAAI;YACpC,MAAM,aAAa;mBAAI;gBAAS;aAAM;YACtC,MAAM,iBAAiB,QAAQ,OAAO,uBAAuB,YAAY;YACzE,MAAM,CAAC,IAAI,GAAG;YACd,IAAI,oBAAoB;YACxB,IAAK,MAAM,YAAY,eAAgB;gBACnC,IAAI,CAAC,MAAM,IAAI,CAAC,WAAW;oBACvB,MAAM,CAAC,GAAG,IAAI,CAAC,EAAE,UAAU,CAAC,GAAG,cAAc,CAAC,SAAS;oBACvD,OAAO,MAAM,CAAC,IAAI,CAAC,SAAS;gBAChC,OACK;oBACD,oBAAoB;gBACxB;YACJ;YACA,IAAI,CAAC,mBAAmB;gBACpB,OAAO,MAAM,CAAC,IAAI;YACtB;QACJ;IACJ;IACA,OAAO;AACX;AACO,SAAS,mBAAmB,KAAK;IACpC,OAAO,QAAQ,OAAO,sBAAsB,EAAE,EAAE;QAAC;KAAM;AAC3D;AACO,SAAS,cAAc,MAAM;IAChC,OAAO,QAAQ,QAAQ,CAAC,IAAM,OAAO,EAAE,EAAE;QAAC;KAAO;AACrD;AACO,SAAS,0BAA0B,KAAK,EAAE,SAAS,EAAE,GAAG;IAC3D,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;QACjB,OAAO,KAAK,CAAC,IAAI;IACrB;IACA,IAAK,MAAM,gBAAgB,UAAW;QAClC,IAAI,KAAK,CAAC,aAAa,EAAE;YACrB,IAAI,IAAA,wPAAO,EAAC,KAAK,CAAC,aAAa,GAAG;gBAC9B,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,CAAC,aAAa;YACpD,OACK,IAAI,IAAA,yPAAQ,EAAC,KAAK,CAAC,aAAa,GAAG;gBACpC,IAAI,IAAA,yPAAQ,EAAC,SAAS,CAAC,aAAa,GAAG;oBACnC,OAAO,MAAM,CAAC,KAAK,CAAC,aAAa,EAAE,SAAS,CAAC,aAAa;gBAC9D,OACK;oBACD,QAAQ,IAAI,CAAC,CAAC,uDAAuD,EAAE,IAAA,wPAAO,EAAC,WAAW,oBAAoB,CAAC,EAAE,WAAW;oBAC5H,KAAK,CAAC,aAAa,GAAG,SAAS,CAAC,aAAa;gBACjD;YACJ,OACK;gBACD,QAAQ,IAAI,CAAC,CAAC,0BAA0B,EAAE,IAAA,wPAAO,EAAC,OAAO,oBAAoB,CAAC,EAAE,OAAO,WAAW;gBAClG,KAAK,CAAC,aAAa,GAAG,SAAS,CAAC,aAAa;YACjD;QACJ,OACK;YACD,KAAK,CAAC,aAAa,GAAG,SAAS,CAAC,aAAa;QACjD;IACJ;AACJ;AACO,SAAS,qBAAqB,GAAG;IACpC,OAAO,IAAA,iQAAgB,EAAC,QAAQ,IAAA,uPAAM,EAAC,QAAQ,IAAA,yPAAQ,EAAC;AAC5D;AACO,SAAS,uBAAuB,GAAG;IACtC,OAAO,IAAA,mQAAyB,EAAC;AACrC;AACO,SAAS,uBAAuB,MAAM;IACzC,OAAO,IAAA,qQAA2B,EAAC;AACvC","ignoreList":[0]}},
    {"offset": {"line": 1751, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/serializer/update.js"],"sourcesContent":["import { UpdateCommand, isUpdateCommand, UPDATE_COMMANDS_LITERAL } from '../commands/update';\r\nimport { SYMBOL_UNSET_FIELD_NAME } from '../helper/symbol';\r\nimport { getType, isArray } from '../utils/type';\r\nimport { operatorToString } from '../operator-map';\r\nimport { flattenQueryObject, encodeInternalDataType, mergeConditionAfterEncode } from './common';\r\nimport { stringifyByEJSON } from '../utils/utils';\r\nexport class UpdateSerializer {\r\n    constructor() { }\r\n    static encode(query) {\r\n        const stringifier = new UpdateSerializer();\r\n        return stringifier.encodeUpdate(query);\r\n    }\r\n    static encodeEJSON(query, raw) {\r\n        const stringifier = new UpdateSerializer();\r\n        return stringifyByEJSON(raw ? query : stringifier.encodeUpdate(query));\r\n    }\r\n    encodeUpdate(query) {\r\n        if (isUpdateCommand(query)) {\r\n            return this.encodeUpdateCommand(query);\r\n        }\r\n        else if (getType(query) === 'object') {\r\n            return this.encodeUpdateObject(query);\r\n        }\r\n        else {\r\n            return query;\r\n        }\r\n    }\r\n    encodeUpdateCommand(query) {\r\n        if (query.fieldName === SYMBOL_UNSET_FIELD_NAME) {\r\n            throw new Error('Cannot encode a comparison command with unset field name');\r\n        }\r\n        switch (query.operator) {\r\n            case UPDATE_COMMANDS_LITERAL.PUSH:\r\n            case UPDATE_COMMANDS_LITERAL.PULL:\r\n            case UPDATE_COMMANDS_LITERAL.PULL_ALL:\r\n            case UPDATE_COMMANDS_LITERAL.POP:\r\n            case UPDATE_COMMANDS_LITERAL.SHIFT:\r\n            case UPDATE_COMMANDS_LITERAL.UNSHIFT:\r\n            case UPDATE_COMMANDS_LITERAL.ADD_TO_SET: {\r\n                return this.encodeArrayUpdateCommand(query);\r\n            }\r\n            default: {\r\n                return this.encodeFieldUpdateCommand(query);\r\n            }\r\n        }\r\n    }\r\n    encodeFieldUpdateCommand(query) {\r\n        const $op = operatorToString(query.operator);\r\n        switch (query.operator) {\r\n            case UPDATE_COMMANDS_LITERAL.REMOVE: {\r\n                return {\r\n                    [$op]: {\r\n                        [query.fieldName]: ''\r\n                    }\r\n                };\r\n            }\r\n            default: {\r\n                return {\r\n                    [$op]: {\r\n                        [query.fieldName]: query.operands[0]\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }\r\n    encodeArrayUpdateCommand(query) {\r\n        const $op = operatorToString(query.operator);\r\n        switch (query.operator) {\r\n            case UPDATE_COMMANDS_LITERAL.PUSH: {\r\n                let modifiers;\r\n                if (isArray(query.operands)) {\r\n                    modifiers = {\r\n                        $each: query.operands.map(encodeInternalDataType)\r\n                    };\r\n                }\r\n                else {\r\n                    modifiers = query.operands;\r\n                }\r\n                return {\r\n                    [$op]: {\r\n                        [query.fieldName]: modifiers\r\n                    }\r\n                };\r\n            }\r\n            case UPDATE_COMMANDS_LITERAL.UNSHIFT: {\r\n                const modifiers = {\r\n                    $each: query.operands.map(encodeInternalDataType),\r\n                    $position: 0\r\n                };\r\n                return {\r\n                    [$op]: {\r\n                        [query.fieldName]: modifiers\r\n                    }\r\n                };\r\n            }\r\n            case UPDATE_COMMANDS_LITERAL.POP: {\r\n                return {\r\n                    [$op]: {\r\n                        [query.fieldName]: 1\r\n                    }\r\n                };\r\n            }\r\n            case UPDATE_COMMANDS_LITERAL.SHIFT: {\r\n                return {\r\n                    [$op]: {\r\n                        [query.fieldName]: -1\r\n                    }\r\n                };\r\n            }\r\n            default: {\r\n                return {\r\n                    [$op]: {\r\n                        [query.fieldName]: encodeInternalDataType(query.operands)\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }\r\n    encodeUpdateObject(query) {\r\n        const flattened = flattenQueryObject(query);\r\n        for (const key in flattened) {\r\n            if (/^\\$/.test(key))\r\n                continue;\r\n            let val = flattened[key];\r\n            if (isUpdateCommand(val)) {\r\n                flattened[key] = val._setFieldName(key);\r\n                const condition = this.encodeUpdateCommand(flattened[key]);\r\n                mergeConditionAfterEncode(flattened, condition, key);\r\n            }\r\n            else {\r\n                flattened[key] = val = encodeInternalDataType(val);\r\n                const $setCommand = new UpdateCommand(UPDATE_COMMANDS_LITERAL.SET, [val], key);\r\n                const condition = this.encodeUpdateCommand($setCommand);\r\n                mergeConditionAfterEncode(flattened, condition, key);\r\n            }\r\n        }\r\n        return flattened;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 1910, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/realtime/message.js"],"sourcesContent":["export function genRequestId(prefix = '') {\r\n    return `${prefix ? `${prefix}_` : ''}${+new Date()}_${Math.random()}`;\r\n}\r\nexport function isInitEventMessage(msg) {\r\n    return msg.msgType === 'INIT_EVENT';\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,aAAa,SAAS,EAAE;IACpC,OAAO,GAAG,SAAS,GAAG,OAAO,CAAC,CAAC,GAAG,KAAK,CAAC,IAAI,OAAO,CAAC,EAAE,KAAK,MAAM,IAAI;AACzE;AACO,SAAS,mBAAmB,GAAG;IAClC,OAAO,IAAI,OAAO,KAAK;AAC3B","ignoreList":[0]}},
    {"offset": {"line": 1926, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/config/error.config.js"],"sourcesContent":["export const ERR_CODE = {\r\n    UNKNOWN_ERROR: 'UNKNOWN_ERROR',\r\n    SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL: 'SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL',\r\n    SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL: 'SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL',\r\n    SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL: 'SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL',\r\n    SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL: 'SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL',\r\n    SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG: 'SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG',\r\n    SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA: 'SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA',\r\n    SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR: 'SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR',\r\n    SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED: 'SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED',\r\n    SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL: 'SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL',\r\n    SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR: 'SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR'\r\n};\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,WAAW;IACpB,eAAe;IACf,gDAAgD;IAChD,qDAAqD;IACrD,mDAAmD;IACnD,iDAAiD;IACjD,iDAAiD;IACjD,4DAA4D;IAC5D,2DAA2D;IAC3D,4DAA4D;IAC5D,gDAAgD;IAChD,uDAAuD;AAC3D","ignoreList":[0]}},
    {"offset": {"line": 1947, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/utils/error.js"],"sourcesContent":["import { isString } from './type';\r\nimport { ERR_CODE } from '../config/error.config';\r\nexport class CloudSDKError extends Error {\r\n    constructor(options) {\r\n        super(options.errMsg);\r\n        this.errCode = 'UNKNOWN_ERROR';\r\n        Object.defineProperties(this, {\r\n            message: {\r\n                get() {\r\n                    return (`errCode: ${this.errCode} ${ERR_CODE[this.errCode] ||\r\n                        ''} | errMsg: ` + this.errMsg);\r\n                },\r\n                set(msg) {\r\n                    this.errMsg = msg;\r\n                }\r\n            }\r\n        });\r\n        this.errCode = options.errCode || 'UNKNOWN_ERROR';\r\n        this.errMsg = options.errMsg;\r\n    }\r\n    get message() {\r\n        return `errCode: ${this.errCode} | errMsg: ` + this.errMsg;\r\n    }\r\n    set message(msg) {\r\n        this.errMsg = msg;\r\n    }\r\n}\r\nexport function isSDKError(error) {\r\n    return (error && error instanceof Error && isString(error.errMsg));\r\n}\r\nexport const isGenericError = (e) => e.generic;\r\nexport class TimeoutError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n        this.type = 'timeout';\r\n        this.payload = null;\r\n        this.generic = true;\r\n    }\r\n}\r\nexport const isTimeoutError = (e) => e.type === 'timeout';\r\nexport class CancelledError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n        this.type = 'cancelled';\r\n        this.payload = null;\r\n        this.generic = true;\r\n    }\r\n}\r\nexport const isCancelledError = (e) => e.type === 'cancelled';\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;;;AACO,MAAM,sBAAsB;IAC/B,YAAY,OAAO,CAAE;QACjB,KAAK,CAAC,QAAQ,MAAM;QACpB,IAAI,CAAC,OAAO,GAAG;QACf,OAAO,gBAAgB,CAAC,IAAI,EAAE;YAC1B,SAAS;gBACL;oBACI,OAAQ,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE,qQAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,IACtD,GAAG,WAAW,CAAC,GAAG,IAAI,CAAC,MAAM;gBACrC;gBACA,KAAI,GAAG;oBACH,IAAI,CAAC,MAAM,GAAG;gBAClB;YACJ;QACJ;QACA,IAAI,CAAC,OAAO,GAAG,QAAQ,OAAO,IAAI;QAClC,IAAI,CAAC,MAAM,GAAG,QAAQ,MAAM;IAChC;IACA,IAAI,UAAU;QACV,OAAO,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,IAAI,CAAC,MAAM;IAC9D;IACA,IAAI,QAAQ,GAAG,EAAE;QACb,IAAI,CAAC,MAAM,GAAG;IAClB;AACJ;AACO,SAAS,WAAW,KAAK;IAC5B,OAAQ,SAAS,iBAAiB,SAAS,IAAA,yPAAQ,EAAC,MAAM,MAAM;AACpE;AACO,MAAM,iBAAiB,CAAC,IAAM,EAAE,OAAO;AACvC,MAAM,qBAAqB;IAC9B,YAAY,OAAO,CAAE;QACjB,KAAK,CAAC;QACN,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,OAAO,GAAG;IACnB;AACJ;AACO,MAAM,iBAAiB,CAAC,IAAM,EAAE,IAAI,KAAK;AACzC,MAAM,uBAAuB;IAChC,YAAY,OAAO,CAAE;QACjB,KAAK,CAAC;QACN,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,OAAO,GAAG;IACnB;AACJ;AACO,MAAM,mBAAmB,CAAC,IAAM,EAAE,IAAI,KAAK","ignoreList":[0]}},
    {"offset": {"line": 2017, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/realtime/listener.js"],"sourcesContent":["export class RealtimeListener {\r\n    constructor(options) {\r\n        this.close = options.close;\r\n        this.onChange = options.onChange;\r\n        this.onError = options.onError;\r\n        if (options.debug) {\r\n            Object.defineProperty(this, 'virtualClient', {\r\n                get: () => {\r\n                    return options.virtualClient;\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAO,MAAM;IACT,YAAY,OAAO,CAAE;QACjB,IAAI,CAAC,KAAK,GAAG,QAAQ,KAAK;QAC1B,IAAI,CAAC,QAAQ,GAAG,QAAQ,QAAQ;QAChC,IAAI,CAAC,OAAO,GAAG,QAAQ,OAAO;QAC9B,IAAI,QAAQ,KAAK,EAAE;YACf,OAAO,cAAc,CAAC,IAAI,EAAE,iBAAiB;gBACzC,KAAK;oBACD,OAAO,QAAQ,aAAa;gBAChC;YACJ;QACJ;IACJ;AACJ","ignoreList":[0]}},
    {"offset": {"line": 2039, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/realtime/snapshot.js"],"sourcesContent":["export class Snapshot {\r\n    constructor(options) {\r\n        const { id, docChanges, docs, msgType, type } = options;\r\n        let cachedDocChanges;\r\n        let cachedDocs;\r\n        Object.defineProperties(this, {\r\n            id: {\r\n                get: () => id,\r\n                enumerable: true\r\n            },\r\n            docChanges: {\r\n                get: () => {\r\n                    if (!cachedDocChanges) {\r\n                        cachedDocChanges = JSON.parse(JSON.stringify(docChanges));\r\n                    }\r\n                    return cachedDocChanges;\r\n                },\r\n                enumerable: true\r\n            },\r\n            docs: {\r\n                get: () => {\r\n                    if (!cachedDocs) {\r\n                        cachedDocs = JSON.parse(JSON.stringify(docs));\r\n                    }\r\n                    return cachedDocs;\r\n                },\r\n                enumerable: true\r\n            },\r\n            msgType: {\r\n                get: () => msgType,\r\n                enumerable: true\r\n            },\r\n            type: {\r\n                get: () => type,\r\n                enumerable: true\r\n            }\r\n        });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAO,MAAM;IACT,YAAY,OAAO,CAAE;QACjB,MAAM,EAAE,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG;QAChD,IAAI;QACJ,IAAI;QACJ,OAAO,gBAAgB,CAAC,IAAI,EAAE;YAC1B,IAAI;gBACA,KAAK,IAAM;gBACX,YAAY;YAChB;YACA,YAAY;gBACR,KAAK;oBACD,IAAI,CAAC,kBAAkB;wBACnB,mBAAmB,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;oBACjD;oBACA,OAAO;gBACX;gBACA,YAAY;YAChB;YACA,MAAM;gBACF,KAAK;oBACD,IAAI,CAAC,YAAY;wBACb,aAAa,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;oBAC3C;oBACA,OAAO;gBACX;gBACA,YAAY;YAChB;YACA,SAAS;gBACL,KAAK,IAAM;gBACX,YAAY;YAChB;YACA,MAAM;gBACF,KAAK,IAAM;gBACX,YAAY;YAChB;QACJ;IACJ;AACJ","ignoreList":[0]}},
    {"offset": {"line": 2086, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/realtime/error.js"],"sourcesContent":["export class RealtimeErrorMessageError extends Error {\r\n    constructor(serverErrorMsg) {\r\n        super(`Watch Error ${JSON.stringify(serverErrorMsg.msgData)} (requestid: ${serverErrorMsg.requestId})`);\r\n        this.isRealtimeErrorMessageError = true;\r\n        this.payload = serverErrorMsg;\r\n    }\r\n}\r\nexport const isRealtimeErrorMessageError = (e) => e && e.isRealtimeErrorMessageError;\r\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,kCAAkC;IAC3C,YAAY,cAAc,CAAE;QACxB,KAAK,CAAC,CAAC,YAAY,EAAE,KAAK,SAAS,CAAC,eAAe,OAAO,EAAE,aAAa,EAAE,eAAe,SAAS,CAAC,CAAC,CAAC;QACtG,IAAI,CAAC,2BAA2B,GAAG;QACnC,IAAI,CAAC,OAAO,GAAG;IACnB;AACJ;AACO,MAAM,8BAA8B,CAAC,IAAM,KAAK,EAAE,2BAA2B","ignoreList":[0]}},
    {"offset": {"line": 2104, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/realtime/virtual-websocket-client.js"],"sourcesContent":["import set from 'lodash.set';\r\nimport unset from 'lodash.unset';\r\nimport cloneDeep from 'lodash.clonedeep';\r\nimport { genRequestId } from './message';\r\nimport { CloudSDKError, isTimeoutError, CancelledError, isCancelledError } from '../utils/error';\r\nimport { ERR_CODE } from '../config/error.config';\r\nimport { sleep } from '../utils/utils';\r\nimport { RealtimeListener } from './listener';\r\nimport { Snapshot } from './snapshot';\r\nimport { isRealtimeErrorMessageError } from './error';\r\nvar WATCH_STATUS;\r\n(function (WATCH_STATUS) {\r\n    WATCH_STATUS[\"LOGGINGIN\"] = \"LOGGINGIN\";\r\n    WATCH_STATUS[\"INITING\"] = \"INITING\";\r\n    WATCH_STATUS[\"REBUILDING\"] = \"REBUILDING\";\r\n    WATCH_STATUS[\"ACTIVE\"] = \"ACTIVE\";\r\n    WATCH_STATUS[\"ERRORED\"] = \"ERRORED\";\r\n    WATCH_STATUS[\"CLOSING\"] = \"CLOSING\";\r\n    WATCH_STATUS[\"CLOSED\"] = \"CLOSED\";\r\n    WATCH_STATUS[\"PAUSED\"] = \"PAUSED\";\r\n    WATCH_STATUS[\"RESUMING\"] = \"RESUMING\";\r\n})(WATCH_STATUS || (WATCH_STATUS = {}));\r\nconst DEFAULT_WAIT_TIME_ON_UNKNOWN_ERROR = 100;\r\nconst DEFAULT_MAX_AUTO_RETRY_ON_ERROR = 2;\r\nconst DEFAULT_MAX_SEND_ACK_AUTO_RETRY_ON_ERROR = 2;\r\nconst DEFAULT_SEND_ACK_DEBOUNCE_TIMEOUT = 10 * 1000;\r\nconst DEFAULT_INIT_WATCH_TIMEOUT = 10 * 1000;\r\nconst DEFAULT_REBUILD_WATCH_TIMEOUT = 10 * 1000;\r\nexport class VirtualWebSocketClient {\r\n    constructor(options) {\r\n        this.watchStatus = WATCH_STATUS.INITING;\r\n        this._login = async (envId, refresh) => {\r\n            this.watchStatus = WATCH_STATUS.LOGGINGIN;\r\n            const loginResult = await this.login(envId, refresh);\r\n            if (!this.envId) {\r\n                this.envId = loginResult.envId;\r\n            }\r\n            return loginResult;\r\n        };\r\n        this.initWatch = async (forceRefreshLogin) => {\r\n            if (this._initWatchPromise) {\r\n                return this._initWatchPromise;\r\n            }\r\n            this._initWatchPromise = new Promise(async (resolve, reject) => {\r\n                try {\r\n                    if (this.watchStatus === WATCH_STATUS.PAUSED) {\r\n                        console.log('[realtime] initWatch cancelled on pause');\r\n                        return resolve();\r\n                    }\r\n                    const { envId } = await this._login(this.envId, forceRefreshLogin);\r\n                    if (this.watchStatus === WATCH_STATUS.PAUSED) {\r\n                        console.log('[realtime] initWatch cancelled on pause');\r\n                        return resolve();\r\n                    }\r\n                    this.watchStatus = WATCH_STATUS.INITING;\r\n                    const initWatchMsg = {\r\n                        watchId: this.watchId,\r\n                        requestId: genRequestId(),\r\n                        msgType: 'INIT_WATCH',\r\n                        msgData: {\r\n                            envId,\r\n                            collName: this.collectionName,\r\n                            query: this.query,\r\n                            limit: this.limit,\r\n                            orderBy: this.orderBy\r\n                        }\r\n                    };\r\n                    const initEventMsg = await this.send({\r\n                        msg: initWatchMsg,\r\n                        waitResponse: true,\r\n                        skipOnMessage: true,\r\n                        timeout: DEFAULT_INIT_WATCH_TIMEOUT\r\n                    });\r\n                    const { events, currEvent } = initEventMsg.msgData;\r\n                    this.sessionInfo = {\r\n                        queryID: initEventMsg.msgData.queryID,\r\n                        currentEventId: currEvent - 1,\r\n                        currentDocs: []\r\n                    };\r\n                    if (events.length > 0) {\r\n                        for (const e of events) {\r\n                            e.ID = currEvent;\r\n                        }\r\n                        this.handleServerEvents(initEventMsg);\r\n                    }\r\n                    else {\r\n                        this.sessionInfo.currentEventId = currEvent;\r\n                        const snapshot = new Snapshot({\r\n                            id: currEvent,\r\n                            docChanges: [],\r\n                            docs: [],\r\n                            type: 'init'\r\n                        });\r\n                        this.listener.onChange(snapshot);\r\n                        this.scheduleSendACK();\r\n                    }\r\n                    this.onWatchStart(this, this.sessionInfo.queryID);\r\n                    this.watchStatus = WATCH_STATUS.ACTIVE;\r\n                    this._availableRetries.INIT_WATCH = DEFAULT_MAX_AUTO_RETRY_ON_ERROR;\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    this.handleWatchEstablishmentError(e, {\r\n                        operationName: 'INIT_WATCH',\r\n                        resolve,\r\n                        reject\r\n                    });\r\n                }\r\n            });\r\n            let success = false;\r\n            try {\r\n                await this._initWatchPromise;\r\n                success = true;\r\n            }\r\n            finally {\r\n                this._initWatchPromise = undefined;\r\n            }\r\n            console.log(`[realtime] initWatch ${success ? 'success' : 'fail'}`);\r\n        };\r\n        this.rebuildWatch = async (forceRefreshLogin) => {\r\n            if (this._rebuildWatchPromise) {\r\n                return this._rebuildWatchPromise;\r\n            }\r\n            this._rebuildWatchPromise = new Promise(async (resolve, reject) => {\r\n                try {\r\n                    if (this.watchStatus === WATCH_STATUS.PAUSED) {\r\n                        console.log('[realtime] rebuildWatch cancelled on pause');\r\n                        return resolve();\r\n                    }\r\n                    const { envId } = await this._login(this.envId, forceRefreshLogin);\r\n                    if (!this.sessionInfo) {\r\n                        throw new Error('can not rebuildWatch without a successful initWatch (lack of sessionInfo)');\r\n                    }\r\n                    if (this.watchStatus === WATCH_STATUS.PAUSED) {\r\n                        console.log('[realtime] rebuildWatch cancelled on pause');\r\n                        return resolve();\r\n                    }\r\n                    this.watchStatus = WATCH_STATUS.REBUILDING;\r\n                    const rebuildWatchMsg = {\r\n                        watchId: this.watchId,\r\n                        requestId: genRequestId(),\r\n                        msgType: 'REBUILD_WATCH',\r\n                        msgData: {\r\n                            envId,\r\n                            collName: this.collectionName,\r\n                            queryID: this.sessionInfo.queryID,\r\n                            eventID: this.sessionInfo.currentEventId\r\n                        }\r\n                    };\r\n                    const nextEventMsg = await this.send({\r\n                        msg: rebuildWatchMsg,\r\n                        waitResponse: true,\r\n                        skipOnMessage: false,\r\n                        timeout: DEFAULT_REBUILD_WATCH_TIMEOUT\r\n                    });\r\n                    this.handleServerEvents(nextEventMsg);\r\n                    this.watchStatus = WATCH_STATUS.ACTIVE;\r\n                    this._availableRetries.REBUILD_WATCH = DEFAULT_MAX_AUTO_RETRY_ON_ERROR;\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    this.handleWatchEstablishmentError(e, {\r\n                        operationName: 'REBUILD_WATCH',\r\n                        resolve,\r\n                        reject\r\n                    });\r\n                }\r\n            });\r\n            let success = false;\r\n            try {\r\n                await this._rebuildWatchPromise;\r\n                success = true;\r\n            }\r\n            finally {\r\n                this._rebuildWatchPromise = undefined;\r\n            }\r\n            console.log(`[realtime] rebuildWatch ${success ? 'success' : 'fail'}`);\r\n        };\r\n        this.handleWatchEstablishmentError = async (e, options) => {\r\n            const isInitWatch = options.operationName === 'INIT_WATCH';\r\n            const abortWatch = () => {\r\n                this.closeWithError(new CloudSDKError({\r\n                    errCode: isInitWatch\r\n                        ? ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL\r\n                        : ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,\r\n                    errMsg: e\r\n                }));\r\n                options.reject(e);\r\n            };\r\n            const retry = (refreshLogin) => {\r\n                if (this.useRetryTicket(options.operationName)) {\r\n                    if (isInitWatch) {\r\n                        this._initWatchPromise = undefined;\r\n                        options.resolve(this.initWatch(refreshLogin));\r\n                    }\r\n                    else {\r\n                        this._rebuildWatchPromise = undefined;\r\n                        options.resolve(this.rebuildWatch(refreshLogin));\r\n                    }\r\n                }\r\n                else {\r\n                    abortWatch();\r\n                }\r\n            };\r\n            this.handleCommonError(e, {\r\n                onSignError: () => retry(true),\r\n                onTimeoutError: () => retry(false),\r\n                onNotRetryableError: abortWatch,\r\n                onCancelledError: options.reject,\r\n                onUnknownError: async () => {\r\n                    try {\r\n                        const onWSDisconnected = async () => {\r\n                            this.pause();\r\n                            await this.onceWSConnected();\r\n                            retry(true);\r\n                        };\r\n                        if (!this.isWSConnected()) {\r\n                            await onWSDisconnected();\r\n                        }\r\n                        else {\r\n                            await sleep(DEFAULT_WAIT_TIME_ON_UNKNOWN_ERROR);\r\n                            if (this.watchStatus === WATCH_STATUS.PAUSED) {\r\n                                options.reject(new CancelledError(`${options.operationName} cancelled due to pause after unknownError`));\r\n                            }\r\n                            else if (!this.isWSConnected()) {\r\n                                await onWSDisconnected();\r\n                            }\r\n                            else {\r\n                                retry(false);\r\n                            }\r\n                        }\r\n                    }\r\n                    catch (e) {\r\n                        retry(true);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.closeWatch = async () => {\r\n            const queryId = this.sessionInfo ? this.sessionInfo.queryID : '';\r\n            if (this.watchStatus !== WATCH_STATUS.ACTIVE) {\r\n                this.watchStatus = WATCH_STATUS.CLOSED;\r\n                this.onWatchClose(this, queryId);\r\n                return;\r\n            }\r\n            try {\r\n                this.watchStatus = WATCH_STATUS.CLOSING;\r\n                const closeWatchMsg = {\r\n                    watchId: this.watchId,\r\n                    requestId: genRequestId(),\r\n                    msgType: 'CLOSE_WATCH',\r\n                    msgData: null\r\n                };\r\n                await this.send({\r\n                    msg: closeWatchMsg\r\n                });\r\n                this.sessionInfo = undefined;\r\n                this.watchStatus = WATCH_STATUS.CLOSED;\r\n            }\r\n            catch (e) {\r\n                this.closeWithError(new CloudSDKError({\r\n                    errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,\r\n                    errMsg: e\r\n                }));\r\n            }\r\n            finally {\r\n                this.onWatchClose(this, queryId);\r\n            }\r\n        };\r\n        this.scheduleSendACK = () => {\r\n            this.clearACKSchedule();\r\n            this._ackTimeoutId = setTimeout(() => {\r\n                if (this._waitExpectedTimeoutId) {\r\n                    this.scheduleSendACK();\r\n                }\r\n                else {\r\n                    this.sendACK();\r\n                }\r\n            }, DEFAULT_SEND_ACK_DEBOUNCE_TIMEOUT);\r\n        };\r\n        this.clearACKSchedule = () => {\r\n            if (this._ackTimeoutId) {\r\n                clearTimeout(this._ackTimeoutId);\r\n            }\r\n        };\r\n        this.sendACK = async () => {\r\n            try {\r\n                if (this.watchStatus !== WATCH_STATUS.ACTIVE) {\r\n                    this.scheduleSendACK();\r\n                    return;\r\n                }\r\n                if (!this.sessionInfo) {\r\n                    console.warn('[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)');\r\n                    return;\r\n                }\r\n                const ackMsg = {\r\n                    watchId: this.watchId,\r\n                    requestId: genRequestId(),\r\n                    msgType: 'CHECK_LAST',\r\n                    msgData: {\r\n                        queryID: this.sessionInfo.queryID,\r\n                        eventID: this.sessionInfo.currentEventId\r\n                    }\r\n                };\r\n                await this.send({\r\n                    msg: ackMsg\r\n                });\r\n                this.scheduleSendACK();\r\n            }\r\n            catch (e) {\r\n                if (isRealtimeErrorMessageError(e)) {\r\n                    const msg = e.payload;\r\n                    switch (msg.msgData.code) {\r\n                        case 'CHECK_LOGIN_FAILED':\r\n                        case 'SIGN_EXPIRED_ERROR':\r\n                        case 'SIGN_INVALID_ERROR':\r\n                        case 'SIGN_PARAM_INVALID': {\r\n                            this.rebuildWatch();\r\n                            return;\r\n                        }\r\n                        case 'QUERYID_INVALID_ERROR':\r\n                        case 'SYS_ERR':\r\n                        case 'INVALIID_ENV':\r\n                        case 'COLLECTION_PERMISSION_DENIED': {\r\n                            this.closeWithError(new CloudSDKError({\r\n                                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,\r\n                                errMsg: msg.msgData.code\r\n                            }));\r\n                            return;\r\n                        }\r\n                        default: {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                if (this._availableRetries.CHECK_LAST &&\r\n                    this._availableRetries.CHECK_LAST > 0) {\r\n                    this._availableRetries.CHECK_LAST--;\r\n                    this.scheduleSendACK();\r\n                }\r\n                else {\r\n                    this.closeWithError(new CloudSDKError({\r\n                        errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,\r\n                        errMsg: e\r\n                    }));\r\n                }\r\n            }\r\n        };\r\n        this.handleCommonError = (e, options) => {\r\n            if (isRealtimeErrorMessageError(e)) {\r\n                const msg = e.payload;\r\n                switch (msg.msgData.code) {\r\n                    case 'CHECK_LOGIN_FAILED':\r\n                    case 'SIGN_EXPIRED_ERROR':\r\n                    case 'SIGN_INVALID_ERROR':\r\n                    case 'SIGN_PARAM_INVALID': {\r\n                        options.onSignError(e);\r\n                        return;\r\n                    }\r\n                    case 'QUERYID_INVALID_ERROR':\r\n                    case 'SYS_ERR':\r\n                    case 'INVALIID_ENV':\r\n                    case 'COLLECTION_PERMISSION_DENIED': {\r\n                        options.onNotRetryableError(e);\r\n                        return;\r\n                    }\r\n                    default: {\r\n                        options.onNotRetryableError(e);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            else if (isTimeoutError(e)) {\r\n                options.onTimeoutError(e);\r\n                return;\r\n            }\r\n            else if (isCancelledError(e)) {\r\n                options.onCancelledError(e);\r\n                return;\r\n            }\r\n            options.onUnknownError(e);\r\n        };\r\n        this.watchId = `watchid_${+new Date()}_${Math.random()}`;\r\n        this.envId = options.envId;\r\n        this.collectionName = options.collectionName;\r\n        this.query = options.query;\r\n        this.limit = options.limit;\r\n        this.orderBy = options.orderBy;\r\n        this.send = options.send;\r\n        this.login = options.login;\r\n        this.isWSConnected = options.isWSConnected;\r\n        this.onceWSConnected = options.onceWSConnected;\r\n        this.getWaitExpectedTimeoutLength = options.getWaitExpectedTimeoutLength;\r\n        this.onWatchStart = options.onWatchStart;\r\n        this.onWatchClose = options.onWatchClose;\r\n        this.debug = options.debug;\r\n        this._availableRetries = {\r\n            INIT_WATCH: DEFAULT_MAX_AUTO_RETRY_ON_ERROR,\r\n            REBUILD_WATCH: DEFAULT_MAX_AUTO_RETRY_ON_ERROR,\r\n            CHECK_LAST: DEFAULT_MAX_SEND_ACK_AUTO_RETRY_ON_ERROR\r\n        };\r\n        this.listener = new RealtimeListener({\r\n            close: this.closeWatch,\r\n            onChange: options.onChange,\r\n            onError: options.onError,\r\n            debug: this.debug,\r\n            virtualClient: this\r\n        });\r\n        this.initWatch();\r\n    }\r\n    useRetryTicket(operationName) {\r\n        if (this._availableRetries[operationName] &&\r\n            this._availableRetries[operationName] > 0) {\r\n            this._availableRetries[operationName]--;\r\n            console.log(`[realtime] ${operationName} use a retry ticket, now only ${this._availableRetries[operationName]} retry left`);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    async handleServerEvents(msg) {\r\n        try {\r\n            this.scheduleSendACK();\r\n            await this._handleServerEvents(msg);\r\n            this._postHandleServerEventsValidityCheck(msg);\r\n        }\r\n        catch (e) {\r\n            console.error('[realtime listener] internal non-fatal error: handle server events failed with error: ', e);\r\n            throw e;\r\n        }\r\n    }\r\n    async _handleServerEvents(msg) {\r\n        const { requestId } = msg;\r\n        const { events } = msg.msgData;\r\n        const { msgType } = msg;\r\n        if (!events.length || !this.sessionInfo) {\r\n            return;\r\n        }\r\n        const sessionInfo = this.sessionInfo;\r\n        let allChangeEvents;\r\n        try {\r\n            allChangeEvents = events.map(getPublicEvent);\r\n        }\r\n        catch (e) {\r\n            this.closeWithError(new CloudSDKError({\r\n                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,\r\n                errMsg: e\r\n            }));\r\n            return;\r\n        }\r\n        let docs = [...sessionInfo.currentDocs];\r\n        let initEncountered = false;\r\n        for (let i = 0, len = allChangeEvents.length; i < len; i++) {\r\n            const change = allChangeEvents[i];\r\n            if (sessionInfo.currentEventId >= change.id) {\r\n                if (!allChangeEvents[i - 1] || change.id > allChangeEvents[i - 1].id) {\r\n                    console.warn(`[realtime] duplicate event received, cur ${sessionInfo.currentEventId} but got ${change.id}`);\r\n                }\r\n                else {\r\n                    console.error(`[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId ${requestId})`);\r\n                }\r\n                continue;\r\n            }\r\n            else if (sessionInfo.currentEventId === change.id - 1) {\r\n                switch (change.dataType) {\r\n                    case 'update': {\r\n                        if (!change.doc) {\r\n                            switch (change.queueType) {\r\n                                case 'update':\r\n                                case 'dequeue': {\r\n                                    const localDoc = docs.find(doc => doc._id === change.docId);\r\n                                    if (localDoc) {\r\n                                        const doc = cloneDeep(localDoc);\r\n                                        if (change.updatedFields) {\r\n                                            for (const fieldPath in change.updatedFields) {\r\n                                                set(doc, fieldPath, change.updatedFields[fieldPath]);\r\n                                            }\r\n                                        }\r\n                                        if (change.removedFields) {\r\n                                            for (const fieldPath of change.removedFields) {\r\n                                                unset(doc, fieldPath);\r\n                                            }\r\n                                        }\r\n                                        change.doc = doc;\r\n                                    }\r\n                                    else {\r\n                                        console.error('[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated.');\r\n                                    }\r\n                                    break;\r\n                                }\r\n                                case 'enqueue': {\r\n                                    const err = new CloudSDKError({\r\n                                        errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,\r\n                                        errMsg: `HandleServerEvents: full doc is not provided with dataType=\"update\" and queueType=\"enqueue\" (requestId ${msg.requestId})`\r\n                                    });\r\n                                    this.closeWithError(err);\r\n                                    throw err;\r\n                                }\r\n                                default: {\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                    case 'replace': {\r\n                        if (!change.doc) {\r\n                            const err = new CloudSDKError({\r\n                                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,\r\n                                errMsg: `HandleServerEvents: full doc is not provided with dataType=\"replace\" (requestId ${msg.requestId})`\r\n                            });\r\n                            this.closeWithError(err);\r\n                            throw err;\r\n                        }\r\n                        break;\r\n                    }\r\n                    case 'remove': {\r\n                        const doc = docs.find(doc => doc._id === change.docId);\r\n                        if (doc) {\r\n                            change.doc = doc;\r\n                        }\r\n                        else {\r\n                            console.error('[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated.');\r\n                        }\r\n                        break;\r\n                    }\r\n                    case 'limit': {\r\n                        if (!change.doc) {\r\n                            switch (change.queueType) {\r\n                                case 'dequeue': {\r\n                                    const doc = docs.find(doc => doc._id === change.docId);\r\n                                    if (doc) {\r\n                                        change.doc = doc;\r\n                                    }\r\n                                    else {\r\n                                        console.error('[realtime listener] internal non-fatal server error: unexpected limit dataType event where no doc is associated.');\r\n                                    }\r\n                                    break;\r\n                                }\r\n                                case 'enqueue': {\r\n                                    const err = new CloudSDKError({\r\n                                        errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,\r\n                                        errMsg: `HandleServerEvents: full doc is not provided with dataType=\"limit\" and queueType=\"enqueue\" (requestId ${msg.requestId})`\r\n                                    });\r\n                                    this.closeWithError(err);\r\n                                    throw err;\r\n                                }\r\n                                default: {\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                switch (change.queueType) {\r\n                    case 'init': {\r\n                        if (!initEncountered) {\r\n                            initEncountered = true;\r\n                            docs = [change.doc];\r\n                        }\r\n                        else {\r\n                            docs.push(change.doc);\r\n                        }\r\n                        break;\r\n                    }\r\n                    case 'enqueue': {\r\n                        docs.push(change.doc);\r\n                        break;\r\n                    }\r\n                    case 'dequeue': {\r\n                        const ind = docs.findIndex(doc => doc._id === change.docId);\r\n                        if (ind > -1) {\r\n                            docs.splice(ind, 1);\r\n                        }\r\n                        else {\r\n                            console.error('[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated.');\r\n                        }\r\n                        break;\r\n                    }\r\n                    case 'update': {\r\n                        const ind = docs.findIndex(doc => doc._id === change.docId);\r\n                        if (ind > -1) {\r\n                            docs[ind] = change.doc;\r\n                        }\r\n                        else {\r\n                            console.error('[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated.');\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                if (i === len - 1 ||\r\n                    (allChangeEvents[i + 1] && allChangeEvents[i + 1].id !== change.id)) {\r\n                    const docsSnapshot = [...docs];\r\n                    const docChanges = allChangeEvents\r\n                        .slice(0, i + 1)\r\n                        .filter(c => c.id === change.id);\r\n                    this.sessionInfo.currentEventId = change.id;\r\n                    this.sessionInfo.currentDocs = docs;\r\n                    const snapshot = new Snapshot({\r\n                        id: change.id,\r\n                        docChanges,\r\n                        docs: docsSnapshot,\r\n                        msgType\r\n                    });\r\n                    this.listener.onChange(snapshot);\r\n                }\r\n            }\r\n            else {\r\n                console.warn(`[realtime listener] event received is out of order, cur ${this.sessionInfo.currentEventId} but got ${change.id}`);\r\n                await this.rebuildWatch();\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    _postHandleServerEventsValidityCheck(msg) {\r\n        if (!this.sessionInfo) {\r\n            console.error('[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur');\r\n            return;\r\n        }\r\n        if (this.sessionInfo.expectEventId &&\r\n            this.sessionInfo.currentEventId >= this.sessionInfo.expectEventId) {\r\n            this.clearWaitExpectedEvent();\r\n        }\r\n        if (this.sessionInfo.currentEventId < msg.msgData.currEvent) {\r\n            console.warn('[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling');\r\n            return;\r\n        }\r\n    }\r\n    clearWaitExpectedEvent() {\r\n        if (this._waitExpectedTimeoutId) {\r\n            clearTimeout(this._waitExpectedTimeoutId);\r\n            this._waitExpectedTimeoutId = undefined;\r\n        }\r\n    }\r\n    onMessage(msg) {\r\n        switch (this.watchStatus) {\r\n            case WATCH_STATUS.PAUSED: {\r\n                if (msg.msgType !== 'ERROR') {\r\n                    return;\r\n                }\r\n                break;\r\n            }\r\n            case WATCH_STATUS.LOGGINGIN:\r\n            case WATCH_STATUS.INITING:\r\n            case WATCH_STATUS.REBUILDING: {\r\n                console.warn(`[realtime listener] internal non-fatal error: unexpected message received while ${this.watchStatus}`);\r\n                return;\r\n            }\r\n            case WATCH_STATUS.CLOSED: {\r\n                console.warn('[realtime listener] internal non-fatal error: unexpected message received when the watch has closed');\r\n                return;\r\n            }\r\n            case WATCH_STATUS.ERRORED: {\r\n                console.warn('[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error');\r\n                return;\r\n            }\r\n        }\r\n        if (!this.sessionInfo) {\r\n            console.warn('[realtime listener] internal non-fatal error: sessionInfo not found while message is received.');\r\n            return;\r\n        }\r\n        this.scheduleSendACK();\r\n        switch (msg.msgType) {\r\n            case 'NEXT_EVENT': {\r\n                console.warn(`nextevent ${msg.msgData.currEvent} ignored`, msg);\r\n                this.handleServerEvents(msg);\r\n                break;\r\n            }\r\n            case 'CHECK_EVENT': {\r\n                if (this.sessionInfo.currentEventId < msg.msgData.currEvent) {\r\n                    this.sessionInfo.expectEventId = msg.msgData.currEvent;\r\n                    this.clearWaitExpectedEvent();\r\n                    this._waitExpectedTimeoutId = setTimeout(() => {\r\n                        this.rebuildWatch();\r\n                    }, this.getWaitExpectedTimeoutLength());\r\n                    console.log(`[realtime] waitExpectedTimeoutLength ${this.getWaitExpectedTimeoutLength()}`);\r\n                }\r\n                break;\r\n            }\r\n            case 'ERROR': {\r\n                this.closeWithError(new CloudSDKError({\r\n                    errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,\r\n                    errMsg: `${msg.msgData.code} - ${msg.msgData.message}`\r\n                }));\r\n                break;\r\n            }\r\n            default: {\r\n                console.warn(`[realtime listener] virtual client receive unexpected msg ${msg.msgType}: `, msg);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    closeWithError(error) {\r\n        this.watchStatus = WATCH_STATUS.ERRORED;\r\n        this.clearACKSchedule();\r\n        this.listener.onError(error);\r\n        this.onWatchClose(this, (this.sessionInfo && this.sessionInfo.queryID) || '');\r\n        console.log(`[realtime] client closed (${this.collectionName} ${this.query}) (watchId ${this.watchId})`);\r\n    }\r\n    pause() {\r\n        this.watchStatus = WATCH_STATUS.PAUSED;\r\n        console.log(`[realtime] client paused (${this.collectionName} ${this.query}) (watchId ${this.watchId})`);\r\n    }\r\n    async resume() {\r\n        this.watchStatus = WATCH_STATUS.RESUMING;\r\n        console.log(`[realtime] client resuming with ${this.sessionInfo ? 'REBUILD_WATCH' : 'INIT_WATCH'} (${this.collectionName} ${this.query}) (${this.watchId})`);\r\n        try {\r\n            await (this.sessionInfo ? this.rebuildWatch() : this.initWatch());\r\n            console.log(`[realtime] client successfully resumed (${this.collectionName} ${this.query}) (${this.watchId})`);\r\n        }\r\n        catch (e) {\r\n            console.error(`[realtime] client resume failed (${this.collectionName} ${this.query}) (${this.watchId})`, e);\r\n        }\r\n    }\r\n}\r\nfunction getPublicEvent(event) {\r\n    const e = {\r\n        id: event.ID,\r\n        dataType: event.DataType,\r\n        queueType: event.QueueType,\r\n        docId: event.DocID,\r\n        doc: event.Doc && event.Doc !== '{}' ? JSON.parse(event.Doc) : undefined\r\n    };\r\n    if (event.DataType === 'update') {\r\n        if (event.UpdatedFields) {\r\n            e.updatedFields = JSON.parse(event.UpdatedFields);\r\n        }\r\n        if (event.removedFields || event.RemovedFields) {\r\n            e.removedFields = JSON.parse(event.removedFields);\r\n        }\r\n    }\r\n    return e;\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 2851, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/realtime/ws-event.js"],"sourcesContent":["import { CloudSDKError } from '../utils/error';\r\nimport { ERR_CODE } from '../config/error.config';\r\nexport const CLOSE_EVENT_CODE_INFO = {\r\n    1000: {\r\n        code: 1000,\r\n        name: 'Normal Closure',\r\n        description: 'Normal closure; the connection successfully completed whatever purpose for which it was created.'\r\n    },\r\n    1001: {\r\n        code: 1001,\r\n        name: 'Going Away',\r\n        description: 'The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.'\r\n    },\r\n    1002: {\r\n        code: 1002,\r\n        name: 'Protocol Error',\r\n        description: 'The endpoint is terminating the connection due to a protocol error.'\r\n    },\r\n    1003: {\r\n        code: 1003,\r\n        name: 'Unsupported Data',\r\n        description: 'The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).'\r\n    },\r\n    1005: {\r\n        code: 1005,\r\n        name: 'No Status Received',\r\n        description: 'Indicates that no status code was provided even though one was expected.'\r\n    },\r\n    1006: {\r\n        code: 1006,\r\n        name: 'Abnormal Closure',\r\n        description: 'Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected.'\r\n    },\r\n    1007: {\r\n        code: 1007,\r\n        name: 'Invalid frame payload data',\r\n        description: 'The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message).'\r\n    },\r\n    1008: {\r\n        code: 1008,\r\n        name: 'Policy Violation',\r\n        description: 'The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable.'\r\n    },\r\n    1009: {\r\n        code: 1009,\r\n        name: 'Message too big',\r\n        description: 'The endpoint is terminating the connection because a data frame was received that is too large.'\r\n    },\r\n    1010: {\r\n        code: 1010,\r\n        name: 'Missing Extension',\r\n        description: \"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't.\"\r\n    },\r\n    1011: {\r\n        code: 1011,\r\n        name: 'Internal Error',\r\n        description: 'The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request.'\r\n    },\r\n    1012: {\r\n        code: 1012,\r\n        name: 'Service Restart',\r\n        description: 'The server is terminating the connection because it is restarting.'\r\n    },\r\n    1013: {\r\n        code: 1013,\r\n        name: 'Try Again Later',\r\n        description: 'The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients.'\r\n    },\r\n    1014: {\r\n        code: 1014,\r\n        name: 'Bad Gateway',\r\n        description: 'The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code.'\r\n    },\r\n    1015: {\r\n        code: 1015,\r\n        name: 'TLS Handshake',\r\n        description: \"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified).\"\r\n    },\r\n    3000: {\r\n        code: 3000,\r\n        name: 'Reconnect WebSocket',\r\n        description: 'The client is terminating the connection because it wants to reconnect'\r\n    },\r\n    3001: {\r\n        code: 3001,\r\n        name: 'No Realtime Listeners',\r\n        description: 'The client is terminating the connection because no more realtime listeners exist'\r\n    },\r\n    3002: {\r\n        code: 3002,\r\n        name: 'Heartbeat Ping Error',\r\n        description: 'The client is terminating the connection due to its failure in sending heartbeat messages'\r\n    },\r\n    3003: {\r\n        code: 3003,\r\n        name: 'Heartbeat Pong Timeout Error',\r\n        description: 'The client is terminating the connection because no heartbeat response is received from the server'\r\n    },\r\n    3050: {\r\n        code: 3050,\r\n        name: 'Server Close',\r\n        description: 'The client is terminating the connection because no heartbeat response is received from the server'\r\n    }\r\n};\r\nexport var CLOSE_EVENT_CODE;\r\n(function (CLOSE_EVENT_CODE) {\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"NormalClosure\"] = 1000] = \"NormalClosure\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"GoingAway\"] = 1001] = \"GoingAway\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"ProtocolError\"] = 1002] = \"ProtocolError\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"UnsupportedData\"] = 1003] = \"UnsupportedData\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"NoStatusReceived\"] = 1005] = \"NoStatusReceived\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"AbnormalClosure\"] = 1006] = \"AbnormalClosure\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"InvalidFramePayloadData\"] = 1007] = \"InvalidFramePayloadData\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"PolicyViolation\"] = 1008] = \"PolicyViolation\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"MessageTooBig\"] = 1009] = \"MessageTooBig\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"MissingExtension\"] = 1010] = \"MissingExtension\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"InternalError\"] = 1011] = \"InternalError\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"ServiceRestart\"] = 1012] = \"ServiceRestart\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"TryAgainLater\"] = 1013] = \"TryAgainLater\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"BadGateway\"] = 1014] = \"BadGateway\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"TLSHandshake\"] = 1015] = \"TLSHandshake\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"ReconnectWebSocket\"] = 3000] = \"ReconnectWebSocket\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"NoRealtimeListeners\"] = 3001] = \"NoRealtimeListeners\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"HeartbeatPingError\"] = 3002] = \"HeartbeatPingError\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"HeartbeatPongTimeoutError\"] = 3003] = \"HeartbeatPongTimeoutError\";\r\n    CLOSE_EVENT_CODE[CLOSE_EVENT_CODE[\"NoAuthentication\"] = 3050] = \"NoAuthentication\";\r\n})(CLOSE_EVENT_CODE || (CLOSE_EVENT_CODE = {}));\r\nexport const getWSCloseError = (code, reason) => {\r\n    const info = CLOSE_EVENT_CODE_INFO[code];\r\n    const errMsg = !info\r\n        ? `code ${code}`\r\n        : `${info.name}, code ${code}, reason ${reason || info.description}`;\r\n    return new CloudSDKError({\r\n        errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,\r\n        errMsg\r\n    });\r\n};\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3000, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/realtime/websocket-client.js"],"sourcesContent":["import { VirtualWebSocketClient } from './virtual-websocket-client';\r\nimport { sleep } from '../utils/utils';\r\nimport { genRequestId } from './message';\r\nimport { CLOSE_EVENT_CODE, CLOSE_EVENT_CODE_INFO, getWSCloseError } from './ws-event';\r\nimport { CloudSDKError, TimeoutError } from '../utils/error';\r\nimport { RealtimeErrorMessageError } from './error';\r\nimport { ERR_CODE } from '../config/error.config';\r\nimport { Db } from '../';\r\nconst WS_READY_STATE = {\r\n    CONNECTING: 0,\r\n    OPEN: 1,\r\n    CLOSING: 2,\r\n    CLOSED: 3\r\n};\r\nconst MAX_RTT_OBSERVED = 3;\r\nconst DEFAULT_EXPECTED_EVENT_WAIT_TIME = 5000;\r\nconst DEFAULT_UNTRUSTED_RTT_THRESHOLD = 10000;\r\nconst DEFAULT_MAX_RECONNECT = 5;\r\nconst DEFAULT_WS_RECONNECT_INTERVAL = 10000;\r\nconst DEFAULT_PING_FAIL_TOLERANCE = 2;\r\nconst DEFAULT_PONG_MISS_TOLERANCE = 2;\r\nconst DEFAULT_LOGIN_TIMEOUT = 5000;\r\nexport class RealtimeWebSocketClient {\r\n    constructor(options) {\r\n        this._virtualWSClient = new Set();\r\n        this._queryIdClientMap = new Map();\r\n        this._watchIdClientMap = new Map();\r\n        this._pingFailed = 0;\r\n        this._pongMissed = 0;\r\n        this._logins = new Map();\r\n        this._wsReadySubsribers = [];\r\n        this._wsResponseWait = new Map();\r\n        this._rttObserved = [];\r\n        this.initWebSocketConnection = async (reconnect, availableRetries = this._maxReconnect) => {\r\n            if (reconnect && this._reconnectState) {\r\n                return;\r\n            }\r\n            if (reconnect) {\r\n                this._reconnectState = true;\r\n            }\r\n            if (this._wsInitPromise) {\r\n                return this._wsInitPromise;\r\n            }\r\n            if (reconnect) {\r\n                this.pauseClients();\r\n            }\r\n            this.close(CLOSE_EVENT_CODE.ReconnectWebSocket);\r\n            this._wsInitPromise = new Promise(async (resolve, reject) => {\r\n                try {\r\n                    const wsSign = await this.getWsSign();\r\n                    await new Promise(success => {\r\n                        const url = wsSign.wsUrl || 'wss://tcb-ws.tencentcloudapi.com';\r\n                        this._ws = Db.wsClass ? new Db.wsClass(url) : new WebSocket(url);\r\n                        success();\r\n                    });\r\n                    if (this._ws.connect) {\r\n                        await this._ws.connect();\r\n                    }\r\n                    await this.initWebSocketEvent();\r\n                    resolve();\r\n                    if (reconnect) {\r\n                        this.resumeClients();\r\n                        this._reconnectState = false;\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    console.error('[realtime] initWebSocketConnection connect fail', e);\r\n                    if (availableRetries > 0) {\r\n                        const isConnected = true;\r\n                        this._wsInitPromise = undefined;\r\n                        if (isConnected) {\r\n                            await sleep(this._reconnectInterval);\r\n                            if (reconnect) {\r\n                                this._reconnectState = false;\r\n                            }\r\n                        }\r\n                        resolve(this.initWebSocketConnection(reconnect, availableRetries - 1));\r\n                    }\r\n                    else {\r\n                        reject(e);\r\n                        if (reconnect) {\r\n                            this.closeAllClients(new CloudSDKError({\r\n                                errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,\r\n                                errMsg: e\r\n                            }));\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            try {\r\n                await this._wsInitPromise;\r\n                this._wsReadySubsribers.forEach(({ resolve }) => resolve());\r\n            }\r\n            catch (e) {\r\n                this._wsReadySubsribers.forEach(({ reject }) => reject());\r\n            }\r\n            finally {\r\n                this._wsInitPromise = undefined;\r\n                this._wsReadySubsribers = [];\r\n            }\r\n        };\r\n        this.initWebSocketEvent = () => new Promise((resolve, reject) => {\r\n            if (!this._ws) {\r\n                throw new Error('can not initWebSocketEvent, ws not exists');\r\n            }\r\n            let wsOpened = false;\r\n            this._ws.onopen = event => {\r\n                console.warn('[realtime] ws event: open', event);\r\n                wsOpened = true;\r\n                resolve();\r\n            };\r\n            this._ws.onerror = event => {\r\n                this._logins = new Map();\r\n                if (!wsOpened) {\r\n                    console.error('[realtime] ws open failed with ws event: error', event);\r\n                    reject(event);\r\n                }\r\n                else {\r\n                    console.error('[realtime] ws event: error', event);\r\n                    this.clearHeartbeat();\r\n                    this._virtualWSClient.forEach(client => client.closeWithError(new CloudSDKError({\r\n                        errCode: ERR_CODE.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,\r\n                        errMsg: event\r\n                    })));\r\n                }\r\n            };\r\n            this._ws.onclose = closeEvent => {\r\n                console.warn('[realtime] ws event: close', closeEvent);\r\n                this._logins = new Map();\r\n                this.clearHeartbeat();\r\n                switch (closeEvent.code) {\r\n                    case CLOSE_EVENT_CODE.ReconnectWebSocket: {\r\n                        break;\r\n                    }\r\n                    case CLOSE_EVENT_CODE.NoRealtimeListeners: {\r\n                        break;\r\n                    }\r\n                    case CLOSE_EVENT_CODE.HeartbeatPingError:\r\n                    case CLOSE_EVENT_CODE.HeartbeatPongTimeoutError:\r\n                    case CLOSE_EVENT_CODE.NormalClosure:\r\n                    case CLOSE_EVENT_CODE.AbnormalClosure: {\r\n                        if (this._maxReconnect > 0) {\r\n                            this.initWebSocketConnection(true, this._maxReconnect);\r\n                        }\r\n                        else {\r\n                            this.closeAllClients(getWSCloseError(closeEvent.code));\r\n                        }\r\n                        break;\r\n                    }\r\n                    case CLOSE_EVENT_CODE.NoAuthentication: {\r\n                        this.closeAllClients(getWSCloseError(closeEvent.code, closeEvent.reason));\r\n                        break;\r\n                    }\r\n                    default: {\r\n                        if (this._maxReconnect > 0) {\r\n                            this.initWebSocketConnection(true, this._maxReconnect);\r\n                        }\r\n                        else {\r\n                            this.closeAllClients(getWSCloseError(closeEvent.code));\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            this._ws.onmessage = res => {\r\n                const rawMsg = res.data;\r\n                this.heartbeat();\r\n                let msg;\r\n                try {\r\n                    msg = JSON.parse(rawMsg);\r\n                }\r\n                catch (e) {\r\n                    throw new Error(`[realtime] onMessage parse res.data error: ${e}`);\r\n                }\r\n                if (msg.msgType === 'ERROR') {\r\n                    let virtualWatch = null;\r\n                    this._virtualWSClient.forEach(item => {\r\n                        if (item.watchId === msg.watchId) {\r\n                            virtualWatch = item;\r\n                        }\r\n                    });\r\n                    if (virtualWatch) {\r\n                        virtualWatch.listener.onError(msg);\r\n                    }\r\n                }\r\n                const responseWaitSpec = this._wsResponseWait.get(msg.requestId);\r\n                if (responseWaitSpec) {\r\n                    try {\r\n                        if (msg.msgType === 'ERROR') {\r\n                            responseWaitSpec.reject(new RealtimeErrorMessageError(msg));\r\n                        }\r\n                        else {\r\n                            responseWaitSpec.resolve(msg);\r\n                        }\r\n                    }\r\n                    catch (e) {\r\n                        console.error('ws onMessage responseWaitSpec.resolve(msg) errored:', e);\r\n                    }\r\n                    finally {\r\n                        this._wsResponseWait.delete(msg.requestId);\r\n                    }\r\n                    if (responseWaitSpec.skipOnMessage) {\r\n                        return;\r\n                    }\r\n                }\r\n                if (msg.msgType === 'PONG') {\r\n                    if (this._lastPingSendTS) {\r\n                        const rtt = Date.now() - this._lastPingSendTS;\r\n                        if (rtt > DEFAULT_UNTRUSTED_RTT_THRESHOLD) {\r\n                            console.warn(`[realtime] untrusted rtt observed: ${rtt}`);\r\n                            return;\r\n                        }\r\n                        if (this._rttObserved.length >= MAX_RTT_OBSERVED) {\r\n                            this._rttObserved.splice(0, this._rttObserved.length - MAX_RTT_OBSERVED + 1);\r\n                        }\r\n                        this._rttObserved.push(rtt);\r\n                    }\r\n                    return;\r\n                }\r\n                let client = msg.watchId && this._watchIdClientMap.get(msg.watchId);\r\n                if (client) {\r\n                    client.onMessage(msg);\r\n                }\r\n                else {\r\n                    console.error(`[realtime] no realtime listener found responsible for watchId ${msg.watchId}: `, msg);\r\n                    switch (msg.msgType) {\r\n                        case 'INIT_EVENT':\r\n                        case 'NEXT_EVENT':\r\n                        case 'CHECK_EVENT': {\r\n                            client = this._queryIdClientMap.get(msg.msgData.queryID);\r\n                            if (client) {\r\n                                client.onMessage(msg);\r\n                            }\r\n                            break;\r\n                        }\r\n                        default: {\r\n                            for (const [, client] of this._watchIdClientMap) {\r\n                                client.onMessage(msg);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            this.heartbeat();\r\n        });\r\n        this.isWSConnected = () => {\r\n            return Boolean(this._ws && this._ws.readyState === WS_READY_STATE.OPEN);\r\n        };\r\n        this.onceWSConnected = async () => {\r\n            if (this.isWSConnected()) {\r\n                return;\r\n            }\r\n            if (this._wsInitPromise) {\r\n                return this._wsInitPromise;\r\n            }\r\n            return new Promise((resolve, reject) => {\r\n                this._wsReadySubsribers.push({\r\n                    resolve,\r\n                    reject\r\n                });\r\n            });\r\n        };\r\n        this.webLogin = async (envId, refresh) => {\r\n            if (!refresh) {\r\n                if (envId) {\r\n                    const loginInfo = this._logins.get(envId);\r\n                    if (loginInfo) {\r\n                        if (loginInfo.loggedIn && loginInfo.loginResult) {\r\n                            return loginInfo.loginResult;\r\n                        }\r\n                        else if (loginInfo.loggingInPromise) {\r\n                            return loginInfo.loggingInPromise;\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    const emptyEnvLoginInfo = this._logins.get('');\r\n                    if (emptyEnvLoginInfo && emptyEnvLoginInfo.loggingInPromise) {\r\n                        return emptyEnvLoginInfo.loggingInPromise;\r\n                    }\r\n                }\r\n            }\r\n            const promise = new Promise(async (resolve, reject) => {\r\n                try {\r\n                    const wsSign = await this.getWsSign();\r\n                    const msgData = {\r\n                        envId: wsSign.envId || '',\r\n                        accessToken: '',\r\n                        referrer: 'web',\r\n                        sdkVersion: '',\r\n                        dataVersion: Db.dataVersion || ''\r\n                    };\r\n                    const loginMsg = {\r\n                        watchId: undefined,\r\n                        requestId: genRequestId(),\r\n                        msgType: 'LOGIN',\r\n                        msgData,\r\n                        exMsgData: {\r\n                            runtime: Db.runtime,\r\n                            signStr: wsSign.signStr,\r\n                            secretVersion: wsSign.secretVersion\r\n                        }\r\n                    };\r\n                    const loginResMsg = await this.send({\r\n                        msg: loginMsg,\r\n                        waitResponse: true,\r\n                        skipOnMessage: true,\r\n                        timeout: DEFAULT_LOGIN_TIMEOUT\r\n                    });\r\n                    if (!loginResMsg.msgData.code) {\r\n                        resolve({\r\n                            envId: wsSign.envId\r\n                        });\r\n                    }\r\n                    else {\r\n                        reject(new Error(`${loginResMsg.msgData.code} ${loginResMsg.msgData.message}`));\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            });\r\n            let loginInfo = envId && this._logins.get(envId);\r\n            const loginStartTS = Date.now();\r\n            if (loginInfo) {\r\n                loginInfo.loggedIn = false;\r\n                loginInfo.loggingInPromise = promise;\r\n                loginInfo.loginStartTS = loginStartTS;\r\n            }\r\n            else {\r\n                loginInfo = {\r\n                    loggedIn: false,\r\n                    loggingInPromise: promise,\r\n                    loginStartTS\r\n                };\r\n                this._logins.set(envId || '', loginInfo);\r\n            }\r\n            try {\r\n                const loginResult = await promise;\r\n                const curLoginInfo = envId && this._logins.get(envId);\r\n                if (curLoginInfo &&\r\n                    curLoginInfo === loginInfo &&\r\n                    curLoginInfo.loginStartTS === loginStartTS) {\r\n                    loginInfo.loggedIn = true;\r\n                    loginInfo.loggingInPromise = undefined;\r\n                    loginInfo.loginStartTS = undefined;\r\n                    loginInfo.loginResult = loginResult;\r\n                    return loginResult;\r\n                }\r\n                else if (curLoginInfo) {\r\n                    if (curLoginInfo.loggedIn && curLoginInfo.loginResult) {\r\n                        return curLoginInfo.loginResult;\r\n                    }\r\n                    else if (curLoginInfo.loggingInPromise) {\r\n                        return curLoginInfo.loggingInPromise;\r\n                    }\r\n                    else {\r\n                        throw new Error('ws unexpected login info');\r\n                    }\r\n                }\r\n                else {\r\n                    throw new Error('ws login info reset');\r\n                }\r\n            }\r\n            catch (e) {\r\n                loginInfo.loggedIn = false;\r\n                loginInfo.loggingInPromise = undefined;\r\n                loginInfo.loginStartTS = undefined;\r\n                loginInfo.loginResult = undefined;\r\n                throw e;\r\n            }\r\n        };\r\n        this.getWsSign = async () => {\r\n            if (this._wsSign && this._wsSign.expiredTs > Date.now()) {\r\n                return this._wsSign;\r\n            }\r\n            const expiredTs = Date.now() + 60000;\r\n            const res = await this._context.appConfig.request.send('auth.wsWebSign', { runtime: Db.runtime });\r\n            if (res.code) {\r\n                throw new Error(`[tcb-js-sdk] : ${res.code}`);\r\n            }\r\n            if (res.data) {\r\n                const { signStr, wsUrl, secretVersion, envId } = res.data;\r\n                return {\r\n                    signStr,\r\n                    wsUrl,\r\n                    secretVersion,\r\n                    envId,\r\n                    expiredTs\r\n                };\r\n            }\r\n            else {\r\n                throw new Error('[tcb-js-sdk] ');\r\n            }\r\n        };\r\n        this.getWaitExpectedTimeoutLength = () => {\r\n            if (!this._rttObserved.length) {\r\n                return DEFAULT_EXPECTED_EVENT_WAIT_TIME;\r\n            }\r\n            return ((this._rttObserved.reduce((acc, cur) => acc + cur) /\r\n                this._rttObserved.length) *\r\n                1.5);\r\n        };\r\n        this.ping = async () => {\r\n            const msg = {\r\n                watchId: undefined,\r\n                requestId: genRequestId(),\r\n                msgType: 'PING',\r\n                msgData: null\r\n            };\r\n            await this.send({\r\n                msg\r\n            });\r\n        };\r\n        this.send = async (opts) => new Promise(async (_resolve, _reject) => {\r\n            let timeoutId;\r\n            let _hasResolved = false;\r\n            let _hasRejected = false;\r\n            const resolve = (value) => {\r\n                _hasResolved = true;\r\n                timeoutId && clearTimeout(timeoutId);\r\n                _resolve(value);\r\n            };\r\n            const reject = (error) => {\r\n                _hasRejected = true;\r\n                timeoutId && clearTimeout(timeoutId);\r\n                _reject(error);\r\n            };\r\n            if (opts.timeout) {\r\n                timeoutId = setTimeout(async () => {\r\n                    if (!_hasResolved || !_hasRejected) {\r\n                        await sleep(0);\r\n                        if (!_hasResolved || !_hasRejected) {\r\n                            reject(new TimeoutError('wsclient.send timedout'));\r\n                        }\r\n                    }\r\n                }, opts.timeout);\r\n            }\r\n            try {\r\n                if (this._wsInitPromise) {\r\n                    await this._wsInitPromise;\r\n                }\r\n                if (!this._ws) {\r\n                    reject(new Error('invalid state: ws connection not exists, can not send message'));\r\n                    return;\r\n                }\r\n                if (this._ws.readyState !== WS_READY_STATE.OPEN) {\r\n                    reject(new Error(`ws readyState invalid: ${this._ws.readyState}, can not send message`));\r\n                    return;\r\n                }\r\n                if (opts.waitResponse) {\r\n                    this._wsResponseWait.set(opts.msg.requestId, {\r\n                        resolve,\r\n                        reject,\r\n                        skipOnMessage: opts.skipOnMessage\r\n                    });\r\n                }\r\n                try {\r\n                    await this._ws.send(JSON.stringify(opts.msg));\r\n                    if (!opts.waitResponse) {\r\n                        resolve();\r\n                    }\r\n                }\r\n                catch (err) {\r\n                    if (err) {\r\n                        reject(err);\r\n                        if (opts.waitResponse) {\r\n                            this._wsResponseWait.delete(opts.msg.requestId);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            catch (e) {\r\n                reject(e);\r\n            }\r\n        });\r\n        this.closeAllClients = (error) => {\r\n            this._virtualWSClient.forEach(client => {\r\n                client.closeWithError(error);\r\n            });\r\n        };\r\n        this.pauseClients = (clients) => {\r\n            ;\r\n            (clients || this._virtualWSClient).forEach(client => {\r\n                client.pause();\r\n            });\r\n        };\r\n        this.resumeClients = (clients) => {\r\n            ;\r\n            (clients || this._virtualWSClient).forEach(client => {\r\n                client.resume();\r\n            });\r\n        };\r\n        this.onWatchStart = (client, queryID) => {\r\n            this._queryIdClientMap.set(queryID, client);\r\n        };\r\n        this.onWatchClose = (client, queryID) => {\r\n            if (queryID) {\r\n                this._queryIdClientMap.delete(queryID);\r\n            }\r\n            this._watchIdClientMap.delete(client.watchId);\r\n            this._virtualWSClient.delete(client);\r\n            if (!this._virtualWSClient.size) {\r\n                this.close(CLOSE_EVENT_CODE.NoRealtimeListeners);\r\n            }\r\n        };\r\n        this._maxReconnect = options.maxReconnect || DEFAULT_MAX_RECONNECT;\r\n        this._reconnectInterval =\r\n            options.reconnectInterval || DEFAULT_WS_RECONNECT_INTERVAL;\r\n        this._context = options.context;\r\n    }\r\n    heartbeat(immediate) {\r\n        this.clearHeartbeat();\r\n        this._pingTimeoutId = setTimeout(async () => {\r\n            try {\r\n                if (!this._ws || this._ws.readyState !== WS_READY_STATE.OPEN) {\r\n                    return;\r\n                }\r\n                this._lastPingSendTS = Date.now();\r\n                await this.ping();\r\n                this._pingFailed = 0;\r\n                this._pongTimeoutId = setTimeout(() => {\r\n                    console.error('pong timed out');\r\n                    if (this._pongMissed < DEFAULT_PONG_MISS_TOLERANCE) {\r\n                        this._pongMissed++;\r\n                        this.heartbeat(true);\r\n                    }\r\n                    else {\r\n                        this.initWebSocketConnection(true);\r\n                    }\r\n                }, this._context.appConfig.realtimePongWaitTimeout);\r\n            }\r\n            catch (e) {\r\n                if (this._pingFailed < DEFAULT_PING_FAIL_TOLERANCE) {\r\n                    this._pingFailed++;\r\n                    this.heartbeat();\r\n                }\r\n                else {\r\n                    this.close(CLOSE_EVENT_CODE.HeartbeatPingError);\r\n                }\r\n            }\r\n        }, immediate ? 0 : this._context.appConfig.realtimePingInterval);\r\n    }\r\n    clearHeartbeat() {\r\n        this._pingTimeoutId && clearTimeout(this._pingTimeoutId);\r\n        this._pongTimeoutId && clearTimeout(this._pongTimeoutId);\r\n    }\r\n    close(code) {\r\n        this.clearHeartbeat();\r\n        if (this._ws) {\r\n            this._ws.close(code, CLOSE_EVENT_CODE_INFO[code].name);\r\n            this._ws = undefined;\r\n        }\r\n    }\r\n    watch(options) {\r\n        if (!this._ws && !this._wsInitPromise) {\r\n            this.initWebSocketConnection(false);\r\n        }\r\n        const virtualClient = new VirtualWebSocketClient(Object.assign(Object.assign({}, options), { send: this.send, login: this.webLogin, isWSConnected: this.isWSConnected, onceWSConnected: this.onceWSConnected, getWaitExpectedTimeoutLength: this.getWaitExpectedTimeoutLength, onWatchStart: this.onWatchStart, onWatchClose: this.onWatchClose, debug: true }));\r\n        this._virtualWSClient.add(virtualClient);\r\n        this._watchIdClientMap.set(virtualClient.watchId, virtualClient);\r\n        return virtualClient.listener;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3565, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/document.js"],"sourcesContent":["import { Db } from './index';\r\nimport { Util } from './util';\r\nimport { UpdateSerializer } from './serializer/update';\r\nimport { serialize } from './serializer/datatype';\r\nimport { UpdateCommand } from './commands/update';\r\nimport { RealtimeWebSocketClient } from './realtime/websocket-client';\r\nimport { QueryType } from './constant';\r\nimport { getReqOpts, stringifyByEJSON, processReturn } from './utils/utils';\r\nimport { ERRORS } from './const/code';\r\nimport { EJSON } from 'bson';\r\nexport class DocumentReference {\r\n    constructor(db, coll, apiOptions, docID, transactionId) {\r\n        this.watch = (options) => {\r\n            if (!Db.ws) {\r\n                Db.ws = new RealtimeWebSocketClient({\r\n                    context: {\r\n                        appConfig: {\r\n                            docSizeLimit: 1000,\r\n                            realtimePingInterval: 10000,\r\n                            realtimePongWaitTimeout: 5000,\r\n                            request: this.request\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            return Db.ws.watch(Object.assign(Object.assign({}, options), { envId: this._db.config.env, collectionName: this._coll, query: JSON.stringify({\r\n                    _id: this.id\r\n                }) }));\r\n        };\r\n        this._db = db;\r\n        this._coll = coll;\r\n        this.id = docID;\r\n        this._transactionId = transactionId;\r\n        this.request = new Db.reqClass(this._db.config);\r\n        this._apiOptions = apiOptions;\r\n    }\r\n    async create(data) {\r\n        if (this.id) {\r\n            data['_id'] = this.id;\r\n        }\r\n        let params = {\r\n            collectionName: this._coll,\r\n            data: [stringifyByEJSON(serialize(data))],\r\n            transactionId: this._transactionId\r\n        };\r\n        const res = await this.request.send('database.insertDocument', params, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        if (this._transactionId) {\r\n            return {\r\n                inserted: 1,\r\n                ok: 1,\r\n                id: res.data.insertedIds[0],\r\n                requestId: res.requestId\r\n            };\r\n        }\r\n        return {\r\n            id: res.data.insertedIds[0],\r\n            requestId: res.requestId\r\n        };\r\n    }\r\n    async set(data) {\r\n        if (!this.id) {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: 'docId' }));\r\n        }\r\n        if (!data || typeof data !== 'object') {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: '' }));\r\n        }\r\n        if (data.hasOwnProperty('_id')) {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: '_id' }));\r\n        }\r\n        let hasOperator = false;\r\n        const checkMixed = objs => {\r\n            if (typeof objs === 'object') {\r\n                for (let key in objs) {\r\n                    if (objs[key] instanceof UpdateCommand) {\r\n                        hasOperator = true;\r\n                    }\r\n                    else if (typeof objs[key] === 'object') {\r\n                        checkMixed(objs[key]);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        checkMixed(data);\r\n        if (hasOperator) {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.DATABASE_REQUEST_FAILED), { message: 'update operator complicit' }));\r\n        }\r\n        let param = {\r\n            collectionName: this._coll,\r\n            queryType: QueryType.DOC,\r\n            data: stringifyByEJSON(serialize(data)),\r\n            transactionId: this._transactionId,\r\n            multi: false,\r\n            merge: false,\r\n            upsert: true\r\n        };\r\n        if (this.id) {\r\n            param['query'] = stringifyByEJSON({ _id: this.id });\r\n        }\r\n        const res = await this.request.send('database.modifyDocument', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        if (this._transactionId) {\r\n            return {\r\n                updated: res.data.updated,\r\n                upserted: [{ _id: res.data.upsert_id }],\r\n                requestId: res.requestId\r\n            };\r\n        }\r\n        return {\r\n            updated: res.data.updated,\r\n            upsertedId: res.data.upsert_id,\r\n            requestId: res.requestId\r\n        };\r\n    }\r\n    async update(data) {\r\n        if (!data || typeof data !== 'object') {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: '' }));\r\n        }\r\n        if (data.hasOwnProperty('_id')) {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: '_id' }));\r\n        }\r\n        const query = stringifyByEJSON({ _id: this.id });\r\n        const param = {\r\n            collectionName: this._coll,\r\n            transactionId: this._transactionId,\r\n            data: UpdateSerializer.encodeEJSON(data, this._apiOptions.raw || false),\r\n            query,\r\n            queryType: QueryType.DOC,\r\n            multi: false,\r\n            merge: true,\r\n            upsert: false\r\n        };\r\n        const res = await this.request.send('database.modifyDocument', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        return {\r\n            updated: res.data.updated,\r\n            requestId: res.requestId\r\n        };\r\n    }\r\n    async delete() {\r\n        return this.remove();\r\n    }\r\n    async remove() {\r\n        const query = stringifyByEJSON({ _id: this.id });\r\n        const param = {\r\n            collectionName: this._coll,\r\n            transactionId: this._transactionId,\r\n            query: query,\r\n            queryType: QueryType.DOC,\r\n            multi: false\r\n        };\r\n        const res = await this.request.send('database.removeDocument', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        return {\r\n            deleted: res.data.deleted,\r\n            requestId: res.requestId\r\n        };\r\n    }\r\n    async get() {\r\n        const query = stringifyByEJSON({ _id: this.id });\r\n        const { projection } = this._apiOptions;\r\n        const param = {\r\n            collectionName: this._coll,\r\n            query,\r\n            transactionId: this._transactionId,\r\n            queryType: QueryType.DOC,\r\n            multi: false\r\n        };\r\n        if (projection) {\r\n            param.projection = stringifyByEJSON(projection);\r\n        }\r\n        const res = await this.request.send('database.getDocument', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        const list = res.data.list.map(item => EJSON.parse(item));\r\n        const documents = Util.formatResDocumentData(list);\r\n        if (this._transactionId) {\r\n            return {\r\n                data: documents[0] || null,\r\n                requestId: res.requestId\r\n            };\r\n        }\r\n        return {\r\n            data: documents,\r\n            requestId: res.requestId,\r\n            offset: res.data.offset,\r\n            limit: res.data.limit\r\n        };\r\n    }\r\n    field(projection) {\r\n        let transformProjection = {};\r\n        for (let k in projection) {\r\n            if (typeof projection[k] === 'boolean') {\r\n                transformProjection[k] = projection[k] === true ? 1 : 0;\r\n            }\r\n            if (typeof projection[k] === 'number') {\r\n                transformProjection[k] = projection[k] > 0 ? 1 : 0;\r\n            }\r\n            if (typeof projection[k] === 'object') {\r\n                transformProjection[k] = projection[k];\r\n            }\r\n        }\r\n        let newApiOption = Object.assign({}, this._apiOptions);\r\n        newApiOption.projection = transformProjection;\r\n        return new DocumentReference(this._db, this._coll, newApiOption, this.id, this._transactionId);\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 3828, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/serializer/query.js"],"sourcesContent":["import { isQueryCommand, isComparisonCommand, QUERY_COMMANDS_LITERAL } from '../commands/query';\r\nimport { isLogicCommand, LOGIC_COMMANDS_LITERAL } from '../commands/logic';\r\nimport { SYMBOL_UNSET_FIELD_NAME, SYMBOL_GEO_POINT } from '../helper/symbol';\r\nimport { getType, isObject, isArray, isRegExp, isDate } from '../utils/type';\r\nimport { operatorToString } from '../operator-map';\r\nimport { flattenQueryObject, isConversionRequired, encodeInternalDataType } from './common';\r\nimport { stringifyByEJSON } from '../utils/utils';\r\nimport { Validate } from '../validate';\r\nexport class QuerySerializer {\r\n    constructor() { }\r\n    static encode(query) {\r\n        const encoder = new QueryEncoder();\r\n        return encoder.encodeQuery(query);\r\n    }\r\n    static encodeEJSON(query, raw) {\r\n        const encoder = new QueryEncoder();\r\n        return stringifyByEJSON(raw ? query : encoder.encodeQuery(query));\r\n    }\r\n}\r\nclass QueryEncoder {\r\n    encodeQuery(query, key) {\r\n        if (isConversionRequired(query)) {\r\n            if (isLogicCommand(query)) {\r\n                return this.encodeLogicCommand(query);\r\n            }\r\n            else if (isQueryCommand(query)) {\r\n                return this.encodeQueryCommand(query);\r\n            }\r\n            else if (isRegExp(query)) {\r\n                return { [key]: this.encodeRegExp(query) };\r\n            }\r\n            else if (isDate(query)) {\r\n                return { [key]: query };\r\n            }\r\n            else {\r\n                return { [key]: this.encodeQueryObject(query) };\r\n            }\r\n        }\r\n        else {\r\n            if (isObject(query)) {\r\n                return this.encodeQueryObject(query);\r\n            }\r\n            else {\r\n                return query;\r\n            }\r\n        }\r\n    }\r\n    encodeRegExp(query) {\r\n        return {\r\n            $regularExpression: {\r\n                pattern: query.source,\r\n                options: query.flags\r\n            }\r\n        };\r\n    }\r\n    encodeLogicCommand(query) {\r\n        switch (query.operator) {\r\n            case LOGIC_COMMANDS_LITERAL.NOR:\r\n            case LOGIC_COMMANDS_LITERAL.AND:\r\n            case LOGIC_COMMANDS_LITERAL.OR: {\r\n                const $op = operatorToString(query.operator);\r\n                const subqueries = query.operands.map((oprand) => this.encodeQuery(oprand, query.fieldName));\r\n                return {\r\n                    [$op]: subqueries\r\n                };\r\n            }\r\n            case LOGIC_COMMANDS_LITERAL.NOT: {\r\n                const $op = operatorToString(query.operator);\r\n                const operatorExpression = query.operands[0];\r\n                if (isRegExp(operatorExpression)) {\r\n                    return {\r\n                        [query.fieldName]: {\r\n                            [$op]: this.encodeRegExp(operatorExpression)\r\n                        }\r\n                    };\r\n                }\r\n                else {\r\n                    const subqueries = this.encodeQuery(operatorExpression)[query.fieldName];\r\n                    return {\r\n                        [query.fieldName]: {\r\n                            [$op]: subqueries\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n            default: {\r\n                const $op = operatorToString(query.operator);\r\n                if (query.operands.length === 1) {\r\n                    const subquery = this.encodeQuery(query.operands[0]);\r\n                    return {\r\n                        [$op]: subquery\r\n                    };\r\n                }\r\n                else {\r\n                    const subqueries = query.operands.map(this.encodeQuery.bind(this));\r\n                    return {\r\n                        [$op]: subqueries\r\n                    };\r\n                }\r\n            }\r\n        }\r\n    }\r\n    encodeQueryCommand(query) {\r\n        if (isComparisonCommand(query)) {\r\n            return this.encodeComparisonCommand(query);\r\n        }\r\n        else {\r\n            return this.encodeComparisonCommand(query);\r\n        }\r\n    }\r\n    encodeComparisonCommand(query) {\r\n        if (query.fieldName === SYMBOL_UNSET_FIELD_NAME) {\r\n            throw new Error('Cannot encode a comparison command with unset field name');\r\n        }\r\n        const $op = operatorToString(query.operator);\r\n        switch (query.operator) {\r\n            case QUERY_COMMANDS_LITERAL.EQ:\r\n            case QUERY_COMMANDS_LITERAL.NEQ:\r\n            case QUERY_COMMANDS_LITERAL.LT:\r\n            case QUERY_COMMANDS_LITERAL.LTE:\r\n            case QUERY_COMMANDS_LITERAL.GT:\r\n            case QUERY_COMMANDS_LITERAL.GTE:\r\n            case QUERY_COMMANDS_LITERAL.ELEM_MATCH:\r\n            case QUERY_COMMANDS_LITERAL.EXISTS:\r\n            case QUERY_COMMANDS_LITERAL.SIZE:\r\n            case QUERY_COMMANDS_LITERAL.MOD: {\r\n                return {\r\n                    [query.fieldName]: {\r\n                        [$op]: encodeInternalDataType(query.operands[0])\r\n                    }\r\n                };\r\n            }\r\n            case QUERY_COMMANDS_LITERAL.IN:\r\n            case QUERY_COMMANDS_LITERAL.NIN:\r\n            case QUERY_COMMANDS_LITERAL.ALL: {\r\n                return {\r\n                    [query.fieldName]: {\r\n                        [$op]: encodeInternalDataType(query.operands)\r\n                    }\r\n                };\r\n            }\r\n            case QUERY_COMMANDS_LITERAL.GEO_NEAR: {\r\n                const options = query.operands[0];\r\n                return {\r\n                    [query.fieldName]: {\r\n                        $nearSphere: {\r\n                            $geometry: options.geometry.toJSON(),\r\n                            $maxDistance: options.maxDistance,\r\n                            $minDistance: options.minDistance\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n            case QUERY_COMMANDS_LITERAL.GEO_WITHIN: {\r\n                const options = query.operands[0];\r\n                if (options.centerSphere) {\r\n                    Validate.isCentersPhere(options.centerSphere);\r\n                    const centerSphere = options.centerSphere;\r\n                    if (centerSphere[0]._internalType === SYMBOL_GEO_POINT) {\r\n                        return {\r\n                            [query.fieldName]: {\r\n                                $geoWithin: {\r\n                                    $centerSphere: [centerSphere[0].toJSON().coordinates, centerSphere[1]]\r\n                                }\r\n                            }\r\n                        };\r\n                    }\r\n                    return {\r\n                        [query.fieldName]: {\r\n                            $geoWithin: {\r\n                                $centerSphere: options.centerSphere\r\n                            }\r\n                        }\r\n                    };\r\n                }\r\n                return {\r\n                    [query.fieldName]: {\r\n                        $geoWithin: {\r\n                            $geometry: options.geometry.toJSON()\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n            case QUERY_COMMANDS_LITERAL.GEO_INTERSECTS: {\r\n                const options = query.operands[0];\r\n                return {\r\n                    [query.fieldName]: {\r\n                        $geoIntersects: {\r\n                            $geometry: options.geometry.toJSON()\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n            default: {\r\n                return {\r\n                    [query.fieldName]: {\r\n                        [$op]: encodeInternalDataType(query.operands[0])\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    }\r\n    encodeQueryObject(query) {\r\n        const flattened = flattenQueryObject(query);\r\n        for (const key in flattened) {\r\n            const val = flattened[key];\r\n            if (isLogicCommand(val)) {\r\n                flattened[key] = val._setFieldName(key);\r\n                const condition = this.encodeLogicCommand(flattened[key]);\r\n                this.mergeConditionAfterEncode(flattened, condition, key);\r\n            }\r\n            else if (isComparisonCommand(val)) {\r\n                flattened[key] = val._setFieldName(key);\r\n                const condition = this.encodeComparisonCommand(flattened[key]);\r\n                this.mergeConditionAfterEncode(flattened, condition, key);\r\n            }\r\n            else if (isConversionRequired(val)) {\r\n                flattened[key] = encodeInternalDataType(val);\r\n            }\r\n        }\r\n        return flattened;\r\n    }\r\n    mergeConditionAfterEncode(query, condition, key) {\r\n        if (!condition[key]) {\r\n            delete query[key];\r\n        }\r\n        for (const conditionKey in condition) {\r\n            if (query[conditionKey]) {\r\n                if (isArray(query[conditionKey])) {\r\n                    query[conditionKey] = query[conditionKey].concat(condition[conditionKey]);\r\n                }\r\n                else if (isObject(query[conditionKey])) {\r\n                    if (isObject(condition[conditionKey])) {\r\n                        Object.assign(query, condition);\r\n                    }\r\n                    else {\r\n                        console.warn(`unmergable condition, query is object but condition is ${getType(condition)}, can only overwrite`, condition, key);\r\n                        query[conditionKey] = condition[conditionKey];\r\n                    }\r\n                }\r\n                else {\r\n                    console.warn(`to-merge query is of type ${getType(query)}, can only overwrite`, query, condition, key);\r\n                    query[conditionKey] = condition[conditionKey];\r\n                }\r\n            }\r\n            else {\r\n                query[conditionKey] = condition[conditionKey];\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4098, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/query.js"],"sourcesContent":["import { QueryType } from './constant';\r\nimport { Db } from './index';\r\nimport { Validate } from './validate';\r\nimport { Util } from './util';\r\nimport { QuerySerializer } from './serializer/query';\r\nimport { UpdateSerializer } from './serializer/update';\r\nimport { RealtimeWebSocketClient } from './realtime/websocket-client';\r\nimport { ErrorCode } from './constant';\r\nimport { getReqOpts, stringifyByEJSON, processReturn } from './utils/utils';\r\nimport { ERRORS } from './const/code';\r\nimport { EJSON } from 'bson';\r\nexport class Query {\r\n    constructor(db, coll, fieldFilters, apiOptions, transactionId) {\r\n        this.watch = (options) => {\r\n            if (!Db.ws) {\r\n                Db.ws = new RealtimeWebSocketClient({\r\n                    context: {\r\n                        appConfig: {\r\n                            docSizeLimit: 1000,\r\n                            realtimePingInterval: 10000,\r\n                            realtimePongWaitTimeout: 5000,\r\n                            request: this._request\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            const { limit, order } = this._apiOptions;\r\n            return Db.ws.watch(Object.assign(Object.assign({}, options), { envId: this._db.config.env, collectionName: this._coll, query: JSON.stringify(this._fieldFilters), limit, orderBy: order\r\n                    ? order.reduce((acc, cur) => {\r\n                        acc[cur.field] = cur.direction;\r\n                        return acc;\r\n                    }, {})\r\n                    : undefined }));\r\n        };\r\n        this._db = db;\r\n        this._coll = coll;\r\n        this._fieldFilters = fieldFilters;\r\n        this._apiOptions = apiOptions || {};\r\n        this._request = new Db.reqClass(this._db.config);\r\n        this._transactionId = transactionId;\r\n    }\r\n    async get() {\r\n        const order = this._apiOptions.order;\r\n        let param = {\r\n            collectionName: this._coll,\r\n            queryType: QueryType.WHERE,\r\n            transactionId: this._transactionId\r\n        };\r\n        if (this._fieldFilters) {\r\n            param.query = this._fieldFilters;\r\n        }\r\n        if (order) {\r\n            param.order = stringifyByEJSON(order);\r\n        }\r\n        const offset = this._apiOptions.offset;\r\n        if (offset) {\r\n            param.offset = offset;\r\n        }\r\n        const limit = this._apiOptions.limit;\r\n        if (limit) {\r\n            param.limit = limit < 1000 ? limit : 1000;\r\n        }\r\n        else {\r\n            param.limit = 100;\r\n        }\r\n        const projection = this._apiOptions.projection;\r\n        if (projection) {\r\n            param.projection = stringifyByEJSON(projection);\r\n        }\r\n        const res = await this._request.send('database.getDocument', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        const list = res.data.list.map(item => EJSON.parse(item));\r\n        const documents = Util.formatResDocumentData(list);\r\n        const result = {\r\n            data: documents,\r\n            requestId: res.requestId\r\n        };\r\n        if (res.limit)\r\n            result.limit = res.limit;\r\n        if (res.offset)\r\n            result.offset = res.offset;\r\n        return result;\r\n    }\r\n    async count() {\r\n        let param = {\r\n            collectionName: this._coll,\r\n            queryType: QueryType.WHERE\r\n        };\r\n        if (this._fieldFilters) {\r\n            param.query = this._fieldFilters;\r\n        }\r\n        const res = await this._request.send('database.calculateDocument', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        return {\r\n            requestId: res.requestId,\r\n            total: res.data.total\r\n        };\r\n    }\r\n    where(query) {\r\n        if (Object.prototype.toString.call(query).slice(8, -1) !== 'Object') {\r\n            throw Error(ErrorCode.QueryParamTypeError);\r\n        }\r\n        const keys = Object.keys(query);\r\n        const checkFlag = keys.some(item => {\r\n            return query[item] !== undefined;\r\n        });\r\n        if (keys.length && !checkFlag) {\r\n            throw Error(ErrorCode.QueryParamValueError);\r\n        }\r\n        return new Query(this._db, this._coll, QuerySerializer.encodeEJSON(query, this._apiOptions.raw || false), this._apiOptions, this._transactionId);\r\n    }\r\n    options(apiOptions) {\r\n        Validate.isValidOptions(apiOptions);\r\n        return new Query(this._db, this._coll, this._fieldFilters, apiOptions, this._transactionId);\r\n    }\r\n    orderBy(fieldPath, directionStr) {\r\n        Validate.isFieldPath(fieldPath);\r\n        Validate.isFieldOrder(directionStr);\r\n        const newOrder = {\r\n            [fieldPath]: directionStr === 'desc' ? -1 : 1\r\n        };\r\n        const order = this._apiOptions.order || {};\r\n        const newApiOption = Object.assign({}, this._apiOptions, {\r\n            order: Object.assign({}, order, newOrder)\r\n        });\r\n        return new Query(this._db, this._coll, this._fieldFilters, newApiOption, this._transactionId);\r\n    }\r\n    limit(limit) {\r\n        Validate.isInteger('limit', limit);\r\n        let newApiOption = Object.assign({}, this._apiOptions);\r\n        newApiOption.limit = limit;\r\n        return new Query(this._db, this._coll, this._fieldFilters, newApiOption, this._transactionId);\r\n    }\r\n    skip(offset) {\r\n        Validate.isInteger('offset', offset);\r\n        let newApiOption = Object.assign({}, this._apiOptions);\r\n        newApiOption.offset = offset;\r\n        return new Query(this._db, this._coll, this._fieldFilters, newApiOption, this._transactionId);\r\n    }\r\n    async update(data) {\r\n        if (!data || typeof data !== 'object') {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: '' }));\r\n        }\r\n        if (data.hasOwnProperty('_id')) {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: '_id' }));\r\n        }\r\n        let { multiple } = this._apiOptions;\r\n        const multi = multiple === undefined ? true : multiple;\r\n        let param = {\r\n            collectionName: this._coll,\r\n            queryType: QueryType.WHERE,\r\n            multi,\r\n            merge: true,\r\n            upsert: false,\r\n            data: UpdateSerializer.encodeEJSON(data, this._apiOptions.raw || false)\r\n        };\r\n        if (this._fieldFilters) {\r\n            param.query = this._fieldFilters;\r\n        }\r\n        const res = await this._request.send('database.modifyDocument', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        return {\r\n            requestId: res.requestId,\r\n            updated: res.data.updated,\r\n            upsertId: res.data.upsert_id\r\n        };\r\n    }\r\n    field(projection) {\r\n        let transformProjection = {};\r\n        for (let k in projection) {\r\n            if (typeof projection[k] === 'boolean') {\r\n                transformProjection[k] = projection[k] === true ? 1 : 0;\r\n            }\r\n            if (typeof projection[k] === 'number') {\r\n                transformProjection[k] = projection[k] > 0 ? 1 : 0;\r\n            }\r\n            if (typeof projection[k] === 'object') {\r\n                transformProjection[k] = projection[k];\r\n            }\r\n        }\r\n        let newApiOption = Object.assign({}, this._apiOptions);\r\n        newApiOption.projection = transformProjection;\r\n        return new Query(this._db, this._coll, this._fieldFilters, newApiOption, this._transactionId);\r\n    }\r\n    async remove() {\r\n        const { offset, limit, projection, order } = this._apiOptions;\r\n        if (offset !== undefined ||\r\n            limit !== undefined ||\r\n            projection !== undefined ||\r\n            order !== undefined) {\r\n            console.warn('`offset`, `limit`, `projection`, `orderBy` are not supported in remove() operation');\r\n        }\r\n        let { multiple } = this._apiOptions;\r\n        const multi = multiple === undefined ? true : multiple;\r\n        const param = {\r\n            collectionName: this._coll,\r\n            query: this._fieldFilters,\r\n            queryType: QueryType.WHERE,\r\n            multi\r\n        };\r\n        const res = await this._request.send('database.removeDocument', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        return {\r\n            requestId: res.requestId,\r\n            deleted: res.data.deleted\r\n        };\r\n    }\r\n    async updateAndReturn(data) {\r\n        if (!data || typeof data !== 'object') {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: '' }));\r\n        }\r\n        if (data.hasOwnProperty('_id')) {\r\n            return processReturn(this._db.config.throwOnCode, Object.assign(Object.assign({}, ERRORS.INVALID_PARAM), { message: '_id' }));\r\n        }\r\n        let param = {\r\n            collectionName: this._coll,\r\n            queryType: QueryType.WHERE,\r\n            data: UpdateSerializer.encodeEJSON(data, false)\r\n        };\r\n        if (this._transactionId) {\r\n            param.transactionId = this._transactionId;\r\n        }\r\n        if (this._fieldFilters) {\r\n            param.query = this._fieldFilters;\r\n        }\r\n        const res = await this._request.send('database.modifyAndReturnDoc', param, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        return {\r\n            requestId: res.requestId,\r\n            updated: res.data.updated,\r\n            doc: res.data.doc && EJSON.parse(res.data.doc)\r\n        };\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4366, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/aggregate.js"],"sourcesContent":["import { Db } from './index';\r\nimport { EJSON } from 'bson';\r\nimport { QuerySerializer } from './serializer/query';\r\nimport { stringifyByEJSON } from './utils/utils';\r\nimport { getType } from './utils/type';\r\nimport { Validate } from './validate';\r\nimport { Point } from './geo/point';\r\nexport default class Aggregation {\r\n    constructor(db, collectionName, rawPipeline) {\r\n        this._stages = [];\r\n        if (db && collectionName) {\r\n            this._db = db;\r\n            this._request = new Db.reqClass(this._db.config);\r\n            this._collectionName = collectionName;\r\n            if (rawPipeline && rawPipeline.length > 0) {\r\n                rawPipeline.forEach((stage) => {\r\n                    Validate.isValidAggregation(stage);\r\n                    const stageName = Object.keys(stage)[0];\r\n                    this._pipe(stageName, stage[stageName], true);\r\n                });\r\n            }\r\n        }\r\n    }\r\n    async end() {\r\n        if (!this._collectionName || !this._db) {\r\n            throw new Error('Aggregation pipeline cannot send request');\r\n        }\r\n        const result = await this._request.send('database.aggregateDocuments', {\r\n            collectionName: this._collectionName,\r\n            stages: this._stages\r\n        });\r\n        if (result && result.data && result.data.list) {\r\n            return {\r\n                requestId: result.requestId,\r\n                data: result.data.list.map(EJSON.parse)\r\n            };\r\n        }\r\n        return result;\r\n    }\r\n    unwrap() {\r\n        return this._stages;\r\n    }\r\n    done() {\r\n        return this._stages.map(({ stageKey, stageValue }) => {\r\n            return {\r\n                [stageKey]: JSON.parse(stageValue)\r\n            };\r\n        });\r\n    }\r\n    _pipe(stage, param, raw = false) {\r\n        let transformParam = '';\r\n        if (getType(param) === 'object') {\r\n            transformParam = stringifyByEJSON(param);\r\n        }\r\n        else {\r\n            transformParam = JSON.stringify(param);\r\n        }\r\n        this._stages.push({\r\n            stageKey: raw ? stage : `$${stage}`,\r\n            stageValue: transformParam\r\n        });\r\n        return this;\r\n    }\r\n    addFields(param) {\r\n        return this._pipe('addFields', param);\r\n    }\r\n    bucket(param) {\r\n        return this._pipe('bucket', param);\r\n    }\r\n    bucketAuto(param) {\r\n        return this._pipe('bucketAuto', param);\r\n    }\r\n    count(param) {\r\n        return this._pipe('count', param);\r\n    }\r\n    geoNear(param) {\r\n        if (param.query) {\r\n            param.query = QuerySerializer.encode(param.query);\r\n        }\r\n        if (param.distanceMultiplier && typeof (param.distanceMultiplier) === 'number') {\r\n            param.distanceMultiplier = param.distanceMultiplier;\r\n        }\r\n        if (param.near) {\r\n            param.near = new Point(param.near.longitude, param.near.latitude).toJSON();\r\n        }\r\n        return this._pipe('geoNear', param);\r\n    }\r\n    group(param) {\r\n        return this._pipe('group', param);\r\n    }\r\n    limit(param) {\r\n        return this._pipe('limit', param);\r\n    }\r\n    match(param) {\r\n        return this._pipe('match', QuerySerializer.encode(param));\r\n    }\r\n    project(param) {\r\n        return this._pipe('project', param);\r\n    }\r\n    lookup(param) {\r\n        return this._pipe('lookup', param);\r\n    }\r\n    replaceRoot(param) {\r\n        return this._pipe('replaceRoot', param);\r\n    }\r\n    sample(param) {\r\n        return this._pipe('sample', param);\r\n    }\r\n    skip(param) {\r\n        return this._pipe('skip', param);\r\n    }\r\n    sort(param) {\r\n        return this._pipe('sort', param);\r\n    }\r\n    sortByCount(param) {\r\n        return this._pipe('sortByCount', param);\r\n    }\r\n    unwind(param) {\r\n        return this._pipe('unwind', param);\r\n    }\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}},
    {"offset": {"line": 4501, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/collection.js"],"sourcesContent":["import { DocumentReference } from './document';\r\nimport { Query } from './query';\r\nimport Aggregation from './aggregate';\r\nimport { serialize } from './serializer/datatype';\r\nimport { getReqOpts, stringifyByEJSON } from './utils/utils';\r\nimport { Validate } from './validate';\r\nimport { isArray } from './utils/type';\r\nexport class CollectionReference extends Query {\r\n    constructor(db, coll, apiOptions, transactionId) {\r\n        super(db, coll, '', apiOptions, transactionId);\r\n        if (transactionId) {\r\n            this._transactionId = transactionId;\r\n        }\r\n    }\r\n    get name() {\r\n        return this._coll;\r\n    }\r\n    doc(docID) {\r\n        if (typeof docID !== 'string' && typeof docID !== 'number') {\r\n            throw new Error('docId');\r\n        }\r\n        return new DocumentReference(this._db, this._coll, this._apiOptions, docID, this._transactionId);\r\n    }\r\n    async add(data) {\r\n        let transformData = data;\r\n        if (!isArray(data)) {\r\n            transformData = [data];\r\n        }\r\n        transformData = transformData.map(item => {\r\n            return stringifyByEJSON(serialize(item));\r\n        });\r\n        let params = {\r\n            collectionName: this._coll,\r\n            data: transformData\r\n        };\r\n        if (this._transactionId) {\r\n            params.transactionId = this._transactionId;\r\n        }\r\n        const res = await this._request.send('database.insertDocument', params, getReqOpts(this._apiOptions));\r\n        if (res.code) {\r\n            return res;\r\n        }\r\n        if (!isArray(data)) {\r\n            if (this._transactionId) {\r\n                return {\r\n                    inserted: 1,\r\n                    ok: 1,\r\n                    id: res.data.insertedIds[0],\r\n                    requestId: res.requestId\r\n                };\r\n            }\r\n            return {\r\n                id: res.data.insertedIds[0],\r\n                requestId: res.requestId\r\n            };\r\n        }\r\n        return {\r\n            ids: res.data.insertedIds,\r\n            requestId: res.requestId\r\n        };\r\n    }\r\n    aggregate(rawPipeline = []) {\r\n        return new Aggregation(this._db, this._coll, (this._apiOptions.raw || false) ? rawPipeline : []);\r\n    }\r\n    options(apiOptions) {\r\n        Validate.isValidOptions(apiOptions);\r\n        return new CollectionReference(this._db, this._coll, apiOptions, this._transactionId);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AACO,MAAM,4BAA4B,8OAAK;IAC1C,YAAY,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,aAAa,CAAE;QAC7C,KAAK,CAAC,IAAI,MAAM,IAAI,YAAY;QAChC,IAAI,eAAe;YACf,IAAI,CAAC,cAAc,GAAG;QAC1B;IACJ;IACA,IAAI,OAAO;QACP,OAAO,IAAI,CAAC,KAAK;IACrB;IACA,IAAI,KAAK,EAAE;QACP,IAAI,OAAO,UAAU,YAAY,OAAO,UAAU,UAAU;YACxD,MAAM,IAAI,MAAM;QACpB;QACA,OAAO,IAAI,6PAAiB,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,EAAE,OAAO,IAAI,CAAC,cAAc;IACnG;IACA,MAAM,IAAI,IAAI,EAAE;QACZ,IAAI,gBAAgB;QACpB,IAAI,CAAC,IAAA,wPAAO,EAAC,OAAO;YAChB,gBAAgB;gBAAC;aAAK;QAC1B;QACA,gBAAgB,cAAc,GAAG,CAAC,CAAA;YAC9B,OAAO,wQAAiB,yQAAU;QACtC;QACA,IAAI,SAAS;YACT,gBAAgB,IAAI,CAAC,KAAK;YAC1B,MAAM;QACV;QACA,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,OAAO,aAAa,GAAG,IAAI,CAAC,cAAc;QAC9C;QACA,MAAM,MAAM,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,2BAA2B,QAAQ,IAAA,4PAAU,EAAC,IAAI,CAAC,WAAW;QACnG,IAAI,IAAI,IAAI,EAAE;YACV,OAAO;QACX;QACA,IAAI,CAAC,IAAA,wPAAO,EAAC,OAAO;YAChB,IAAI,IAAI,CAAC,cAAc,EAAE;gBACrB,OAAO;oBACH,UAAU;oBACV,IAAI;oBACJ,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,EAAE;oBAC3B,WAAW,IAAI,SAAS;gBAC5B;YACJ;YACA,OAAO;gBACH,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,EAAE;gBAC3B,WAAW,IAAI,SAAS;YAC5B;QACJ;QACA,OAAO;YACH,KAAK,IAAI,IAAI,CAAC,WAAW;YACzB,WAAW,IAAI,SAAS;QAC5B;IACJ;IACA,UAAU,cAAc,EAAE,EAAE;QACxB,OAAO,IAAI,oPAAW,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,EAAE,AAAC,IAAI,CAAC,WAAW,CAAC,GAAG,IAAI,QAAS,cAAc,EAAE;IACnG;IACA,QAAQ,UAAU,EAAE;QAChB,oPAAQ,CAAC,cAAc,CAAC;QACxB,OAAO,IAAI,oBAAoB,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,EAAE,YAAY,IAAI,CAAC,cAAc;IACxF;AACJ","ignoreList":[0]}},
    {"offset": {"line": 4587, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/command.js"],"sourcesContent":["import { QueryCommand, QUERY_COMMANDS_LITERAL } from './commands/query';\r\nimport { LogicCommand, LOGIC_COMMANDS_LITERAL } from './commands/logic';\r\nimport { UpdateCommand, UPDATE_COMMANDS_LITERAL } from './commands/update';\r\nimport { isArray, isObject, isString } from './utils/type';\r\nimport Aggregation from './aggregate';\r\nexport const Command = {\r\n    eq(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.EQ, [val]);\r\n    },\r\n    neq(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.NEQ, [val]);\r\n    },\r\n    lt(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.LT, [val]);\r\n    },\r\n    lte(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.LTE, [val]);\r\n    },\r\n    gt(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.GT, [val]);\r\n    },\r\n    gte(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.GTE, [val]);\r\n    },\r\n    in(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.IN, val);\r\n    },\r\n    nin(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.NIN, val);\r\n    },\r\n    all(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.ALL, val);\r\n    },\r\n    elemMatch(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.ELEM_MATCH, [val]);\r\n    },\r\n    exists(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.EXISTS, [val]);\r\n    },\r\n    size(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.SIZE, [val]);\r\n    },\r\n    mod() {\r\n        if (arguments.length == 1)\r\n            return new QueryCommand(QUERY_COMMANDS_LITERAL.MOD, [arguments[0]]);\r\n        if (arguments.length == 2)\r\n            return new QueryCommand(QUERY_COMMANDS_LITERAL.MOD, [[arguments[0], arguments[1]]]);\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.MOD, arguments);\r\n    },\r\n    geoNear(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_NEAR, [val]);\r\n    },\r\n    geoWithin(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_WITHIN, [val]);\r\n    },\r\n    geoIntersects(val) {\r\n        return new QueryCommand(QUERY_COMMANDS_LITERAL.GEO_INTERSECTS, [val]);\r\n    },\r\n    and(...__expressions__) {\r\n        const expressions = isArray(arguments[0]) ? arguments[0] : Array.from(arguments);\r\n        return new LogicCommand(LOGIC_COMMANDS_LITERAL.AND, expressions);\r\n    },\r\n    nor(...__expressions__) {\r\n        const expressions = isArray(arguments[0]) ? arguments[0] : Array.from(arguments);\r\n        return new LogicCommand(LOGIC_COMMANDS_LITERAL.NOR, expressions);\r\n    },\r\n    or(...__expressions__) {\r\n        const expressions = isArray(arguments[0]) ? arguments[0] : Array.from(arguments);\r\n        return new LogicCommand(LOGIC_COMMANDS_LITERAL.OR, expressions);\r\n    },\r\n    not(...__expressions__) {\r\n        const expressions = isArray(arguments[0]) ? arguments[0] : Array.from(arguments);\r\n        return new LogicCommand(LOGIC_COMMANDS_LITERAL.NOT, expressions);\r\n    },\r\n    set(val) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.SET, [val]);\r\n    },\r\n    remove() {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.REMOVE, []);\r\n    },\r\n    inc(val) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.INC, [val]);\r\n    },\r\n    mul(val) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.MUL, [val]);\r\n    },\r\n    push(...args) {\r\n        let values;\r\n        if (isObject(args[0]) && args[0].hasOwnProperty('each')) {\r\n            values = {};\r\n            const options = args[0];\r\n            if (options.each !== undefined) {\r\n                values['$each'] = options.each;\r\n            }\r\n            if (options.position !== undefined) {\r\n                values['$position'] = options.position;\r\n            }\r\n            if (options.sort !== undefined) {\r\n                values['$sort'] = options.sort;\r\n            }\r\n            if (options.slice !== undefined) {\r\n                values['$slice'] = options.slice;\r\n            }\r\n        }\r\n        else if (isArray(args[0])) {\r\n            values = args[0];\r\n        }\r\n        else {\r\n            values = Array.from(args);\r\n        }\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.PUSH, values);\r\n    },\r\n    pull(values) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.PULL, values);\r\n    },\r\n    pullAll(values) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.PULL_ALL, values);\r\n    },\r\n    pop() {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.POP, []);\r\n    },\r\n    shift() {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.SHIFT, []);\r\n    },\r\n    unshift(...__values__) {\r\n        const values = isArray(arguments[0]) ? arguments[0] : Array.from(arguments);\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.UNSHIFT, values);\r\n    },\r\n    addToSet(values) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.ADD_TO_SET, values);\r\n    },\r\n    rename(values) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.RENAME, [values]);\r\n    },\r\n    bit(values) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.BIT, [values]);\r\n    },\r\n    max(values) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.MAX, [values]);\r\n    },\r\n    min(values) {\r\n        return new UpdateCommand(UPDATE_COMMANDS_LITERAL.MIN, [values]);\r\n    },\r\n    expr(values) {\r\n        return {\r\n            $expr: values\r\n        };\r\n    },\r\n    jsonSchema(schema) {\r\n        return {\r\n            $jsonSchema: schema\r\n        };\r\n    },\r\n    text(values) {\r\n        if (isString(values)) {\r\n            return {\r\n                $search: values.search\r\n            };\r\n        }\r\n        else {\r\n            return {\r\n                $search: values.search,\r\n                $language: values.language,\r\n                $caseSensitive: values.caseSensitive,\r\n                $diacriticSensitive: values.diacriticSensitive\r\n            };\r\n        }\r\n    },\r\n    aggregate: {\r\n        pipeline() {\r\n            return new Aggregation();\r\n        },\r\n        abs: param => new AggregationOperator('abs', param),\r\n        add: param => new AggregationOperator('add', param),\r\n        ceil: param => new AggregationOperator('ceil', param),\r\n        divide: param => new AggregationOperator('divide', param),\r\n        exp: param => new AggregationOperator('exp', param),\r\n        floor: param => new AggregationOperator('floor', param),\r\n        ln: param => new AggregationOperator('ln', param),\r\n        log: param => new AggregationOperator('log', param),\r\n        log10: param => new AggregationOperator('log10', param),\r\n        mod: param => new AggregationOperator('mod', param),\r\n        multiply: param => new AggregationOperator('multiply', param),\r\n        pow: param => new AggregationOperator('pow', param),\r\n        sqrt: param => new AggregationOperator('sqrt', param),\r\n        subtract: param => new AggregationOperator('subtract', param),\r\n        trunc: param => new AggregationOperator('trunc', param),\r\n        arrayElemAt: param => new AggregationOperator('arrayElemAt', param),\r\n        arrayToObject: param => new AggregationOperator('arrayToObject', param),\r\n        concatArrays: param => new AggregationOperator('concatArrays', param),\r\n        filter: param => new AggregationOperator('filter', param),\r\n        in: param => new AggregationOperator('in', param),\r\n        indexOfArray: param => new AggregationOperator('indexOfArray', param),\r\n        isArray: param => new AggregationOperator('isArray', param),\r\n        map: param => new AggregationOperator('map', param),\r\n        range: param => new AggregationOperator('range', param),\r\n        reduce: param => new AggregationOperator('reduce', param),\r\n        reverseArray: param => new AggregationOperator('reverseArray', param),\r\n        size: param => new AggregationOperator('size', param),\r\n        slice: param => new AggregationOperator('slice', param),\r\n        zip: param => new AggregationOperator('zip', param),\r\n        and: param => new AggregationOperator('and', param),\r\n        not: param => new AggregationOperator('not', param),\r\n        or: param => new AggregationOperator('or', param),\r\n        cmp: param => new AggregationOperator('cmp', param),\r\n        eq: param => new AggregationOperator('eq', param),\r\n        gt: param => new AggregationOperator('gt', param),\r\n        gte: param => new AggregationOperator('gte', param),\r\n        lt: param => new AggregationOperator('lt', param),\r\n        lte: param => new AggregationOperator('lte', param),\r\n        neq: param => new AggregationOperator('ne', param),\r\n        cond: param => new AggregationOperator('cond', param),\r\n        ifNull: param => new AggregationOperator('ifNull', param),\r\n        switch: param => new AggregationOperator('switch', param),\r\n        dateFromParts: param => new AggregationOperator('dateFromParts', param),\r\n        dateFromString: param => new AggregationOperator('dateFromString', param),\r\n        dayOfMonth: param => new AggregationOperator('dayOfMonth', param),\r\n        dayOfWeek: param => new AggregationOperator('dayOfWeek', param),\r\n        dayOfYear: param => new AggregationOperator('dayOfYear', param),\r\n        isoDayOfWeek: param => new AggregationOperator('isoDayOfWeek', param),\r\n        isoWeek: param => new AggregationOperator('isoWeek', param),\r\n        isoWeekYear: param => new AggregationOperator('isoWeekYear', param),\r\n        millisecond: param => new AggregationOperator('millisecond', param),\r\n        minute: param => new AggregationOperator('minute', param),\r\n        month: param => new AggregationOperator('month', param),\r\n        second: param => new AggregationOperator('second', param),\r\n        hour: param => new AggregationOperator('hour', param),\r\n        week: param => new AggregationOperator('week', param),\r\n        year: param => new AggregationOperator('year', param),\r\n        literal: param => new AggregationOperator('literal', param),\r\n        mergeObjects: param => new AggregationOperator('mergeObjects', param),\r\n        objectToArray: param => new AggregationOperator('objectToArray', param),\r\n        allElementsTrue: param => new AggregationOperator('allElementsTrue', param),\r\n        anyElementTrue: param => new AggregationOperator('anyElementTrue', param),\r\n        setDifference: param => new AggregationOperator('setDifference', param),\r\n        setEquals: param => new AggregationOperator('setEquals', param),\r\n        setIntersection: param => new AggregationOperator('setIntersection', param),\r\n        setIsSubset: param => new AggregationOperator('setIsSubset', param),\r\n        setUnion: param => new AggregationOperator('setUnion', param),\r\n        concat: param => new AggregationOperator('concat', param),\r\n        dateToString: param => new AggregationOperator('dateToString', param),\r\n        indexOfBytes: param => new AggregationOperator('indexOfBytes', param),\r\n        indexOfCP: param => new AggregationOperator('indexOfCP', param),\r\n        split: param => new AggregationOperator('split', param),\r\n        strLenBytes: param => new AggregationOperator('strLenBytes', param),\r\n        strLenCP: param => new AggregationOperator('strLenCP', param),\r\n        strcasecmp: param => new AggregationOperator('strcasecmp', param),\r\n        substr: param => new AggregationOperator('substr', param),\r\n        substrBytes: param => new AggregationOperator('substrBytes', param),\r\n        substrCP: param => new AggregationOperator('substrCP', param),\r\n        toLower: param => new AggregationOperator('toLower', param),\r\n        toUpper: param => new AggregationOperator('toUpper', param),\r\n        meta: param => new AggregationOperator('meta', param),\r\n        addToSet: param => new AggregationOperator('addToSet', param),\r\n        avg: param => new AggregationOperator('avg', param),\r\n        first: param => new AggregationOperator('first', param),\r\n        last: param => new AggregationOperator('last', param),\r\n        max: param => new AggregationOperator('max', param),\r\n        min: param => new AggregationOperator('min', param),\r\n        push: param => new AggregationOperator('push', param),\r\n        stdDevPop: param => new AggregationOperator('stdDevPop', param),\r\n        stdDevSamp: param => new AggregationOperator('stdDevSamp', param),\r\n        sum: param => new AggregationOperator('sum', param),\r\n        let: param => new AggregationOperator('let', param)\r\n    },\r\n    project: {\r\n        slice: param => new ProjectionOperator('slice', param),\r\n        elemMatch: param => new ProjectionOperator('elemMatch', param)\r\n    }\r\n};\r\nexport class AggregationOperator {\r\n    constructor(name, param) {\r\n        this['$' + name] = param;\r\n    }\r\n}\r\nexport class ProjectionOperator {\r\n    constructor(name, param) {\r\n        this['$' + name] = param;\r\n    }\r\n}\r\nexport default Command;\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AACO,MAAM,UAAU;IACnB,IAAG,GAAG;QACF,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,EAAE,EAAE;YAAC;SAAI;IAC5D;IACA,KAAI,GAAG;QACH,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;YAAC;SAAI;IAC7D;IACA,IAAG,GAAG;QACF,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,EAAE,EAAE;YAAC;SAAI;IAC5D;IACA,KAAI,GAAG;QACH,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;YAAC;SAAI;IAC7D;IACA,IAAG,GAAG;QACF,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,EAAE,EAAE;YAAC;SAAI;IAC5D;IACA,KAAI,GAAG;QACH,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;YAAC;SAAI;IAC7D;IACA,IAAG,GAAG;QACF,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,EAAE,EAAE;IACvD;IACA,KAAI,GAAG;QACH,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;IACxD;IACA,KAAI,GAAG;QACH,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;IACxD;IACA,WAAU,GAAG;QACT,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,UAAU,EAAE;YAAC;SAAI;IACpE;IACA,QAAO,GAAG;QACN,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,MAAM,EAAE;YAAC;SAAI;IAChE;IACA,MAAK,GAAG;QACJ,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,IAAI,EAAE;YAAC;SAAI;IAC9D;IACA;QACI,IAAI,UAAU,MAAM,IAAI,GACpB,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;YAAC,SAAS,CAAC,EAAE;SAAC;QACtE,IAAI,UAAU,MAAM,IAAI,GACpB,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;YAAC;gBAAC,SAAS,CAAC,EAAE;gBAAE,SAAS,CAAC,EAAE;aAAC;SAAC;QACtF,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;IACxD;IACA,SAAQ,GAAG;QACP,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,QAAQ,EAAE;YAAC;SAAI;IAClE;IACA,WAAU,GAAG;QACT,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,UAAU,EAAE;YAAC;SAAI;IACpE;IACA,eAAc,GAAG;QACb,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,cAAc,EAAE;YAAC;SAAI;IACxE;IACA,KAAI,GAAG,eAAe;QAClB,MAAM,cAAc,IAAA,wPAAO,EAAC,SAAS,CAAC,EAAE,IAAI,SAAS,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC;QACtE,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;IACxD;IACA,KAAI,GAAG,eAAe;QAClB,MAAM,cAAc,IAAA,wPAAO,EAAC,SAAS,CAAC,EAAE,IAAI,SAAS,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC;QACtE,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;IACxD;IACA,IAAG,GAAG,eAAe;QACjB,MAAM,cAAc,IAAA,wPAAO,EAAC,SAAS,CAAC,EAAE,IAAI,SAAS,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC;QACtE,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,EAAE,EAAE;IACvD;IACA,KAAI,GAAG,eAAe;QAClB,MAAM,cAAc,IAAA,wPAAO,EAAC,SAAS,CAAC,EAAE,IAAI,SAAS,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC;QACtE,OAAO,IAAI,iQAAY,CAAC,2QAAsB,CAAC,GAAG,EAAE;IACxD;IACA,KAAI,GAAG;QACH,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,GAAG,EAAE;YAAC;SAAI;IAC/D;IACA;QACI,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,MAAM,EAAE,EAAE;IAC/D;IACA,KAAI,GAAG;QACH,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,GAAG,EAAE;YAAC;SAAI;IAC/D;IACA,KAAI,GAAG;QACH,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,GAAG,EAAE;YAAC;SAAI;IAC/D;IACA,MAAK,GAAG,IAAI;QACR,IAAI;QACJ,IAAI,IAAA,yPAAQ,EAAC,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,CAAC,cAAc,CAAC,SAAS;YACrD,SAAS,CAAC;YACV,MAAM,UAAU,IAAI,CAAC,EAAE;YACvB,IAAI,QAAQ,IAAI,KAAK,WAAW;gBAC5B,MAAM,CAAC,QAAQ,GAAG,QAAQ,IAAI;YAClC;YACA,IAAI,QAAQ,QAAQ,KAAK,WAAW;gBAChC,MAAM,CAAC,YAAY,GAAG,QAAQ,QAAQ;YAC1C;YACA,IAAI,QAAQ,IAAI,KAAK,WAAW;gBAC5B,MAAM,CAAC,QAAQ,GAAG,QAAQ,IAAI;YAClC;YACA,IAAI,QAAQ,KAAK,KAAK,WAAW;gBAC7B,MAAM,CAAC,SAAS,GAAG,QAAQ,KAAK;YACpC;QACJ,OACK,IAAI,IAAA,wPAAO,EAAC,IAAI,CAAC,EAAE,GAAG;YACvB,SAAS,IAAI,CAAC,EAAE;QACpB,OACK;YACD,SAAS,MAAM,IAAI,CAAC;QACxB;QACA,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,IAAI,EAAE;IAC3D;IACA,MAAK,MAAM;QACP,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,IAAI,EAAE;IAC3D;IACA,SAAQ,MAAM;QACV,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,QAAQ,EAAE;IAC/D;IACA;QACI,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,GAAG,EAAE,EAAE;IAC5D;IACA;QACI,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,KAAK,EAAE,EAAE;IAC9D;IACA,SAAQ,GAAG,UAAU;QACjB,MAAM,SAAS,IAAA,wPAAO,EAAC,SAAS,CAAC,EAAE,IAAI,SAAS,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC;QACjE,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,OAAO,EAAE;IAC9D;IACA,UAAS,MAAM;QACX,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,UAAU,EAAE;IACjE;IACA,QAAO,MAAM;QACT,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,MAAM,EAAE;YAAC;SAAO;IACrE;IACA,KAAI,MAAM;QACN,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,GAAG,EAAE;YAAC;SAAO;IAClE;IACA,KAAI,MAAM;QACN,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,GAAG,EAAE;YAAC;SAAO;IAClE;IACA,KAAI,MAAM;QACN,OAAO,IAAI,mQAAa,CAAC,6QAAuB,CAAC,GAAG,EAAE;YAAC;SAAO;IAClE;IACA,MAAK,MAAM;QACP,OAAO;YACH,OAAO;QACX;IACJ;IACA,YAAW,MAAM;QACb,OAAO;YACH,aAAa;QACjB;IACJ;IACA,MAAK,MAAM;QACP,IAAI,IAAA,yPAAQ,EAAC,SAAS;YAClB,OAAO;gBACH,SAAS,OAAO,MAAM;YAC1B;QACJ,OACK;YACD,OAAO;gBACH,SAAS,OAAO,MAAM;gBACtB,WAAW,OAAO,QAAQ;gBAC1B,gBAAgB,OAAO,aAAa;gBACpC,qBAAqB,OAAO,kBAAkB;YAClD;QACJ;IACJ;IACA,WAAW;QACP;YACI,OAAO,IAAI,oPAAW;QAC1B;QACA,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,OAAO,CAAA,QAAS,IAAI,oBAAoB,SAAS;QACjD,IAAI,CAAA,QAAS,IAAI,oBAAoB,MAAM;QAC3C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,OAAO,CAAA,QAAS,IAAI,oBAAoB,SAAS;QACjD,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,UAAU,CAAA,QAAS,IAAI,oBAAoB,YAAY;QACvD,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,UAAU,CAAA,QAAS,IAAI,oBAAoB,YAAY;QACvD,OAAO,CAAA,QAAS,IAAI,oBAAoB,SAAS;QACjD,aAAa,CAAA,QAAS,IAAI,oBAAoB,eAAe;QAC7D,eAAe,CAAA,QAAS,IAAI,oBAAoB,iBAAiB;QACjE,cAAc,CAAA,QAAS,IAAI,oBAAoB,gBAAgB;QAC/D,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,IAAI,CAAA,QAAS,IAAI,oBAAoB,MAAM;QAC3C,cAAc,CAAA,QAAS,IAAI,oBAAoB,gBAAgB;QAC/D,SAAS,CAAA,QAAS,IAAI,oBAAoB,WAAW;QACrD,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,OAAO,CAAA,QAAS,IAAI,oBAAoB,SAAS;QACjD,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,cAAc,CAAA,QAAS,IAAI,oBAAoB,gBAAgB;QAC/D,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,OAAO,CAAA,QAAS,IAAI,oBAAoB,SAAS;QACjD,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,IAAI,CAAA,QAAS,IAAI,oBAAoB,MAAM;QAC3C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,IAAI,CAAA,QAAS,IAAI,oBAAoB,MAAM;QAC3C,IAAI,CAAA,QAAS,IAAI,oBAAoB,MAAM;QAC3C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,IAAI,CAAA,QAAS,IAAI,oBAAoB,MAAM;QAC3C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,KAAK,CAAA,QAAS,IAAI,oBAAoB,MAAM;QAC5C,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,eAAe,CAAA,QAAS,IAAI,oBAAoB,iBAAiB;QACjE,gBAAgB,CAAA,QAAS,IAAI,oBAAoB,kBAAkB;QACnE,YAAY,CAAA,QAAS,IAAI,oBAAoB,cAAc;QAC3D,WAAW,CAAA,QAAS,IAAI,oBAAoB,aAAa;QACzD,WAAW,CAAA,QAAS,IAAI,oBAAoB,aAAa;QACzD,cAAc,CAAA,QAAS,IAAI,oBAAoB,gBAAgB;QAC/D,SAAS,CAAA,QAAS,IAAI,oBAAoB,WAAW;QACrD,aAAa,CAAA,QAAS,IAAI,oBAAoB,eAAe;QAC7D,aAAa,CAAA,QAAS,IAAI,oBAAoB,eAAe;QAC7D,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,OAAO,CAAA,QAAS,IAAI,oBAAoB,SAAS;QACjD,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,SAAS,CAAA,QAAS,IAAI,oBAAoB,WAAW;QACrD,cAAc,CAAA,QAAS,IAAI,oBAAoB,gBAAgB;QAC/D,eAAe,CAAA,QAAS,IAAI,oBAAoB,iBAAiB;QACjE,iBAAiB,CAAA,QAAS,IAAI,oBAAoB,mBAAmB;QACrE,gBAAgB,CAAA,QAAS,IAAI,oBAAoB,kBAAkB;QACnE,eAAe,CAAA,QAAS,IAAI,oBAAoB,iBAAiB;QACjE,WAAW,CAAA,QAAS,IAAI,oBAAoB,aAAa;QACzD,iBAAiB,CAAA,QAAS,IAAI,oBAAoB,mBAAmB;QACrE,aAAa,CAAA,QAAS,IAAI,oBAAoB,eAAe;QAC7D,UAAU,CAAA,QAAS,IAAI,oBAAoB,YAAY;QACvD,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,cAAc,CAAA,QAAS,IAAI,oBAAoB,gBAAgB;QAC/D,cAAc,CAAA,QAAS,IAAI,oBAAoB,gBAAgB;QAC/D,WAAW,CAAA,QAAS,IAAI,oBAAoB,aAAa;QACzD,OAAO,CAAA,QAAS,IAAI,oBAAoB,SAAS;QACjD,aAAa,CAAA,QAAS,IAAI,oBAAoB,eAAe;QAC7D,UAAU,CAAA,QAAS,IAAI,oBAAoB,YAAY;QACvD,YAAY,CAAA,QAAS,IAAI,oBAAoB,cAAc;QAC3D,QAAQ,CAAA,QAAS,IAAI,oBAAoB,UAAU;QACnD,aAAa,CAAA,QAAS,IAAI,oBAAoB,eAAe;QAC7D,UAAU,CAAA,QAAS,IAAI,oBAAoB,YAAY;QACvD,SAAS,CAAA,QAAS,IAAI,oBAAoB,WAAW;QACrD,SAAS,CAAA,QAAS,IAAI,oBAAoB,WAAW;QACrD,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,UAAU,CAAA,QAAS,IAAI,oBAAoB,YAAY;QACvD,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,OAAO,CAAA,QAAS,IAAI,oBAAoB,SAAS;QACjD,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,MAAM,CAAA,QAAS,IAAI,oBAAoB,QAAQ;QAC/C,WAAW,CAAA,QAAS,IAAI,oBAAoB,aAAa;QACzD,YAAY,CAAA,QAAS,IAAI,oBAAoB,cAAc;QAC3D,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;QAC7C,KAAK,CAAA,QAAS,IAAI,oBAAoB,OAAO;IACjD;IACA,SAAS;QACL,OAAO,CAAA,QAAS,IAAI,mBAAmB,SAAS;QAChD,WAAW,CAAA,QAAS,IAAI,mBAAmB,aAAa;IAC5D;AACJ;AACO,MAAM;IACT,YAAY,IAAI,EAAE,KAAK,CAAE;QACrB,IAAI,CAAC,MAAM,KAAK,GAAG;IACvB;AACJ;AACO,MAAM;IACT,YAAY,IAAI,EAAE,KAAK,CAAE;QACrB,IAAI,CAAC,MAAM,KAAK,GAAG;IACvB;AACJ;uCACe","ignoreList":[0]}},
    {"offset": {"line": 4927, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/regexp/index.js"],"sourcesContent":["import { SYMBOL_REGEXP } from '../helper/symbol';\r\nexport class RegExp {\r\n    constructor({ regexp, options }) {\r\n        if (!regexp) {\r\n            throw new TypeError('regexp must be a string');\r\n        }\r\n        this.$regularExpression = {\r\n            pattern: regexp || '',\r\n            options: options || ''\r\n        };\r\n    }\r\n    parse() {\r\n        return {\r\n            $regularExpression: {\r\n                pattern: this.$regularExpression.pattern,\r\n                options: this.$regularExpression.options\r\n            }\r\n        };\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_REGEXP;\r\n    }\r\n}\r\nexport function RegExpConstructor(param) {\r\n    return new RegExp(param);\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AACO,MAAM;IACT,YAAY,EAAE,MAAM,EAAE,OAAO,EAAE,CAAE;QAC7B,IAAI,CAAC,QAAQ;YACT,MAAM,IAAI,UAAU;QACxB;QACA,IAAI,CAAC,kBAAkB,GAAG;YACtB,SAAS,UAAU;YACnB,SAAS,WAAW;QACxB;IACJ;IACA,QAAQ;QACJ,OAAO;YACH,oBAAoB;gBAChB,SAAS,IAAI,CAAC,kBAAkB,CAAC,OAAO;gBACxC,SAAS,IAAI,CAAC,kBAAkB,CAAC,OAAO;YAC5C;QACJ;IACJ;IACA,IAAI,gBAAgB;QAChB,OAAO,iRAAa;IACxB;AACJ;AACO,SAAS,kBAAkB,KAAK;IACnC,OAAO,IAAI,OAAO;AACtB","ignoreList":[0]}},
    {"offset": {"line": 4964, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/transaction/index.js"],"sourcesContent":["import { Db } from '../index';\r\nimport { CollectionReference } from '../collection';\r\nimport { ERRORS } from '../const/code';\r\nconst START = 'database.startTransaction';\r\nconst COMMIT = 'database.commitTransaction';\r\nconst ABORT = 'database.abortTransaction';\r\nexport class Transaction {\r\n    constructor(db) {\r\n        this._db = db;\r\n        this._request = new Db.reqClass(this._db.config);\r\n        this.aborted = false;\r\n        this.commited = false;\r\n        this.inited = false;\r\n    }\r\n    async init() {\r\n        const res = await this._request.send(START);\r\n        if (res.code) {\r\n            throw res;\r\n        }\r\n        this.inited = true;\r\n        this._id = res.transactionId;\r\n    }\r\n    collection(collName) {\r\n        if (!collName) {\r\n            throw new Error('Collection name is required');\r\n        }\r\n        return new CollectionReference(this._db, collName, {}, this._id);\r\n    }\r\n    getTransactionId() {\r\n        return this._id;\r\n    }\r\n    getRequestMethod() {\r\n        return this._request;\r\n    }\r\n    async commit() {\r\n        const param = {\r\n            transactionId: this._id\r\n        };\r\n        const res = await this._request.send(COMMIT, param);\r\n        if (res.code)\r\n            throw res;\r\n        this.commited = true;\r\n        return res;\r\n    }\r\n    async rollback(customRollbackRes) {\r\n        const param = {\r\n            transactionId: this._id\r\n        };\r\n        const res = await this._request.send(ABORT, param);\r\n        if (res.code)\r\n            throw res;\r\n        this.aborted = true;\r\n        this.abortReason = customRollbackRes;\r\n        return res;\r\n    }\r\n}\r\nexport async function startTransaction() {\r\n    const transaction = new Transaction(this);\r\n    await transaction.init();\r\n    return transaction;\r\n}\r\nexport async function runTransaction(callback, times = 3) {\r\n    let transaction;\r\n    try {\r\n        transaction = new Transaction(this);\r\n        await transaction.init();\r\n        const callbackRes = await callback(transaction);\r\n        if (transaction.aborted === true) {\r\n            throw transaction.abortReason;\r\n        }\r\n        await transaction.commit();\r\n        return callbackRes;\r\n    }\r\n    catch (error) {\r\n        if (transaction.inited === false) {\r\n            throw error;\r\n        }\r\n        const throwWithRollback = async (error) => {\r\n            if (!transaction.aborted && !transaction.commited) {\r\n                try {\r\n                    await transaction.rollback();\r\n                }\r\n                catch (err) {\r\n                }\r\n                throw error;\r\n            }\r\n            if (transaction.aborted === true) {\r\n                throw transaction.abortReason;\r\n            }\r\n            throw error;\r\n        };\r\n        if (times <= 0) {\r\n            await throwWithRollback(error);\r\n        }\r\n        if (error && error.code === ERRORS.DATABASE_TRANSACTION_CONFLICT.code) {\r\n            return await runTransaction.bind(this)(callback, --times);\r\n        }\r\n        await throwWithRollback(error);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AACA,MAAM,QAAQ;AACd,MAAM,SAAS;AACf,MAAM,QAAQ;AACP,MAAM;IACT,YAAY,EAAE,CAAE;QACZ,IAAI,CAAC,GAAG,GAAG;QACX,IAAI,CAAC,QAAQ,GAAG,IAAI,2PAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM;QAC/C,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,MAAM,GAAG;IAClB;IACA,MAAM,OAAO;QACT,MAAM,MAAM,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;QACrC,IAAI,IAAI,IAAI,EAAE;YACV,MAAM;QACV;QACA,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,GAAG,GAAG,IAAI,aAAa;IAChC;IACA,WAAW,QAAQ,EAAE;QACjB,IAAI,CAAC,UAAU;YACX,MAAM,IAAI,MAAM;QACpB;QACA,OAAO,IAAI,iQAAmB,CAAC,IAAI,CAAC,GAAG,EAAE,UAAU,CAAC,GAAG,IAAI,CAAC,GAAG;IACnE;IACA,mBAAmB;QACf,OAAO,IAAI,CAAC,GAAG;IACnB;IACA,mBAAmB;QACf,OAAO,IAAI,CAAC,QAAQ;IACxB;IACA,MAAM,SAAS;QACX,MAAM,QAAQ;YACV,eAAe,IAAI,CAAC,GAAG;QAC3B;QACA,MAAM,MAAM,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ;QAC7C,IAAI,IAAI,IAAI,EACR,MAAM;QACV,IAAI,CAAC,QAAQ,GAAG;QAChB,OAAO;IACX;IACA,MAAM,SAAS,iBAAiB,EAAE;QAC9B,MAAM,QAAQ;YACV,eAAe,IAAI,CAAC,GAAG;QAC3B;QACA,MAAM,MAAM,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO;QAC5C,IAAI,IAAI,IAAI,EACR,MAAM;QACV,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,WAAW,GAAG;QACnB,OAAO;IACX;AACJ;AACO,eAAe;IAClB,MAAM,cAAc,IAAI,YAAY,IAAI;IACxC,MAAM,YAAY,IAAI;IACtB,OAAO;AACX;AACO,eAAe,eAAe,QAAQ,EAAE,QAAQ,CAAC;IACpD,IAAI;IACJ,IAAI;QACA,cAAc,IAAI,YAAY,IAAI;QAClC,MAAM,YAAY,IAAI;QACtB,MAAM,cAAc,MAAM,SAAS;QACnC,IAAI,YAAY,OAAO,KAAK,MAAM;YAC9B,MAAM,YAAY,WAAW;QACjC;QACA,MAAM,YAAY,MAAM;QACxB,OAAO;IACX,EACA,OAAO,OAAO;QACV,IAAI,YAAY,MAAM,KAAK,OAAO;YAC9B,MAAM;QACV;QACA,MAAM,oBAAoB,OAAO;YAC7B,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,YAAY,QAAQ,EAAE;gBAC/C,IAAI;oBACA,MAAM,YAAY,QAAQ;gBAC9B,EACA,OAAO,KAAK,CACZ;gBACA,MAAM;YACV;YACA,IAAI,YAAY,OAAO,KAAK,MAAM;gBAC9B,MAAM,YAAY,WAAW;YACjC;YACA,MAAM;QACV;QACA,IAAI,SAAS,GAAG;YACZ,MAAM,kBAAkB;QAC5B;QACA,IAAI,SAAS,MAAM,IAAI,KAAK,uPAAM,CAAC,6BAA6B,CAAC,IAAI,EAAE;YACnE,OAAO,MAAM,eAAe,IAAI,CAAC,IAAI,EAAE,UAAU,EAAE;QACvD;QACA,MAAM,kBAAkB;IAC5B;AACJ","ignoreList":[0]}},
    {"offset": {"line": 5074, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/ObjectId/index.js"],"sourcesContent":["import { SYMBOL_OBJECTID } from '../helper/symbol';\r\nexport class ObjectId {\r\n    constructor({ id = '' } = {}) {\r\n        this.id = id;\r\n    }\r\n    get _internalType() {\r\n        return SYMBOL_OBJECTID;\r\n    }\r\n    parse() {\r\n        return {\r\n            $oid: this.id\r\n        };\r\n    }\r\n}\r\nexport function ObjectIdConstructor(opt) {\r\n    return new ObjectId(opt);\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AACO,MAAM;IACT,YAAY,EAAE,KAAK,EAAE,EAAE,GAAG,CAAC,CAAC,CAAE;QAC1B,IAAI,CAAC,EAAE,GAAG;IACd;IACA,IAAI,gBAAgB;QAChB,OAAO,mRAAe;IAC1B;IACA,QAAQ;QACJ,OAAO;YACH,MAAM,IAAI,CAAC,EAAE;QACjB;IACJ;AACJ;AACO,SAAS,oBAAoB,GAAG;IACnC,OAAO,IAAI,SAAS;AACxB","ignoreList":[0]}},
    {"offset": {"line": 5102, "column": 0}, "map": {"version":3,"sources":["file:///Users/weili/work/generate-web/node_modules/.pnpm/%40cloudbase%2Bdatabase%401.4.1/node_modules/%40cloudbase/database/dist/esm/index.js"],"sourcesContent":["import * as Geo from './geo/index';\r\nimport { CollectionReference } from './collection';\r\nimport { Command } from './command';\r\nimport { ServerDateConstructor } from './serverDate/index';\r\nimport { RegExpConstructor } from './regexp/index';\r\nimport { startTransaction, runTransaction } from './transaction/index';\r\nimport { ObjectIdConstructor } from './ObjectId/index';\r\nexport { Query } from './query';\r\nexport { CollectionReference } from './collection';\r\nexport { DocumentReference } from './document';\r\nexport class Db {\r\n    constructor(config) {\r\n        this.config = config;\r\n        this.Geo = Geo;\r\n        this.serverDate = ServerDateConstructor;\r\n        this.command = Command;\r\n        this.RegExp = RegExpConstructor;\r\n        this.ObjectId = ObjectIdConstructor;\r\n        this.startTransaction = startTransaction;\r\n        this.runTransaction = runTransaction;\r\n    }\r\n    collection(collName) {\r\n        if (!collName) {\r\n            throw new Error('Collection name is required');\r\n        }\r\n        return new CollectionReference(this, collName);\r\n    }\r\n    createCollection(collName) {\r\n        let request = new Db.reqClass(this.config);\r\n        const params = {\r\n            collectionName: collName\r\n        };\r\n        return request.send('database.addCollection', params);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAIO,MAAM;IACT,YAAY,MAAM,CAAE;QAChB,IAAI,CAAC,MAAM,GAAG;QACd,IAAI,CAAC,GAAG,GAAG;QACX,IAAI,CAAC,UAAU,GAAG,4QAAqB;QACvC,IAAI,CAAC,OAAO,GAAG,kPAAO;QACtB,IAAI,CAAC,MAAM,GAAG,oQAAiB;QAC/B,IAAI,CAAC,QAAQ,GAAG,wQAAmB;QACnC,IAAI,CAAC,gBAAgB,GAAG,wQAAgB;QACxC,IAAI,CAAC,cAAc,GAAG,sQAAc;IACxC;IACA,WAAW,QAAQ,EAAE;QACjB,IAAI,CAAC,UAAU;YACX,MAAM,IAAI,MAAM;QACpB;QACA,OAAO,IAAI,iQAAmB,CAAC,IAAI,EAAE;IACzC;IACA,iBAAiB,QAAQ,EAAE;QACvB,IAAI,UAAU,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM;QACzC,MAAM,SAAS;YACX,gBAAgB;QACpB;QACA,OAAO,QAAQ,IAAI,CAAC,0BAA0B;IAClD;AACJ","ignoreList":[0]}}]
}